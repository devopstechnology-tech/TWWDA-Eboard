var M=Object.defineProperty;var n=(i,l)=>M(i,"name",{value:l,configurable:!0});import{d as G,i as F,j as H,k as K,n as O,r as m,H as Q,a9 as z,V as J,P as W,o as I,c as P,e as o,a1 as U,g as X,u as k,h as Y,$ as Z,a0 as ee,aa as te,_ as ae}from"./main-d97516e2.js";import{u as se,c as oe,a as r,d as ne,b as ie}from"./useUnexpectedErrorHandler-01ee037e.js";import{u as de,a as re}from"./useFileRequest-ec2c7afb.js";import{u as le}from"./pspdfkit.store-123501c2.js";import{u as ce}from"./useQuery-f8736dfe.js";import"./folder_routes-575ae698.js";import"./useQueryClient-99479e2d.js";const _=n(i=>(Z("data-v-970501c9"),i=i(),ee(),i),"_withScopeId"),ue={class:"card"},pe={class:"card-header flex items-center h-auto p-4"},fe={class:"flex items-center flex-1 w-full"},me=_(()=>o("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),_e={key:0,class:"flex items-center space-x-2"},he=["disabled"],be=_(()=>o("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),ye=_(()=>o("span",{class:"text-blue-primary font-bold"},"Save File",-1)),ve=[be,ye],we={class:"card-body"},Se=G({__name:"document",setup(i){const l=F(),u=H(),R=K(),h=F(),B=O(),b=m(""),a=le(),d=m(null),E=se(),y=u.params.boardId,p=u.params.folderId,v=u.params.mediaId,f=m(""),$=n(()=>{a.unloadPdf(d.value),R.push({name:"BoardDetails",params:{boardId:y}})},"goBack");Q(()=>a.pdfFile,async()=>{`${h.user.first}${h.user.last}`;const e=document.getElementById("app").dataset.appUrl,t=l.hasPermission(["annotate documents"]);await B.loadAndSaveSettings(),await a.loadPdf(d.value,e,t),await te()},{immediate:!0}),z(()=>{a.unloadPdf(d.value)});const q=oe({name:r().required(),board_id:r().required(),folder_id:r().nullable(),parent_id:r().nullable(),type:r().oneOf(["folder","file"]).required(),fileupload:ne().nullable()}),{handleSubmit:V,setErrors:C,setFieldValue:w,values:ge}=ie({validationSchema:q,initialValues:{name:"",board_id:y,folder_id:p,parent_id:"666",type:"file",fileupload:null}}),N=n(async()=>{const e=await a.savePdf(f.value);w("fileupload",e),w("name",f.value),await A()},"savePdf"),A=V(async e=>{try{const t={folder_id:e.folder_id,name:e.name,type:e.type,fileupload:e.fileupload};console.log("payload",t);const s=await de(t,p,v);await S(s.data)}catch(t){a.unloadPdf(d.value),t instanceof J?C(t.messages):E(t)}}),S=n(e=>{if(a.unloadPdf(d.value),e&&e.file){const t=e.file;console.log("base64base640",t);const s=window.atob(t),g=s.length,x=new Uint8Array(g);for(let c=0;c<g;c++)x[c]=s.charCodeAt(c);f.value=e.fileName,L(e.mediaId);const D=new Blob([x],{type:"application/pdf"});b.value=URL.createObjectURL(D),a.setPdfFile(b.value)}},"openFile");function L(e){const t=new URL(window.location),s=t.pathname.split("/");s[s.length-1]=e,t.pathname=s.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}n(L,"updateMediaIdInURL");const T=n(()=>ce({queryKey:["getFileKey"],queryFn:async()=>{const e=await re(p,v);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await S(e.data),e}}),"getFile");W(async()=>{await j()});const{isLoading:xe,data:Fe,refetch:j}=T();return(e,t)=>(I(),P("div",ue,[o("div",pe,[o("div",fe,[o("a",{href:"",onClick:t[0]||(t[0]=U(s=>$(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[me,X(" Go back to The Board ")])]),k(l).hasPermission(["annotate documents"])?(I(),P("div",_e,[o("button",{type:"button",onClick:U(N,["prevent"]),disabled:!k(a).instance,class:"btn btn-tool"},ve,8,he)])):Y("",!0)]),o("div",we,[o("div",{ref_key:"containerRef",ref:d,style:{width:"100%",height:"100vh"}},null,512)])]))}});const qe=ae(Se,[["__scopeId","data-v-970501c9"]]);export{qe as default};
