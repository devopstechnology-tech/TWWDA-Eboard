var C=Object.defineProperty;var n=(i,l)=>C(i,"name",{value:l,configurable:!0});import{d as L,j as $,k as A,i as j,r as p,H as D,a6 as G,V as H,P as K,o as O,c as Q,e as a,T as x,g as W,u as X,W as z,X as J,a7 as Y,_ as Z}from"./main-73cc7250.js";import{u as ee,c as te,a as r,d as ae,b as oe}from"./useUnexpectedErrorHandler-2f351290.js";import{u as se,a as ne}from"./useFileRequest-092d0a4c.js";import{u as ie}from"./pspdfkit.store-2a4fe4da.js";import{u as le}from"./useQuery-1e54e0ce.js";import"./folder_routes-8ac8fb20.js";import"./useQueryClient-0fa55727.js";const m=n(i=>(z("data-v-65486b7f"),i=i(),J(),i),"_withScopeId"),de={class:"card"},re={class:"card-header flex items-center h-auto p-4"},ce={class:"flex items-center flex-1 w-full"},ue=m(()=>a("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),fe={class:"flex items-center space-x-2"},pe=["disabled"],me=m(()=>a("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),_e=m(()=>a("span",{class:"text-blue-primary font-bold"},"Save File",-1)),he=[me,_e],be={class:"card-body"},ye=L({__name:"document",setup(i){const l=$(),S=A(),_=j(),h=p(""),o=ie(),d=p(null),I=ee();l.params.boardId;const F=l.params.meetingId,u=l.params.folderId,b=l.params.mediaId,f=p(""),U=n(()=>{o.unloadPdf(d.value),S.back()},"goBack");D(()=>o.pdfFile,async()=>{const e=_.user.first+" "+_.user.last,t=document.getElementById("app").dataset.appUrl;await o.loadPdf(d.value,t),await Y(),o.createTextAnnotation(e)},{immediate:!0}),G(()=>{o.unloadPdf(d.value)});const k=te({name:r().required(),meeting_id:r().required(),folder_id:r().nullable(),parent_id:r().nullable(),type:r().oneOf(["folder","file"]).required(),fileupload:ae().nullable()}),{handleSubmit:P,setErrors:R,setFieldValue:y,values:E}=oe({validationSchema:k,initialValues:{name:"",meeting_id:F,folder_id:u,parent_id:"666",type:"file",fileupload:null}}),q=n(async()=>{const e=await o.savePdf(f.value);y("fileupload",e),y("name",f.value),console.log(e,E),await B()},"savePdf"),B=P(async e=>{try{const t={folder_id:e.folder_id,name:e.name,type:e.type,fileupload:e.fileupload};console.log("payload",t);const s=await se(t,u,b);await v(s.data)}catch(t){t instanceof H?R(t.messages):I(t)}}),v=n(e=>{if(o.unloadPdf(d.value),e&&e.file){const t=e.file;console.log("base64base640",t);const s=window.atob(t),g=s.length,w=new Uint8Array(g);for(let c=0;c<g;c++)w[c]=s.charCodeAt(c);f.value=e.fileName,M(e.mediaId);const V=new Blob([w],{type:"application/pdf"});h.value=URL.createObjectURL(V),o.setPdfFile(h.value)}},"openFile");function M(e){const t=new URL(window.location),s=t.pathname.split("/");s[s.length-1]=e,t.pathname=s.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}n(M,"updateMediaIdInURL");const N=n(()=>le({queryKey:["getFileKey"],queryFn:async()=>{const e=await ne(u,b);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await v(e.data),e}}),"getMeetingFile");K(async()=>{await T()});const{isLoading:ve,data:ge,refetch:T}=N();return(e,t)=>(O(),Q("div",de,[a("div",re,[a("div",ce,[a("a",{href:"",onClick:t[0]||(t[0]=x(s=>U(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[ue,W(" Go back to The Meeting ")])]),a("div",fe,[a("button",{type:"button",onClick:x(q,["prevent"]),disabled:!X(o).instance,class:"btn btn-tool"},he,8,pe)])]),a("div",be,[a("div",{ref_key:"containerRef",ref:d,style:{width:"100%",height:"100vh"}},null,512)])]))}});const Re=Z(ye,[["__scopeId","data-v-65486b7f"]]);export{Re as default};
