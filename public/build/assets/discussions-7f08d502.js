var Ns=Object.defineProperty;var l=(d,_)=>Ns(d,"name",{value:_,configurable:!0});import{ac as Y,q as M,d as Ps,i as Qs,r as p,C as D,P as Ks,b as Os,u as m,o as a,c as o,e as s,a1 as C,g as H,h as k,F as T,T as E,t as r,f as S,R as K,$ as zs,a0 as Ys,_ as Js}from"./main-d97516e2.js";import{u as Ws,e as Xs,c as O,a as f,f as Zs,b as se,V as ee}from"./useUnexpectedErrorHandler-01ee037e.js";import{e as te}from"./useBoardRequest-eb8bdd66.js";import{d as ie}from"./useCommitteeRequest-787b5c72.js";import{Q as J}from"./index-a4206e89.js";import{b as ae}from"./useUserRequest-19f3a11e.js";import{F as _s}from"./FormInput-19d746f6.js";import{F as I}from"./FormQuillEditor-3e5c8bfd.js";import{f as z,l as ps}from"./Breadcrumb-62de853f.js";import{u as oe}from"./useQuery-f8736dfe.js";import"./useQueryClient-99479e2d.js";const ms=Y("api/v1/chats");async function ne(d,_,v){const y=M(),c=J.stringify(v,{arrayFormat:"brackets"});return(await y.post(ms()+"/"+_+"?"+c,{json:d})).json()}l(ne,"useCreateChatRequest");async function le(d,_){const v=M(),y=J.stringify(_,{arrayFormat:"brackets"});return(await v.patch(ms()+"/update/"+d.id+"?"+y,{json:d})).json()}l(le,"useUpdateChatRequest");const q=Y("api/v1/discussions");Y("api/v1/discussions/members");async function ce(d,_){const v=M(),y=J.stringify(_,{arrayFormat:"brackets"});return await v.get(q()+"/"+d+"?"+y).json()}l(ce,"useGetUserDiscussionsRequest");async function de(d,_){return(await M().post(q()+"/"+_,{json:d})).json()}l(de,"useCreateDiscussionRequest");async function re(d,_,v){return(await M().patch(q()+"/update/"+v,{json:d})).json()}l(re,"useUpdateDiscussionRequest");async function ue(d){return(await M().get(q()+"/leave/"+d)).json()}l(ue,"useLeaveDiscussionRequest");async function _e(d){return(await M().get(q()+"/close/"+d)).json()}l(_e,"useCloseDiscussionRequest");async function pe(d){return(await M().get(q()+"/delete/"+d)).json()}l(pe,"useDeleteDiscussionRequest");const u=l(d=>(zs("data-v-a597699f"),d=d(),Ys(),d),"_withScopeId"),me={key:0},he={class:"card h-full"},ve={class:"card-header flex items-center"},fe=u(()=>s("div",{class:"flex items-center flex-1 w-full"},[s("h2",{class:"card-header-title h3"},"Discussion")],-1)),ge={key:0,class:"flex items-center space-x-2"},be=u(()=>s("i",{class:"far fa fa-plus mr-2"},null,-1)),ye=u(()=>s("span",{class:"text-primary"},"Add Discussion",-1)),xe={class:"card-container"},we={key:0},De={key:1},ke={class:"row"},Ce={class:"col-lg-4"},Me={class:"card"},Se=u(()=>s("div",{class:"card-header bg-primary"},[s("h3",{class:"card-title"},"Discussions")],-1)),Te={class:"card-body"},Ee=u(()=>s("div",{class:"dropdown-divider"},null,-1)),qe={class:"card-body p-0",style:{height:"500px","overflow-y":"auto"}},Le={class:"card-body d-flex align-items-center"},Ue=u(()=>s("i",{class:"fas fa-user-circle fa-2x me-3"},null,-1)),je={class:"flex-grow-1"},Re={class:"mb-0"},$e={class:"text-muted"},Fe=["innerHTML"],Be=["onClick"],Ve=u(()=>s("i",{class:"far fa-eye"},null,-1)),Ae=[Ve],Ge=["onClick"],He=u(()=>s("i",{class:"fa fa-edit"},null,-1)),Ie=[He],Ne={class:"col-lg-8"},Pe={class:"card"},Qe={class:"flex items-center bg-success"},Ke=u(()=>s("h3",{class:"ml-2 card-title"},"Discussion",-1)),Oe={key:0,class:"ml-auto flex self-end"},ze=u(()=>s("a",{class:"nav-link",href:"#",id:"navbarDropdown",role:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[s("i",{class:"fas fa-ellipsis-v"})],-1)),Ye={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"navbarDropdown"},Je=["onClick"],We=u(()=>s("i",{class:"fas fa-users"},null,-1)),Xe=[We],Ze={key:0},st={class:"card-header"},et=u(()=>s("span",{class:"badge bg-secondary"},"Board",-1)),tt={class:"card-body"},it={class:"flex-1 mb-8"},at={class:"bg-gray-200 text-gray-700 rounded-lg px-4 pt-1 pb-1"},ot={class:"text-xs font-medium subpixel-antialiased mb-2 text-gray-900"},nt={href:"#",class:"text-gray-800","data-bs-original-title":"",title:""},lt=["innerHTML"],ct={class:"direct-chat-messages"},dt={class:"flex gap-2 items-start mb-4"},rt={key:0,class:"font-medium flex-1"},ut={class:"flex gap-x-2"},_t=u(()=>s("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),pt={key:1,class:"font-medium flex-1"},mt={key:0,class:"direct-chat-msg"},ht={class:"direct-chat-infos clearfix"},vt={class:"direct-chat-name float-left"},ft={class:"direct-chat-timestamp float-right"},gt={key:0,class:"direct-chat-infos clearfix"},bt={class:"direct-chat-timestamp float-right"},yt=["src"],xt=["innerHTML"],wt={key:1,class:"direct-chat-msg right"},Dt={class:"direct-chat-infos clearfix"},kt={class:"direct-chat-name float-right"},Ct={class:"direct-chat-timestamp float-left"},Mt=["onClick"],St=u(()=>s("i",{class:"fa fa-edit"},null,-1)),Tt=[St],Et={key:0,class:"direct-chat-infos clearfix"},qt={class:"direct-chat-timestamp float-left"},Lt=["src"],Ut=["onClick","innerHTML"],jt={key:0,class:"font-medium flex-1"},Rt={class:"flex gap-x-2"},$t=u(()=>s("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),Ft={key:1,class:"mt-2"},Bt={key:1},Vt=u(()=>s("div",{class:"card-body"}," Kindly select any Discussion Topic To view the Chat ",-1)),At=[Vt],Gt={class:"flex justify-center"},Ht={method:"dialog",class:"modal-box rounded-xl"},It={class:"font-bold text-lg justify-center flex"},Nt=u(()=>s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1)),Pt={class:"overflow-auto p-4",style:{"max-height":"100vh"}},Qt={class:"grid grid-cols-3 md:grid-cols-3 gap-2 p-2"},Kt={class:"col-span-3"},Ot={key:0},zt={class:"flex flex-wrap -mx-2 mt-2"},Yt={class:"w-full px-1 md:px-2"},Jt={key:1},Wt={class:"flex flex-wrap -mx-2 mt-2"},Xt={class:"w-full px-1 md:px-2"},Zt={class:"flex flex-wrap -mx-2 mt-2"},si={class:"w-full md:w-1/3 px-1 md:px-2"},ei={key:0},ti=u(()=>s("h3",{class:"font-bold"},"Selected Boards",-1)),ii={class:"w-full md:w-1/3 px-1 md:px-2"},ai={key:0},oi=u(()=>s("h3",{class:"font-bold"},"Selected Committees",-1)),ni={class:"w-full md:w-1/3 px-1 md:px-2"},li={key:0},ci=u(()=>s("h3",{class:"font-bold"},"Selected Users",-1)),di={class:"form-group col-span-3"},ri=u(()=>s("label",{class:"text-bold font-medium tracking-wide"}," Group Members to the Discucssion ",-1)),ui={key:0,class:"message"},_i={type:"submit",class:"btn btn-primary btn-md w-full mt-6"},pi={key:1},mi=u(()=>s("p",{class:"m-0"},[s("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),hi=[mi],vi=Ps({__name:"discussions",setup(d){var cs;const _=Qs();_.initialize();const v=_.user.id,y=p("latest");p("board");const c=p("create"),L=p(!1),F=p(!1),B=p(-1),N=p(!1),U=p(!1),j=(cs=_.user)==null?void 0:cs.id,hs=p(null),h=p([]),V=p([]),P=p(null),A=p(null);p([]);const R=p(null),W=p([]),X=p([]),Z=p([]),vs=Ws(),{errorMessage:G}=Xs("discussionassignees"),fs=O({id:f().nullable(),full_name:f().nullable()}),gs=O({id:f().nullable(),discussion_id:f().nullable(),assignee_id:f().nullable(),user:fs}),bs=O({id:f().nullable(),topic:f().required(),description:f().required(),closestatus:f().required(),archivestatus:f().required(),message:f().nullable(),assignee_sender_id:f().nullable(),discussion_id:f().nullable(),discussionassignees:Zs().of(gs).nullable()}),{handleSubmit:ys,setErrors:xs,setFieldValue:n,values:ss}=se({validationSchema:bs,initialValues:{id:"",topic:"",description:"",closestatus:"opened",archivestatus:"none",message:null,assignee_sender_id:null,discussion_id:null,discussionassignees:[]}}),ws=l(()=>{var e;x(),c.value="create",F.value=!1,L.value=!0,(e=R.value)==null||e.showModal()},"openCreateDiscussionModal"),es=l(e=>{var i;x(),A.value=e,n("id",e.id),n("topic",e.topic),n("description",e.description),n("closestatus",e.closestatus),n("archivestatus",e.archivestatus),h.value=e.dassignees,n("discussionassignees",h.value),c.value="edit",L.value=!0,(i=R.value)==null||i.showModal(),console.log(ss,c.value)},"openEditDiscussionModal"),Ds=l(e=>{var i;x(),F.value=!0,A.value=e,n("id",e.id),n("topic",e.topic),n("description",e.description),n("closestatus",e.closestatus),n("archivestatus",e.archivestatus),h.value=e.dassignees,n("discussionassignees",h.value),c.value="edit",L.value=!0,(i=R.value)==null||i.showModal(),console.log(ss,c.value)},"openMemberModal"),Q=ys(async e=>{var i;try{if(c.value==="create"||c.value==="edit"){const g={id:e.id,topic:e.topic,description:e.description,closestatus:e.closestatus,archivestatus:e.archivestatus,discussionassignees:e.discussionassignees};c.value==="create"?await de(g,j):await re(g,j,g.id)}else if(c.value==="create chat"||c.value==="edit chat"){const g={id:e.id?e.id:"",topic:e.topic,description:e.description,message:e.message?e.message:"",assignee_sender_id:e.assignee_sender_id?e.assignee_sender_id:"",discussion_id:e.discussion_id?e.discussion_id:""};if(c.value==="create chat"){const t=await ne(g,j,{paginate:"false"});V.value=t.data}else if(c.value==="edit chat"){const t=await le(g,{paginate:"false"});V.value=t.data}}(i=R.value)==null||i.close(),await $(),x()}catch(g){g instanceof ee?xs(g.messages):vs(g)}}),x=l(()=>{c.value="create",F.value=!1,B.value=-1,N.value=!1,U.value=!1,L.value=!1,hs.value=null,h.value=[],P.value=null,n("id",""),n("topic",""),n("description","description ................"),n("closestatus","opened"),n("archivestatus","none"),n("discussionassignees",[]),n("message",""),n("assignee_sender_id",null),n("discussion_id",null)},"reset"),ts=[{id:"latest",name:"Latest"},{id:"starred",name:"Starred"},{id:"unread",name:"Unread"},{id:"mentions",name:"Mentions"},{id:"archived",name:"Archived"}],ks=[{id:"leave",name:"Leave Discussion",icon:"fas fa-sign-out-alt",permissions:["leave discussion"]},{id:"edit",name:"Edit Description",icon:"fas fa-edit",permissions:["edit discussion"]},{id:"close",name:"Close Discussion",icon:"fas fa-times",permissions:["close discussion"]},{id:"delete",name:"Delete Discussion",icon:"far fa-trash-alt text-danger",permissions:["delete discussion"]}],Cs=D(()=>ks.filter(e=>e.permissions?e.permissions.every(i=>_.hasPermission([i])):!0));D(()=>{const e=ts.find(i=>i.id===y.value);return e?e.name:"Latest"}),D(()=>{const e=ts.find(i=>i.id===y.value);return e?e.name:"Board"});function Ms(e,i){console.log("optionId",e),e==="Leave Discussion"?Vs(i):e==="Edit Description"?es(i):e==="Close Discussion"?As(i):e==="Delete Discussion"&&Gs(i)}l(Ms,"handleDiscussionOption");const Ss=l(()=>oe({queryKey:["getDiscussionsKey",j],queryFn:async()=>(await ce(j,{paginate:"false"})).data}),"getDiscussions"),{isLoading:Ts,data:Es,refetch:$}=Ss(),qs=l(async()=>{const e=await te({paginate:"false"});W.value=e.data},"getBoards"),Ls=l(async()=>{const e=await ie({paginate:"false"});X.value=e.data},"getCommittees"),Us=l(async()=>{const e=await ae({paginate:"false"});Z.value=e.data},"getUsers"),js=D(()=>[{label:"Boards",options:W.value.map(i=>({id:i.id,name:i.name,class:"board"}))},{label:"Committees",options:X.value.map(i=>({id:i.id,name:i.name,class:"committee"}))},{label:"Users",options:Z.value.map(i=>({id:i.id,name:i.full_name,class:"user"}))}]),is=D(()=>h.value.filter(e=>e.class==="board")),as=D(()=>h.value.filter(e=>e.class==="committee")),os=D(()=>h.value.filter(e=>e.class==="user")),Rs=D(()=>V.value),w=D(()=>A.value);D(()=>P.value);const $s=l(e=>{x(),V.value=e.chats,A.value=e},"handleSelectedDiscussion"),ns=l(e=>{n("topic",e.topic),n("description",e.description),n("closestatus",e.closestatus),n("archivestatus",e.archivestatus),n("discussion_id",e.id),h.value=e.dassignees,n("discussionassignees",h.value),Q()},"onSubmitChat"),Fs=l(()=>{n("discussionassignees",h.value)},"selectedGroupMember"),Bs=l(()=>{n("discussionassignees",h.value)},"removeselectedGroupMembers"),Vs=l(e=>{ue(e.id),$(),x()},"leaveDiscussion"),As=l(e=>{_e(e.id),$(),x()},"closeDiscussion"),Gs=l(e=>{pe(e.id),$(),x()},"deleteDiscussion"),Hs=l(async()=>{await Us(),await qs(),await Ls()},"getAllMembers");Ks(async()=>{window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Discussions"})),Hs(),$()});const Is=l(()=>{x(),U.value=!0,N.value=!1,B.value=-1,c.value="create chat"},"enableAddingNewChat"),ls=l((e,i)=>{x(),N.value=!0,U.value=!1,B.value=e,c.value="edit chat",P.value=i,n("id",i.id),n("message",i.message),n("assignee_sender_id",i.assignee_sender_id)},"enableEditing");return(e,i)=>{const g=Os("Multiselect");return m(_).hasPermission(["view discussion"])?(a(),o("div",me,[s("div",he,[s("div",ve,[fe,m(_).hasPermission(["create discussion"])?(a(),o("div",ge,[s("button",{type:"button",onClick:C(ws,["prevent"]),class:"btn btn-tool"},[be,H(),ye])])):k("",!0)]),s("div",xe,[m(Ts)?(a(),o("div",we,"Loading Meeting Discussions...")):(a(),o("div",De,[s("div",ke,[s("div",Ce,[s("div",Me,[Se,s("div",Te,[Ee,s("div",qe,[(a(!0),o(T,null,E(m(Es),t=>(a(),o("div",{key:t.id,class:"card mb-2 border border-primary hover:cursor-pointer"},[s("div",Le,[Ue,s("div",je,[s("h6",Re,r(t.topic),1),s("small",$e,r(t.author.full_name),1),s("p",{innerHTML:t.description,class:"mb-0"},null,8,Fe)]),s("a",{href:"#",onClick:C(b=>$s(t),["prevent"]),class:"btn btn-sm btn-outline-secondary m-1"},Ae,8,Be),s("a",{href:"#",onClick:C(b=>es(t),["prevent"]),class:"btn btn-sm btn-outline-secondary m-1"},Ie,8,Ge)])]))),128))])])])]),s("div",Ne,[s("div",Pe,[s("div",Qe,[Ke,w.value?(a(),o("div",Oe,[ze,s("div",Ye,[(a(!0),o(T,null,E(Cs.value,t=>(a(),o("a",{key:t.id,class:"dropdown-item",href:"#",onClick:C(b=>Ms(t.name,w.value),["prevent"])},[s("i",{class:K(t.icon)},null,2),H(" "+r(t.name),1)],8,Je))),128))]),s("button",{class:"btn btn-sm text-white mr-2",onClick:i[0]||(i[0]=C(t=>Ds(w.value),["prevent"]))},Xe)])):k("",!0)]),w.value?(a(),o("div",Ze,[s("div",st,[s("h5",null,r(w.value.topic),1),et]),s("div",tt,[s("div",it,[s("div",at,[s("div",ot,[s("a",nt,r(w.value.author.full_name),1),H(" created this discussion on "+r(m(z)(w.value.created_at)),1)]),s("div",null,[s("p",{innerHTML:w.value.description,class:"mb-0"},null,8,lt)])])]),s("div",ct,[(a(!0),o(T,null,E(Rs.value,(t,b)=>{var ds,rs;return a(),o("div",{key:t.id},[s("div",dt,[B.value===b&&c.value==="edit chat"?(a(),o("div",rt,[s("form",{novalidate:"",onSubmit:i[1]||(i[1]=C(us=>ns(w.value),["prevent"]))},[s("div",ut,[S(I,{label:"Chat Description",name:"message",theme:"snow",placeholder:"Enter Message Content",toolbar:"minimal",contentType:"html",class:"w-full"}),_t])],32)])):(a(),o("div",pt,[t.sender.id!==m(v)?(a(),o("div",mt,[s("div",ht,[s("span",vt,r(t.sender.full_name),1),s("span",ft,r(m(z)(t.created_at)),1)]),t.editstatus==="edited"?(a(),o("div",gt,[s("span",bt,r(t.editstatus),1)])):k("",!0),s("img",{src:m(ps)((ds=t.sender.profile)==null?void 0:ds.avatar),class:"direct-chat-img float-left mr-1",alt:"User Image"},null,8,yt),s("div",{innerHTML:t.message,class:"direct-chat-text"},null,8,xt)])):(a(),o("div",wt,[s("div",Dt,[s("span",kt,r(t.sender.full_name),1),s("span",Ct,[H(r(m(z)(t.created_at))+" ",1),s("span",{onClick:us=>ls(b,t)},Tt,8,Mt)])]),t.editstatus==="edited"?(a(),o("div",Et,[s("span",qt,r(t.editstatus),1)])):k("",!0),s("img",{src:m(ps)((rs=t.sender.profile)==null?void 0:rs.avatar),class:"direct-chat-img float-right ml-1",alt:"User Image"},null,8,Lt),s("div",{onClick:us=>ls(b,t),innerHTML:t.message,class:"direct-chat-text bg-white"},null,8,Ut)]))]))])])}),128)),U.value&&c.value==="create chat"?(a(),o("div",jt,[s("form",{novalidate:"",onSubmit:i[2]||(i[2]=C(t=>ns(w.value),["prevent"]))},[s("div",Rt,[S(I,{label:"Chat Description",name:"message",theme:"snow",placeholder:"Enter Message Content",toolbar:"minimal",contentType:"html",class:"w-full"}),$t])],32)])):k("",!0),!U.value&&c.value!=="create chat"?(a(),o("div",Ft,[s("button",{onClick:Is,class:"btn btn-secondary block w-full mt-4"}," Add Chat ")])):k("",!0)])])])):(a(),o("div",Bt,At))])])]),s("div",Gt,[s("dialog",{id:"discussionmodal",class:"modal",ref_key:"DiscussionModal",ref:R},[s("form",Ht,[s("h3",It,r(c.value=="create"?"Create Discussion":"Edit Discussion")+" "+r(c.value),1),Nt,s("div",Pt,[s("div",Qt,[s("div",Kt,[s("form",{novalidate:"",onSubmit:i[6]||(i[6]=C((...t)=>m(Q)&&m(Q)(...t),["prevent"])),class:""},[F.value?(a(),o("div",Ot,[s("div",zt,[s("div",Yt,[S(_s,{labeled:!0,label:"Discussion Topic",name:"topic",placeholder:"Enter Discussion Topic",type:"text"})])]),S(I,{label:"Discussion Description",name:"description",theme:"snow",placeholder:"Enter Discussion Description",toolbar:"full",contentType:"html",class:"col-span-3"})])):(a(),o("div",Jt,[s("div",Wt,[s("div",Xt,[S(_s,{labeled:!0,label:"Discussion Topic",name:"topic",placeholder:"Enter Discussion Topic",type:"text"})])]),S(I,{label:"Discussion Description",name:"description",theme:"snow",placeholder:"Enter Discussion Description",toolbar:"full",contentType:"html",class:"col-span-3"})])),s("div",Zt,[s("div",si,[is.value.length?(a(),o("div",ei,[ti,s("ul",null,[(a(!0),o(T,null,E(is.value,(t,b)=>(a(),o("li",{key:t.id},r(b+1)+". "+r(t.name),1))),128))])])):k("",!0)]),s("div",ii,[as.value.length?(a(),o("div",ai,[oi,s("ul",null,[(a(!0),o(T,null,E(as.value,(t,b)=>(a(),o("li",{key:t.id},r(b+1)+". "+r(t.name),1))),128))])])):k("",!0)]),s("div",ni,[os.value.length?(a(),o("div",li,[ci,s("ul",null,[(a(!0),o(T,null,E(os.value,(t,b)=>(a(),o("li",{key:t.id},r(b+1)+". "+r(t.name),1))),128))])])):k("",!0)])]),s("div",di,[ri,s("div",{class:K(["multiselect-container",{error:!!m(G)}])},[S(g,{id:"discussionassignees",modelValue:h.value,"onUpdate:modelValue":i[3]||(i[3]=t=>h.value=t),mode:"tags",required:"",placeholder:"Choose your stack","close-on-select":!1,"filter-results":!1,"min-chars":1,"resolve-on-load":!1,delay:0,searchable:!0,options:js.value,groups:!0,valueProp:"id",trackBy:"id",label:"name",class:K(["multiselect-container multiselect-wrapper",["multiselect-container ",{error:!!m(G)}]]),object:!0,onSelect:i[4]||(i[4]=t=>Fs()),onDeselect:i[5]||(i[5]=t=>Bs())},null,8,["modelValue","options","class"]),m(G)?(a(),o("div",ui,r(m(G)),1)):k("",!0)],2)]),s("div",null,[s("button",_i,r(c.value=="create"?"Create Discussion":"Edit Discussion"),1)])],32)])])])])],512)])]))])])])):(a(),o("div",pi,hi))}}});const Ei=Js(vi,[["__scopeId","data-v-a597699f"]]);export{Ei as default};
