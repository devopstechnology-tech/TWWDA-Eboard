var G=Object.defineProperty;var r=(V,g)=>G(V,"name",{value:g,configurable:!0});import{d as J,i as Q,j as Y,r as a,V as W,P as X,C as T,o as d,c,e,F as C,T as Z,u as x,t as h,a1 as F,f as ee,h as te,R as se}from"./main-d97516e2.js";import{u as oe,e as ne,c as le,a as w,b as ae}from"./useUnexpectedErrorHandler-01ee037e.js";import{j as ie,k as re}from"./usePollRequest-97611322.js";import{F as de}from"./FormRadioInput-636b4964.js";import{u as ce}from"./useQuery-f8736dfe.js";import"./index-a4206e89.js";import"./useQueryClient-99479e2d.js";const ue={class:"card h-full"},_e=e("div",{class:"card-header flex items-center"},[e("div",{class:"flex items-center flex-1 w-full"},[e("h2",{class:"card-header-title h3"}," Meeting Polls ")]),e("div",{class:"flex items-center space-x-2"})],-1),pe={id:"poll-asignee-list"},me={class:"table table-striped card-table"},he=e("thead",null,[e("tr",null,[e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort asc","data-sort":"poll-title"}," Poll Title ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"due-date"}," Due Date ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"status"}," Status ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"vote-stats"},"Vote Stats ")]),e("th",{scope:"col",class:"text-bold text-center"},"Action")])],-1),ge={class:"list"},be={class:"poll-title","data-name":"poll.name",style:{"max-width":"200px","word-wrap":"break-word"}},ve={class:"font-weight-bold"},fe=["innerHTML"],ye=["innerHTML"],xe={class:"text-center"},we={key:0},Ve=["onClick"],Pe=e("i",{class:"far fa-eye"},null,-1),ke=[Pe],Me={key:1},Oe={class:"flex justify-center items-center min-h-screen"},Se={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},Te=e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1),Ce={key:0,class:"overflow-auto p-4",style:{"max-height":"80vh"}},Fe=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Poll Details")],-1),qe={class:"card-body"},De={class:"row"},Le=e("dt",{class:"col-sm-3"},"Due",-1),He={class:"col-sm-9"},$e=e("hr",null,null,-1),Ee={class:"user-content text-primary"},Ue=e("dt",{class:"text-muted"},"Description",-1),Ae=["innerHTML"],Ie={id:"form"},je=e("div",{class:"alert alert-danger d-none",id:"validation-message"},null,-1),Ne={class:"form-group"},Re=e("div",{class:"form-group"},[e("button",{class:"btn btn-primary",type:"submit"},"Submit")],-1),tt=J({__name:"Polls",setup(V){const g=Q();g.initialize();const q=g.user.id,D=Y(),P=a(!1),k=a("create");D.params.meetingId;const L=a(null),b=a(null);a([]),a([]),a([]);const v=a(null),f=a(null),H=oe();ne("duedate");const $=le({poll_id:w().required(),poll_assignee_id:w().required(),selectedOption:w().required()}),{handleSubmit:E,setErrors:U,setFieldValue:u,values:Be}=ae({validationSchema:$,initialValues:{poll_id:"",poll_assignee_id:"",selectedOption:""}}),M=E(async s=>{var o;try{const t={poll_id:s.poll_id,poll_assignee_id:s.poll_assignee_id,selectedOption:s.selectedOption};await ie(t,t.poll_id),await O(),A(),(o=f.value)==null||o.close()}catch(t){t instanceof W?U(t.messages):H(t)}}),A=r(()=>{k.value="create",P.value=!1,v.value=null,L.value=null,u("poll_id",""),u("poll_assignee_id",""),u("selectedOption","")},"reset"),I=r(()=>ce({queryKey:["getOwnPollsKey"],queryFn:async()=>(await re({paginate:"false"})).data}),"getPolls"),{isLoading:ze,data:j,refetch:O}=I();X(async()=>{O(),window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Meeting Polls"}))});const S=r(s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),"formattedDateTime"),N=r(s=>{if(!s.votes||s.votes.length===0)return"No votes yet";const o=s.votes.length,t=s.pollassignees.length;if(o>t)return console.error("Total votes exceed total members, which is unexpected."),"Voting data error";const n=s.votes.reduce((l,m)=>{const y=JSON.parse(m.option_id).id;return l[y]=(l[y]||0)+1,l},{}),i=Object.keys(n).reduce((l,m)=>n[l]>n[m]?l:m);if(!s.options.find(l=>l.id===i))return console.error("Most voted option not found in poll options."),"Voting data error";const K=t-o;return(n[i]/o*100).toFixed(1),`${s.options.map(l=>`${((n[l.id]||0)/o*100).toFixed(1)}% voted for ${l.title}`).join("<br>")}<br>Total votes: ${o} / ${K} not yet`},"calculateVoteStats"),R=r(s=>{switch(s){case"Backlog":return"badge bg-warning";case"Pending":return"badge bg-info";case"On Progress":return"badge bg-primary";case"Completed":return"badge bg-success";default:return"badge"}},"statusClass"),_=T(()=>v.value);T(()=>b.value);function B(s,o){const t=s.pollassignees.find(p=>p.user.id===o);if(!t)return!1;const n={assignee_id:t.id,user_id:t.user.id,full_name:t.user.full_name},i=s.votes.some(p=>p.poll_id===s.id&&p.assignee_poll_id===n.assignee_id);return console.log("hasVoted",i),i}r(B,"checkIfVoted");const z=r(s=>{var n;const o=s.pollassignees.find(i=>i.user.id===q),t={assignee_id:o.id,user_id:o.user.id,full_name:o.user.full_name};v.value=s,b.value=t,u("poll_id",s.id),u("poll_assignee_id",o.id),k.value="create",P.value=!0,(n=f.value)==null||n.showModal(),console.log(b.value)},"viewPoll");return(s,o)=>(d(),c(C,null,[e("div",ue,[_e,e("div",pe,[e("table",me,[he,e("tbody",ge,[(d(!0),c(C,null,Z(x(j),(t,n)=>(d(),c("tr",{key:n},[e("td",be,[e("div",ve,h(t.question),1),e("div",{innerHTML:t.description},null,8,fe)]),e("td",null,h(S(t.duedate)),1),e("td",null,[e("span",{class:se(R(t.status))},h(t.status),3)]),e("td",{innerHTML:N(t)},null,8,ye),e("td",xe,[B(t)?(d(),c("div",we,[e("button",{type:"button",onClick:F(i=>z(t),["prevent"]),title:"",class:"mx-2 btn btn-sm btn-primary"},ke,8,Ve)])):(d(),c("div",Me," You Have Voted "))])]))),128))])])])]),e("div",Oe,[e("dialog",{id:"voteModal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"VoteModal",ref:f},[e("form",Se,[Te,_.value?(d(),c("div",Ce,[Fe,e("div",qe,[e("dl",De,[Le,e("dd",He,h(S(_.value.duedate)),1)]),$e,e("div",Ee,[e("dl",null,[Ue,e("dd",null,[e("p",{innerHTML:_.value.description},null,8,Ae)]),e("dd",null,[e("p",null,h(_.value.question),1)])])]),e("div",Ie,[je,e("form",{novalidate:"",onSubmit:o[0]||(o[0]=F((...t)=>x(M)&&x(M)(...t),["prevent"]))},[e("div",Ne,[ee(de,{label:"Poll Options",name:"selectedOption",options:_.value.options,inline:!0},null,8,["options"])]),Re],32)])])])):te("",!0)])],512)])],64))}});export{tt as default};
