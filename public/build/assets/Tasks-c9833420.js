var G=Object.defineProperty;var c=(T,f)=>G(T,"name",{value:f,configurable:!0});import{d as L,j as z,r as u,V as H,C as O,P as Q,o as l,c as n,e,F as v,R as F,u as i,t as r,T as J,f as h,U as x,h as E,a4 as W}from"./main-a9f2cfe9.js";import{u as X,e as Y,c as Z,a as m,f as ee,b as se}from"./useUnexpectedErrorHandler-16280be0.js";import{g as te,u as ae,h as oe}from"./useTaskRequest-8819b4d7.js";import{_ as le}from"./FormDateTimeInput.vue_vue_type_style_index_0_lang-e4584ded.js";import{F as ne}from"./FormInput-139a23bd.js";import{F as ie}from"./FormTextBox-e5e2ff5b.js";import{e as re}from"./Breadcrumb-7a663afc.js";import{u as C}from"./useQuery-e9652e60.js";import"./index-66c2f00f.js";import"./membership_routes-72332848.js";import"./useQueryClient-1703431f.js";const de={class:"card h-full"},ce=e("div",{class:"card-header flex items-center"},[e("div",{class:"flex items-center flex-1 w-full"},[e("h2",{class:"card-header-title h3"}," Meeting Tasks ")])],-1),ue={id:"task-asignee-list"},me={class:"table table-striped card-table"},pe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort asc","data-sort":"task-title"}," Task Title ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"due-date"}," Due Date ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"status"}," Status ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"assignment-members"},"Assignment Members ")]),e("th",{scope:"col",class:"text-bold text-center"},"Action")])],-1),ge={class:"list"},_e={class:"task-title","data-name":"task.name",style:{"max-width":"200px","word-wrap":"break-word"}},be={class:"font-weight-bold"},he={style:{"white-space":"normal"}},fe={key:0,class:"badge bg-warning"},ke={key:1,class:"badge bg-info"},ye={key:2,class:"badge bg-primary"},ve={key:3,class:"badge bg-success"},xe={class:"list-none m-0 p-0"},Te=e("td",{class:"text-center"},null,-1),we={class:"flex justify-center col-md-6"},De={method:"dialog",class:"modal-box rounded-xl"},Me={class:"font-bold text-lg justify-center flex"},qe=e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1),Fe={class:"w-full mt-6 p-2"},Ee={class:"font-thin text-sm flex flex-col items-center gap-6"},Ce={class:"grid grid-cols-3 gap-2"},Ve={class:"form-group col-span-3"},Se=e("label",{class:"text-bold font-medium tracking-wide"}," People Responsible ",-1),Ue={key:0,class:"message"},$e={type:"submit",class:"btn btn-md mb-1 w-full pt-1 text-red-600 mt-6 bg-primary"},Be="1234",Xe=L({__name:"Tasks",setup(T){const f=z(),V=u(!1),g=u("create");f.params.meetingId;const k=u(null),p=u([]),y=u([]);u(null);const w=u(null),S=X(),{errorMessage:_}=Y("taskassignees"),D=c(t=>{const a=new Date,s=new Date(t);return a>s},"hasDueDatePassed"),U=Z({title:m().required(),duedate:m().required(),description:m().required(),status:m().required(),meeting_id:m().required(),task_id:m().nullable(),taskassignees:ee().of(m()).nullable()}),{handleSubmit:$,setErrors:B,setFieldValue:d,values:Pe}=se({validationSchema:U,initialValues:{title:"",duedate:"",description:"",status:"pending",meeting_id:"",task_id:null,taskassignees:[]}}),P=c(()=>{d("taskassignees",p.value)},"selectedUsers"),R=c(()=>{d("taskassignees",p.value)},"removeselectedUsers"),M=$(async(t,{resetForm:a})=>{var s;try{d("taskassignees",p.value);const o={title:t.title,duedate:t.duedate,description:t.description,status:t.status,meeting_id:t.meeting_id,task_id:null,taskassignees:t.taskassignees};if(g.value!=="create"){const b=k.value?k.value.toString():null;o.task_id=b,await te(o,o.meeting_id)}await q(),I(),(s=w.value)==null||s.close()}catch(o){o instanceof H?B(o.messages):S(o)}}),I=c(()=>{g.value="create",V.value=!1,k.value=null,p.value=[],d("title",""),d("duedate",""),d("description",""),d("taskassignees",[])},"reset"),K=O(()=>{var a;const t=[];return y.value&&((a=y.value)==null?void 0:a.length)>0&&y.value.reduce((s,o)=>(s.push({id:o.id,name:`${o.user.full_name}`}),s),t),t});c(async t=>C({queryKey:["getTasksKey"],queryFn:async()=>{const a=await ae(t,Be,{paginate:"false"});return console.log(a),a.data}}),"getMemberships")();const j=c(()=>C({queryKey:["getTasksKey"],queryFn:async()=>{const t=await oe({paginate:"false"});return console.log(t),t.data}}),"getTasks"),{isLoading:Ie,data:A,refetch:q}=j();return Q(async()=>{q(),window.dispatchEvent(new CustomEvent("updateTitle",{detail:"All Tasks"}))}),(t,a)=>(l(),n(v,null,[e("div",de,[ce,e("div",ue,[e("table",me,[pe,e("tbody",ge,[(l(!0),n(v,null,F(i(A),(s,o)=>(l(),n("tr",{key:o},[e("td",_e,[e("div",be,r(s.title),1),e("p",he,r(s.description),1)]),e("td",{class:x({"danger-color":D(s.duedate)&&s.status!=="completed","ok-color":!D(s.duedate)||s.status==="completed"})},r(i(re)(s.duedate)),3),e("td",null,[s.status==="backlog"?(l(),n("span",fe," Backlog ")):s.status==="pending"?(l(),n("span",ke," Pending ")):s.status==="onprogress"?(l(),n("span",ye," On Progress ")):s.status==="completed"?(l(),n("span",ve," Completed ")):E("",!0)]),e("td",null,[e("ul",xe,[(l(!0),n(v,null,F(s.taskassignees,(b,N)=>(l(),n("li",{key:b.id},r(N+1)+". "+r(b.user.full_name),1))),128))])]),Te]))),128))])])])]),e("div",we,[e("dialog",{id:"taskmodal",class:"modal",ref_key:"TaskModal",ref:w},[e("form",De,[e("h3",Me,r(g.value=="create"?"Create Meeting Task":"Edit Meeting Task"),1),qe,e("div",Fe,[e("div",Ee,[e("form",{novalidate:"",onSubmit:a[3]||(a[3]=J((...s)=>i(M)&&i(M)(...s),["prevent"])),class:"w-full rounded-xl mx-auto p-1"},[e("div",Ce,[h(ne,{labeled:!0,label:"Task Title",name:"title",class:"col-span-2 w-full text-sm text-white tracking-wide",placeholder:"Enter Task Title",type:"text"}),h(le,{label:"Task Due Date",name:"duedate",flow:["day"],placeholder:"Task Due Date"}),h(ie,{label:"Task Description",name:"description",class:"col-span-3",placeholder:"Enter Task Description",rows:2}),e("div",Ve,[Se,e("div",{class:x(["multiselect-container",{error:!!i(_)}])},[h(i(W),{id:"taskassignees",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value=s),mode:"tags",placeholder:"Choose your stack","close-on-select":!1,"filter-results":!1,"min-chars":1,"resolve-on-load":!1,delay:0,searchable:!0,options:K.value,valueProp:"id",trackBy:"id",label:"name",class:x(["col-span-3",["multiselect-container",{error:!!i(_)}]]),onSelect:a[1]||(a[1]=s=>P()),onDeselect:a[2]||(a[2]=s=>R())},null,8,["modelValue","options","class"]),i(_)?(l(),n("div",Ue,r(i(_)),1)):E("",!0)],2)])]),e("button",$e,r(g.value=="create"?"Create Meeting Task":"Edit Meeting Task"),1)],32)])])])],512)])],64))}});export{Xe as default};
