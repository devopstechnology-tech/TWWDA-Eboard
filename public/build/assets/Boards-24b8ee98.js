var fe=Object.defineProperty;var n=(w,h)=>fe(w,"name",{value:h,configurable:!0});import{d as pe,i as _e,r as d,V as L,C as A,P as he,b as K,u as o,o as m,c as f,e,T as C,F as be,R as ge,t as _,f as B,U as G,h as x,w as H,g as O,l as xe,W as we,X as ye,_ as Ce}from"./main-dbb1f149.js";import{u as Be,d as ke,c as Ie,a as Q,b as Me,e as qe}from"./useUnexpectedErrorHandler-4e609aa9.js";import{a as Se,b as Ee,c as z,d as Ue,e as Fe}from"./useBoardRequest-ccde2887.js";import{a as Re,b as Ve,c as $e,d as De}from"./useCommitteeRequest-2bb6c0bc.js";import{u as Ne}from"./useStaffRequest-461467c3.js";import{F as Pe}from"./FormInput-9ec9e7b2.js";import{F as je}from"./FormQuillEditor-4b336791.js";import{F as W}from"./FormUpload-23b8c503.js";import{r as Te,a as Le,l as Ae,s as X,i as Ke,u as Y,c as Ge,b as J}from"./Breadcrumb-e536828e.js";import{u as Z}from"./useQuery-c5d8918e.js";import"./index-78587978.js";import"./staff_routes-69f96f4b.js";import"./useQueryClient-785d5088.js";const u=n(w=>(we("data-v-ae5b4e58"),w=w(),ye(),w),"_withScopeId"),He={key:0,class:"container-fluid"},Oe={class:"row"},Qe={class:"col-12"},ze={class:"card"},We={class:"card-header d-flex justify-content-between"},Xe=u(()=>e("h2",{class:"card-header-title h3"},"Boards",-1)),Ye={class:"ml-auto flex items-center space-x-2"},Je={class:"card-body"},Ze={class:"row"},et={class:"card-body"},tt={class:"row"},st={class:"info-box shadow-lg p-4 mb-4 d-flex flex-column flex-grow-1"},at={class:"d-flex flex-column flex-grow-1 align-items-center"},ot=["src"],lt={class:"ml-3 flex-1 w-100"},it={key:0,class:"h2 mb-2"},rt={class:"text-gray-900 m-0"},nt={key:1},ct=u(()=>e("br",null,null,-1)),dt=["onClick"],mt=u(()=>e("i",{class:"fa fa-plus mr-2"},null,-1)),ut=["innerHTML"],vt={class:"d-flex justify-content-end mt-2 w-100"},ft=["onClick"],pt=u(()=>e("i",{class:"fa fa-edit"},null,-1)),_t=[pt],ht=["onClick"],bt=u(()=>e("i",{class:"fa fa-trash-alt"},null,-1)),gt=[bt],xt=u(()=>e("i",{class:"fa fa-eye"},null,-1)),wt={class:"flex justify-center items-center min-h-screen"},yt={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},Ct={class:"font-bold text-lg text-center"},Bt=u(()=>e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕",-1)),kt={class:"overflow-auto p-4",style:{"max-height":"80vh"}},It={class:"grid grid-cols-1 md:grid-cols-2 gap-4 p-2"},Mt={class:"col-span-2"},qt={class:"flex flex-wrap -mx-2"},St={class:"w-full md:w-1/3 px-1 md:px-2 mb-4"},Et={class:"w-full md:w-1/3 px-1 md:px-2 mb-4"},Ut=["src"],Ft={class:"w-full md:w-1/3 px-1 md:px-2 mb-4"},Rt=["src"],Vt={type:"submit",class:"btn btn-primary btn-md w-full mt-6"},$t={class:"flex justify-center col-md-6"},Dt={method:"dialog",class:"modal-box rounded-xl"},Nt=u(()=>e("h3",{class:"font-bold text-lg justify-center flex"},_("Add Members"),-1)),Pt=u(()=>e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕",-1)),jt={class:"w-full mt-6 p-2"},Tt={class:"font-thin text-sm flex flex-col items-center gap-6"},Lt={key:0,class:"message"},At=u(()=>e("button",{type:"submit",class:"btn btn-md mb-1 w-full pt-1 text-red-600 mt-6 bg-primary"},_("Add Members"),-1)),Kt={key:1,class:"container-fluid"},Gt=u(()=>e("p",{class:"m-0"},[e("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),Ht=[Gt],Ot=pe({__name:"Boards",setup(w){const h=_e(),y=d(!1),c=d("create"),l=d("board"),I=d(null),p=d(""),k=d(""),b=d([]),M=d(null),q=d(null),S=d([]);d([]);const R=Be(),V=ke().test("fileOrString","Must be a file or a string",s=>s instanceof File||typeof s=="string"),ee=Ie({name:Q().required("Name is required"),description:Q().required("Description is required"),icon:V.required("Icon is required"),cover:V.required("Cover is required")}),{handleSubmit:te,setErrors:$,setFieldValue:g,values:D}=Me({validationSchema:ee,initialValues:{name:"",description:"",icon:"",cover:""}}),N=te(async s=>{var t,i,v;try{const r={name:s.name,description:s.description,icon:s.icon,cover:s.cover};l.value==="board"?c.value==="create"?await Se(r):c.value==="edit"&&(t=I.value)!=null&&t.id&&(console.log("Selected Board ID:",I.value.id),await Ee(r,I.value.id)):l.value==="committee"&&(c.value==="create"?await Re(r,p.value):c.value==="edit"&&await Ve(r,k.value)),(i=M.value)==null||i.close(),(v=q.value)==null||v.close(),l.value==="board"&&await U(),l.value==="committee"&&await F(),Te(),Le(),P(),b.value=[],y.value=!1}catch(r){r instanceof L?$(r.messages):R(r)}}),se=n(async()=>{var s;try{if(p.value){const t={members:b.value};await z(t,p.value)}if(l.value==="board"){const t={members:b.value};await z(t,p.value)}else if(l.value==="committee"){const t={members:b.value};await $e(t,p.value,k.value)}(s=q.value)==null||s.close(),l.value==="board"&&await U(),l.value==="committee"&&await F(),P(),b.value=[],y.value=!1}catch(t){t instanceof L?$(t.messages):R(t)}},"onSubmitMembers"),{errorMessage:E}=qe("members"),ae=n((s,t)=>{var i;t==="board"?l.value="board":t==="committee"&&(p.value=s,l.value="committee"),c.value="create",y.value=!0,(i=M.value)==null||i.showModal()},"openCreateModal"),oe=n((s,t)=>{var i;I.value=s,g("name",s.name),g("description",s.description),g("icon",s.icon),g("cover",s.cover),J(s.cover),Y(s.icon),t==="board"?l.value="board":t==="committee"&&(k.value=s.id,l.value="committee"),c.value="edit",y.value=!0,(i=M.value)==null||i.showModal()},"openEditModal"),P=n(()=>{g("name",""),g("description",""),g("icon",""),g("cover",""),c.value="create",l.value="board",y.value=!0,p.value="",k.value=""},"resetBoardForm"),le=n((s,t)=>{var v;console.log("ff",s);const i=s.members.map(r=>r.user.id.toString());b.value=i,c.value="members",t==="board"?(l.value="board",p.value=s.id):t==="committee"&&(k.value=s.id,p.value=s.committeeable.details.id,l.value="committee"),y.value=!0,(v=q.value)==null||v.showModal()},"openEditMembersModal"),ie=n(()=>{},"selectedUsers"),re=n(()=>{},"removeSelectedUsers"),ne=n(async s=>{await Ue(s.id),await U(),await F()},"deleteBoard"),ce=A(()=>{var t;const s=[];return S.value&&((t=S.value)==null?void 0:t.length)>0&&S.value.reduce((i,v)=>(i.push({id:v.id,name:`${v.full_name}`}),i),s),s}),de=n(async()=>{const s=await Ne({paginate:"false"});S.value=s.data},"getUsers");he(async()=>{window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Boards & Committees"})),de()});const me=n(()=>Z({queryKey:["getBoardsKey"],queryFn:async()=>(await Fe({paginate:"false"})).data}),"getBoards"),{isLoading:Qt,data:ue,refetch:U}=me(),ve=n(()=>Z({queryKey:["getCommitteesKey"],queryFn:async()=>(await De({paginate:"false"})).data}),"getCommittees"),{isLoading:zt,data:Wt,refetch:F}=ve(),j=A(()=>c.value==="create"&&l.value==="board"?"Create Board":c.value==="edit"&&l.value==="board"?"Edit Board":c.value==="create"&&l.value==="committee"?"Create Committee":c.value==="edit"&&l.value==="committee"?"Edit Committee":"");return(s,t)=>{var r;const i=K("router-link"),v=K("Multiselect");return o(h).hasPermission(["view board"])?(m(),f("div",He,[e("div",Oe,[e("div",Qe,[e("div",ze,[e("div",We,[Xe,e("div",Ye,[e("button",{class:"btn btn-primary btn-sm",onClick:t[0]||(t[0]=C(a=>ae("","board"),["prevent"]))}," New Board ")])]),e("div",Je,[e("div",Ze,[e("div",et,[e("div",tt,[(m(!0),f(be,null,ge(o(ue),a=>(m(),f("div",{class:"col-md-4 col-6 d-flex",key:a.id},[e("div",st,[e("div",at,[e("img",{class:"img-circle elevation-2",src:o(Ae)(a.icon),alt:"User Avatar",style:{width:"128px",height:"128px"}},null,8,ot),e("div",lt,[o(h).hasPermission(["view board"])?(m(),f("h3",it,[B(i,{to:{name:"BoardDetails",params:{boardId:a.id}},class:"badge badge-soft bg-primary text-wrap"},{default:H(()=>[O(_(a.name),1)]),_:2},1032,["to"])])):x("",!0),e("p",rt," Owner: "+_(a.owner),1),a.members?(m(),f("div",nt,[e("span",null,_(a.members.length)+" "+_(a.members.length===1?"Member":"Members"),1),ct,o(h).hasPermission(["add member to board"])?(m(),f("a",{key:0,href:"",onClick:C(T=>le(a,"board"),["prevent"]),class:"text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out"},[mt,O(" Members ")],8,dt)):x("",!0)])):x("",!0),e("p",{class:"text-muted m-0 truncate",innerHTML:a.description},null,8,ut)])]),e("div",vt,[o(h).hasPermission(["edit board"])?(m(),f("a",{key:0,href:"",onClick:C(T=>oe(a,"board"),["prevent"]),class:"text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out mr-2"},_t,8,ft)):x("",!0),o(h).hasPermission(["delete board"])?(m(),f("a",{key:1,href:"",onClick:C(T=>ne(a),["prevent"]),class:"text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out mr-2"},gt,8,ht)):x("",!0),o(h).hasPermission(["view board"])?(m(),xe(i,{key:2,to:{name:"BoardDetails",params:{boardId:a.id}},class:"text-green-500 hover:text-green-700 transition duration-150 ease-in-out"},{default:H(()=>[xt]),_:2},1032,["to"])):x("",!0)])])]))),128))])])])])])])]),e("div",wt,[e("dialog",{id:"boardModal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"BoardModal",ref:M},[e("form",yt,[e("h3",Ct,_(j.value),1),Bt,e("div",kt,[e("div",It,[e("div",Mt,[e("form",{novalidate:"",onSubmit:t[3]||(t[3]=C((...a)=>o(N)&&o(N)(...a),["prevent"])),class:""},[e("div",qt,[e("div",St,[B(Pe,{labeled:!0,label:"Name",name:"name",class:"w-full text-sm text-white tracking-wide",placeholder:"Enter Name",type:"text"})]),e("div",Et,[B(W,{labeled:!0,label:"Upload icon Image",name:"icon",class:"w-full text-sm text-white tracking-wide",placeholder:"Enter icon Image",type:"file",accept:o(X).join(", "),onChange:t[1]||(t[1]=a=>o(Ke)(a))},null,8,["accept"]),e("img",{src:o(Y)((r=o(D))==null?void 0:r.icon),class:"file_attachment"},null,8,Ut)]),e("div",Ft,[B(W,{labeled:!0,label:"Upload Cover Image",name:"cover",class:"w-full text-sm text-white tracking-wide",placeholder:"Enter Cover Image",type:"file",accept:o(X).join(", "),onChange:t[2]||(t[2]=a=>o(Ge)(a))},null,8,["accept"]),e("img",{src:o(J)(o(D).cover),class:"file_attachment"},null,8,Rt)])]),B(je,{label:"Description",name:"description",theme:"snow",placeholder:"Enter Description",toolbar:"full",contentType:"html",class:"col-span-3 mb-4"}),e("button",Vt,_(j.value),1)],32)])])])])],512)]),e("div",$t,[e("dialog",{id:"membersmodal",class:"modal",ref_key:"membersmodal",ref:q},[e("form",Dt,[Nt,Pt,e("div",jt,[e("div",Tt,[e("form",{novalidate:"",onSubmit:C(se,["prevent"]),class:"w-full rounded-xl mx-auto p-1 custom-modal"},[e("div",{class:G(["multiselect-container",{error:!!o(E)}])},[B(v,{id:"members",modelValue:b.value,"onUpdate:modelValue":t[4]||(t[4]=a=>b.value=a),mode:"tags",placeholder:"Choose your stack","close-on-select":!1,"filter-results":!1,"min-chars":1,"resolve-on-load":!1,delay:0,searchable:!0,options:ce.value,valueProp:"id",trackBy:"id",label:"name",class:G(["multiselect-container",{error:!!o(E)}]),onSelect:t[5]||(t[5]=a=>ie()),onDeselect:t[6]||(t[6]=a=>re())},null,8,["modelValue","options","class"]),o(E)?(m(),f("div",Lt,_(o(E)),1)):x("",!0)],2),At],32)])])])],512)])])):(m(),f("div",Kt,Ht))}}});const ds=Ce(Ot,[["__scopeId","data-v-ae5b4e58"]]);export{ds as default};
