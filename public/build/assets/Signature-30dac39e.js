var N=Object.defineProperty;var n=(d,c)=>N(d,"name",{value:c,configurable:!0});import{d as j,j as A,k as G,i as H,r as h,P as K,a3 as O,H as Q,o as W,c as X,e as o,T as S,g as z,u as J,W as Y,X as Z,a7 as ee,a4 as te,_ as ae}from"./main-9b499219.js";import{u as se,c as oe,a as I,d as ne,b as ie,V as re}from"./useUnexpectedErrorHandler-f37df04f.js";import{u as ce,a as le}from"./useSignatureFileRequest-327890f7.js";import{v as de,E as ue}from"./Breadcrumb-74d93201.js";import{u as pe}from"./pspdfkit.store-3ef68173.js";import{u as me}from"./useQuery-7facd994.js";import"./attendance_routes-22107f1a.js";import"./useQueryClient-0be5c548.js";const _=n(d=>(Y("data-v-c185b350"),d=d(),Z(),d),"_withScopeId"),fe={class:"card"},he={class:"card-header flex items-center h-auto p-4"},_e={class:"flex items-center flex-1 w-full"},ge=_(()=>o("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),be={class:"flex items-center space-x-2"},we=["disabled"],ve=_(()=>o("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),ye=_(()=>o("span",{class:"text-blue-primary font-bold"},"Save File",-1)),Se=[ve,ye],Ie={class:"card-body"},Fe=j({__name:"Signature",setup(d){const c=A(),F=G();H();const g=h(""),s=pe(),u=h(null),x=se(),U=c.params.boardId,m=c.params.attendeeId,k=c.params.meetingId,P=c.params.scheduleId,b=c.params.mediaId,f=h(""),R=oe({id:I().required(),name:I().required(),signatureupload:ne().nullable()}),{handleSubmit:E,setErrors:$,setFieldValue:w,values:xe}=ie({validationSchema:R,initialValues:{id:m,name:"",signatureupload:null}}),B=n(async()=>{const e=await s.savePdf(f.value);w("signatureupload",e),w("name",f.value),await T(),await C()},"savePdf"),C=E(async e=>{try{const t={id:e.id,name:e.name,signatureupload:e.signatureupload},a=await ce(t,m,b);await v(a.data)}catch(t){s.unloadPdf(u.value),t instanceof re?$(t.message):x(t)}});function V(e){const t=new URL(window.location),a=t.pathname.split("/");a[a.length-1]=e,t.pathname=a.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}n(V,"updateMediaIdInURL");const q=n(()=>{s.unloadPdf(u.value),F.push({name:"BoardMeetingDetails",params:{boardId:U,meetingId:k,scheduleId:P}})},"goBack"),D=n(async e=>{var t,a;if(s.instance&&e.attendance_status==="Absent"){const i={meeting:e.schedule.meeting.title,schedule:de((t=e==null?void 0:e.schedule)==null?void 0:t.date),name:(a=e==null?void 0:e.membership)==null?void 0:a.user.full_name,date:ue(new Date),position:e==null?void 0:e.membership.position.name},l={};for(const[p,r]of Object.entries(i))l[p]=r;await s.instance.setFormFieldValues(l)}},"populateFormFields"),v=n(e=>{if(s.unloadPdf(u.value),e&&e.file){const t=e.file,a=window.atob(t),i=a.length,l=new Uint8Array(i);for(let r=0;r<i;r++)l[r]=a.charCodeAt(r);f.value=e.fileName,V(e.mediaId);const p=new Blob([l],{type:"application/pdf"});g.value=URL.createObjectURL(p),s.setPdfFile(g.value)}},"openFile"),L=n(()=>me({queryKey:["getFileKey"],queryFn:async()=>{const e=await le(m,b);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await v(e.data),e.data}}),"getSignatureFile"),T=n(async()=>{try{const e="4b60149b61646d",t=await ee.get(`https://ipinfo.io?token=${e}`),{ip:a,city:i,region:l,country:p}=t.data,r=`${a}, ${i}, ${l}, ${p}`;return{ip:a,location:r}}catch(e){return console.error("Error fetching IP address and location:",e),{ip:"Unknown IP",location:"Unknown IP, Unknown City, Unknown Region, Unknown Country"}}},"getCurrentLocation");K(async()=>{await M()}),O(()=>{s.unloadPdf(u.value)});const{isLoading:Ue,data:y,refetch:M}=L();return Q(()=>s.pdfFile,async()=>{var t,a;const e=document.getElementById("app").dataset.appUrl;if(await s.loadPdf(u.value,e),await te(),(t=y.value)!=null&&t.attendance){const i=(a=y.value)==null?void 0:a.attendance;D(i)}},{immediate:!0}),(e,t)=>(W(),X("div",fe,[o("div",he,[o("div",_e,[o("a",{href:"",onClick:t[0]||(t[0]=S(a=>q(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[ge,z(" Go back to The Meeting ")])]),o("div",be,[o("button",{type:"button",onClick:S(B,["prevent"]),disabled:!J(s).instance,class:"btn btn-tool"},Se,8,we)])]),o("div",Ie,[o("div",{ref_key:"containerRef",ref:u,style:{width:"100%",height:"450px"}},null,512)])]))}});const De=ae(Fe,[["__scopeId","data-v-c185b350"]]);export{De as default};
