var tt=Object.defineProperty;var u=(c,e)=>tt(c,"name",{value:e,configurable:!0});import{d as C,j as H,r as y,H as A,b as N,o,c as i,e as t,t as w,f as n,w as r,g as p,_ as M,q as D,a8 as et,i as U,V as st,C as T,U as E,T as I,F as O,R as at,l as F,h as f,u as s,W as ot,X as nt,n as it,a as q,L as j,D as Q,a4 as ct,aX as lt,aY as rt,aZ as dt,a_ as ut,a$ as _t,b0 as mt,b1 as vt,P as ft,Q as ht}from"./main-dbb1f149.js";import{_ as pt,$ as bt,a0 as gt,D as kt}from"./Breadcrumb-e536828e.js";import{b as yt}from"./staff_routes-69f96f4b.js";import{u as G,c as wt,a as xt,b as $t}from"./useUnexpectedErrorHandler-4e609aa9.js";import{Q as St}from"./index-78587978.js";import{u as Ct}from"./useQuery-c5d8918e.js";import"./useQueryClient-785d5088.js";const Nt={class:"content-header"},Bt={class:"container-fluid"},Lt={class:"row mb-2"},Et={class:"col-sm-6"},It={class:"col-sm-6"},At={class:"breadcrumb float-sm-right"},Dt={class:"breadcrumb-item"},Ut={class:"breadcrumb-item text-primary"},Rt=C({__name:"Breadcrumb",setup(c){const e=H(),_=y(""),m=y("");return A(bt,a=>{m.value=a}),window.addEventListener("updateTitle",a=>{pt(a.detail)}),A(()=>e.path,()=>{_.value=e.meta.title||""},{immediate:!0}),(a,h)=>{const g=N("router-link");return o(),i("div",null,[t("section",Nt,[t("div",Bt,[t("div",Lt,[t("div",Et,[t("h1",null,w(m.value),1)]),t("div",It,[t("ol",At,[t("li",Dt,[n(g,{to:"/"},{default:r(()=>[p("Home")]),_:1})]),t("li",Ut,w(_.value),1)])])])])])])}}}),Vt={},Pt=t("footer",{class:"main-footer"},[t("div",{class:"float-right d-none d-sm-block"},[t("b",null,"Version"),p(" 3.0.5 ")]),t("strong",null,[p("Copyright Â© 2014-2019 "),t("a",{href:"/"},"EBoard"),p(".")]),p(" All rights reserved. ")],-1),Tt=[Pt];function Ft(c,e){return o(),i("div",null,Tt)}u(Ft,"_sfc_render");const qt=M(Vt,[["render",Ft]]);async function jt(c={}){await D(c).post(yt()).json()}u(jt,"useStaffLogoutRequest");const K=et("api/v1/notifications");async function Ht(c,e){const _=D(),m=St.stringify(e,{arrayFormat:"brackets"});return await _.get(K()+"/"+c+"?"+m).json()}u(Ht,"useGetNotificationsRequest");async function Mt(c){return(await D().post(K()+"/update/"+c.id,{json:c})).json()}u(Mt,"useUpdateNotificationRequest");const L=u(c=>(ot("data-v-787c9fdb"),c=c(),nt(),c),"_withScopeId"),Ot={class:"dropdown-menu dropdown-menu-end dropdown-menu-card z-[1046] show custom-drop","data-popper-placement":"bottom-end"},Qt={class:"card-header flex items-center"},Gt=L(()=>t("div",{class:"flex items-center flex-1 w-full"},[t("h2",{class:"card-header-title text-base mr-auto font-extrabold"},"Notifications")],-1)),Kt={class:"flex items-center space-x-2"},zt={key:0},Xt={class:"py-2"},Wt=L(()=>t("div",{class:"relative text-right"},[t("button",{type:"button",class:"ml-auto text-primary hover:bg-primary-100 bg-transparent py-1 px-2 rounded-[4px] text-sm flex gap-1 items-center justify-center min-w-fit"}," Mark all as read ")],-1)),Yt=["onClick"],Zt=L(()=>t("div",{class:"avatar avatar-sm mr-4"},[t("div",{class:"avatar-title bg-primary-soft rounded-full text-primary"},[t("i",{class:"far fa-calendar fa-sm"})])],-1)),Jt={class:"flex-1"},te={class:"text-muted mb-0 text-break text-sm"},ee={class:"flex items-center space-x-2"},se={class:"text-danger text-sm"},ae=L(()=>t("hr",null,null,-1)),oe={key:1,class:"p-3 text-center text-muted"},ne=C({__name:"Notifications",emits:["updateCount"],setup(c,{emit:e}){var P;H(),y(!1),y("create"),y(null);const _=G(),m=U(),a=e,h=(P=m.user)==null?void 0:P.id,g=wt({id:xt().required()}),{handleSubmit:v,setErrors:x,setFieldValue:B,values:ls}=$t({validationSchema:g,initialValues:{id:""}}),z=u(async l=>{B("id",l.id),await X()},"updateNotification"),X=v(async(l,{resetForm:k})=>{try{const b={id:l.id};await Mt(b,h,b.id),await Z(),W()}catch(b){b instanceof st?x(b.messages):_(b)}}),W=u(()=>{B("id","")},"reset"),Y=u(()=>Ct({queryKey:["getNotificationsKey",h],queryFn:async()=>(await Ht(h.toString(),{paginate:"false"})).data}),"getNotifications"),{isLoading:rs,data:$,refetch:Z}=Y(),S=y("unread"),R=T(()=>$.value?S.value==="unread"?$.value.filter(l=>l.read_at===null):$.value:[]),J=T(()=>{const l=$.value?$.value.filter(k=>k.read_at===null).length:0;return a("updateCount",l),l}),V=u(l=>{S.value=l,console.log("we",l,S.value)},"filterNotifications");return A(J,l=>{a("updateCount",l)}),(l,k)=>{const b=N("router-link");return o(),i("div",Ot,[t("div",Qt,[Gt,t("div",Kt,[t("button",{type:"button",class:E(["btn btn-tool",{"btn-info":S.value==="unread"}]),onClick:k[0]||(k[0]=I(d=>V("unread"),["prevent","stop"]))}," Unread ",2),t("button",{type:"button",class:E(["btn btn-tool",{"btn-info":S.value==="all"}]),onClick:k[1]||(k[1]=I(d=>V("all"),["prevent","stop"]))}," All ",2)])]),R.value.length>0?(o(),i("div",zt,[t("div",Xt,[Wt,(o(!0),i(O,null,at(R.value,d=>(o(),i("a",{key:d.id,href:"",onClick:I(ds=>z(d),["prevent","stop"]),class:"p-3 block flex text-gray-800"},[Zt,t("div",Jt,[t("h5",{class:E({"text-info font-semibold":d.read_at===null,"text-black font-semibold":d.read_at!==null})},w(d.data.message),3),t("div",te,[t("div",ee,[d.data.board_id?(o(),F(b,{key:0,class:"text-primary font-bold",to:{name:"BoardDetails",params:{boardId:d.data.board_id}}},{default:r(()=>[p(" View the Board ")]),_:2},1032,["to"])):f("",!0),d.data.meeting_id?(o(),F(b,{key:1,class:"text-success font-bold",to:{name:"BoardDetails",params:{boardId:d.data.meeting_id}}},{default:r(()=>[p(" View the Meeting ")]),_:2},1032,["to"])):f("",!0)])]),t("div",se,w(s(gt)(d.created_at)),1)])],8,Yt))),128)),ae])])):(o(),i("div",oe," No notifications to show. "))])}}});const ie=M(ne,[["__scopeId","data-v-787c9fdb"]]),ce={class:"main-header navbar navbar-expand navbar-white"},le={class:"navbar-nav"},re=t("li",{class:"nav-item"},[t("a",{class:"nav-link","data-widget":"pushmenu",href:"#",role:"button"},[t("i",{class:"fas fa-bars"})])],-1),de={class:"nav-item d-none d-sm-inline-block"},ue={class:"navbar-nav ml-auto"},_e={class:"nav-item dropdown"},me={class:"nav-link","data-toggle":"dropdown",href:"#"},ve=t("i",{class:"far fa-bell fa-lg mr-2"},null,-1),fe={class:"badge bg-danger navbar-badge"},he={class:"dropdown-menu dropdown-menu-lg dropdown-menu-right"},pe=t("li",{class:"nav-item"},[t("a",{class:"nav-link","data-widget":"fullscreen",href:"#",role:"button"},[t("i",{class:"fas fa-expand-arrows-alt"})])],-1),be=t("a",{class:"nav-link",href:"#",role:"button"}," Logout ",-1),ge=[be],ke=t("li",{class:"nav-item"},[t("a",{class:"nav-link","data-widget":"control-sidebar","data-slide":"true",href:"#",role:"button"},[t("i",{class:"fas fa-th-large"})])],-1),ye=C({__name:"Header",setup(c){const e=y(0),_=U(),m=it(),a=G();async function h(){try{await jt(),_.setUser(void 0),m.resetSettings(),await q.push({name:j});const v=q.resolve({name:j});window.location.href=v.href}catch(v){a(v)}}u(h,"onLogout");function g(v){e.value=v}return u(g,"updateUnreadCount"),(v,x)=>{const B=N("router-link");return o(),i("nav",ce,[t("ul",le,[re,t("li",de,[n(B,{to:{name:s(Q)},class:"nav-link"},{default:r(()=>[p("Home")]),_:1},8,["to"])])]),t("ul",ue,[t("li",_e,[t("a",me,[ve,t("span",fe,w(e.value),1)]),t("div",he,[n(ie,{onUpdateCount:g})])]),pe,t("li",{onClick:h,class:"nav-item"},ge),ke])])}}}),we={class:"main-sidebar sidebar-dark-primary elevation-4"},xe=t("span",{class:"brand-text font-weight-light"},"Eboard",-1),$e={class:"sidebar"},Se={key:0,class:"user-panel mt-3 pb-3 mb-3 d-flex"},Ce={class:"image"},Ne=["src"],Be={class:"info"},Le={class:"mt-2"},Ee={class:"nav nav-pills nav-sidebar flex-column","data-widget":"treeview",role:"menu","data-accordion":"false"},Ie={class:"nav-item"},Ae=t("i",{class:"nav-icon fas fa-tachometer-alt"},null,-1),De=t("p",null," Dashboard ",-1),Ue={key:0,class:"nav-item"},Re=t("i",{class:"nav-icon fas fa-th"},null,-1),Ve=t("p",null," Board & Committee ",-1),Pe={key:1,class:"nav-item"},Te=t("i",{class:"nav-icon fas fa-chart-pie"},null,-1),Fe=t("p",null," Almanac ",-1),qe={key:2,class:"nav-item"},je=t("i",{class:"nav-icon fas fa-tree"},null,-1),He=t("p",null," Discussions ",-1),Me={key:3,class:"nav-item"},Oe=t("i",{class:"nav-icon fas fa-edit"},null,-1),Qe=t("p",null," Polls ",-1),Ge={key:4,class:"nav-item"},Ke=t("i",{class:"nav-icon fas fa-table"},null,-1),ze=t("p",null," Tasks ",-1),Xe={key:5,class:"nav-item"},We=t("i",{class:"nav-icon far fa-calendar-alt"},null,-1),Ye=t("p",null," Users ",-1),Ze={key:6,class:"nav-item"},Je=t("i",{class:"nav-icon fas fa-tree"},null,-1),ts=t("p",null," Calendar ",-1),es={key:7,class:"nav-item"},ss=t("i",{class:"nav-icon fas fa-tree"},null,-1),as=t("p",null," Settings ",-1),os=C({__name:"Sidebar",setup(c){const e=U();return(_,m)=>{var h,g,v,x;const a=N("router-link");return o(),i("div",null,[t("aside",we,[n(a,{to:"/",class:"brand-link"},{default:r(()=>[xe]),_:1}),t("div",$e,[s(e).user?(o(),i("div",Se,[t("div",Ce,[t("img",{src:s(kt)((h=s(e).user.profile)==null?void 0:h.avatar),class:"img-circle elevation-2",alt:"User Image"},null,8,Ne)]),t("div",Be,[n(a,{to:{name:"ProfileDetails",params:{userId:(v=(g=s(e))==null?void 0:g.user)==null?void 0:v.id,profileId:(x=s(e).user.profile)==null?void 0:x.id}},class:"d-block"},{default:r(()=>[p(w(s(e).user.full_name),1)]),_:1},8,["to"])])])):f("",!0),t("nav",Le,[t("ul",Ee,[t("li",Ie,[n(a,{to:{name:s(Q)},class:"nav-link","active-class":"active"},{default:r(()=>[Ae,De]),_:1},8,["to"])]),s(e).hasPermission(["view committee","view board"])?(o(),i("li",Ue,[n(a,{to:{name:s(ct)},class:"nav-link","active-class":"active"},{default:r(()=>[Re,Ve]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view almanac"])?(o(),i("li",Pe,[n(a,{to:{name:s(lt)},class:"nav-link","active-class":"active"},{default:r(()=>[Te,Fe]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view discussion"])?(o(),i("li",qe,[n(a,{to:{name:s(rt)},class:"nav-link","active-class":"active"},{default:r(()=>[je,He]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view poll"])?(o(),i("li",Me,[n(a,{to:{name:s(dt)},class:"nav-link","active-class":"active"},{default:r(()=>[Oe,Qe]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view task"])?(o(),i("li",Ge,[n(a,{to:{name:s(ut)},class:"nav-link","active-class":"active"},{default:r(()=>[Ke,ze]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view users"])?(o(),i("li",Xe,[n(a,{to:{name:s(_t)},class:"nav-link","active-class":"active"},{default:r(()=>[We,Ye]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view calendar"])?(o(),i("li",Ze,[n(a,{to:{name:s(mt)},class:"nav-link","active-class":"active"},{default:r(()=>[Je,ts]),_:1},8,["to"])])):f("",!0),s(e).hasPermission(["view settings"])?(o(),i("li",es,[n(a,{to:{name:s(vt)},class:"nav-link","active-class":"active"},{default:r(()=>[ss,as]),_:1},8,["to"])])):f("",!0)])])])])])}}}),ns={class:"content-wrapper"},is={class:"content"},cs={class:"container-fluid"},gs=C({__name:"Main",setup(c){return ft(()=>{const e=document.getElementById("app");document.body.classList.add("hold-transition","sidebar-mini","layout-fixed","layout-navbar-fixed","layout-footer-fixed"),e&&e.classList.add("wrapper")}),ht(()=>{document.body.classList.remove("hold-transition","sidebar-mini","layout-fixed","layout-navbar-fixed","layout-footer-fixed");const e=document.getElementById("app");e&&e.classList.remove("wrapper")}),(e,_)=>{const m=N("RouterView");return o(),i(O,null,[p(" ddd "),n(ye),n(os),t("div",ns,[n(Rt),t("section",is,[t("div",cs,[n(m)])])]),n(qt)],64)}}});export{gs as default};
