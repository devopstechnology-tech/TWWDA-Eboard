var M=Object.defineProperty;var n=(i,r)=>M(i,"name",{value:r,configurable:!0});import{d as G,i as F,j as H,k as K,n as O,r as f,H as Q,a3 as W,V as X,P as z,o as I,c as P,e as o,T as U,g as J,u as k,h as Y,W as Z,X as ee,a4 as te,_ as ae}from"./main-9b499219.js";import{u as se,c as oe,a as l,d as ne,b as ie}from"./useUnexpectedErrorHandler-f37df04f.js";import{u as de,a as le}from"./useFileRequest-eb873f34.js";import{u as re}from"./pspdfkit.store-3ef68173.js";import{u as ce}from"./useQuery-7facd994.js";import"./folder_routes-6d34764d.js";import"./useQueryClient-0be5c548.js";const _=n(i=>(Z("data-v-9962d303"),i=i(),ee(),i),"_withScopeId"),ue={class:"card"},me={class:"card-header flex items-center h-auto p-4"},pe={class:"flex items-center flex-1 w-full"},fe=_(()=>o("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),_e={key:0,class:"flex items-center space-x-2"},he=["disabled"],ye=_(()=>o("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),ve=_(()=>o("span",{class:"text-blue-primary font-bold"},"Save File",-1)),be=[ye,ve],we={class:"card-body"},Se=G({__name:"document",setup(i){const r=F(),u=H(),R=K(),h=F(),C=O(),y=f(""),a=re(),d=f(null),E=se(),v=u.params.committeeId,m=u.params.folderId,b=u.params.mediaId,p=f(""),q=n(()=>{a.unloadPdf(d.value),R.push({name:"CommitteeDetails",params:{committeeId:v}})},"goBack");Q(()=>a.pdfFile,async()=>{`${h.user.first}${h.user.last}`;const e=document.getElementById("app").dataset.appUrl,t=r.hasPermission(["annotate documents"]);await C.loadAndSaveSettings(),await a.loadPdf(d.value,e,t),await te()},{immediate:!0}),W(()=>{a.unloadPdf(d.value)});const B=oe({name:l().required(),committee_id:l().required(),folder_id:l().nullable(),parent_id:l().nullable(),type:l().oneOf(["folder","file"]).required(),fileupload:ne().nullable()}),{handleSubmit:V,setErrors:$,setFieldValue:w,values:ge}=ie({validationSchema:B,initialValues:{name:"",committee_id:v,folder_id:m,parent_id:"666",type:"file",fileupload:null}}),N=n(async()=>{const e=await a.savePdf(p.value);w("fileupload",e),w("name",p.value),await A()},"savePdf"),A=V(async e=>{try{const t={folder_id:e.folder_id,name:e.name,type:e.type,fileupload:e.fileupload};console.log("payload",t);const s=await de(t,m,b);await S(s.data)}catch(t){a.unloadPdf(d.value),t instanceof X?$(t.messages):E(t)}}),S=n(e=>{if(a.unloadPdf(d.value),e&&e.file){const t=e.file;console.log("base64base640",t);const s=window.atob(t),g=s.length,x=new Uint8Array(g);for(let c=0;c<g;c++)x[c]=s.charCodeAt(c);p.value=e.fileName,L(e.mediaId);const D=new Blob([x],{type:"application/pdf"});y.value=URL.createObjectURL(D),a.setPdfFile(y.value)}},"openFile");function L(e){const t=new URL(window.location),s=t.pathname.split("/");s[s.length-1]=e,t.pathname=s.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}n(L,"updateMediaIdInURL");const T=n(()=>ce({queryKey:["getFileKey"],queryFn:async()=>{const e=await le(m,b);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await S(e.data),e}}),"getFile");z(async()=>{await j()});const{isLoading:xe,data:Fe,refetch:j}=T();return(e,t)=>(I(),P("div",ue,[o("div",me,[o("div",pe,[o("a",{href:"",onClick:t[0]||(t[0]=U(s=>q(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[fe,J(" Go back to The Committee ")])]),k(r).hasPermission(["annotate documents"])?(I(),P("div",_e,[o("button",{type:"button",onClick:U(N,["prevent"]),disabled:!k(a).instance,class:"btn btn-tool"},be,8,he)])):Y("",!0)]),o("div",we,[o("div",{ref_key:"containerRef",ref:d,style:{width:"100%",height:"100vh"}},null,512)])]))}});const Be=ae(Se,[["__scopeId","data-v-9962d303"]]);export{Be as default};
