var G=Object.defineProperty;var u=(w,h)=>G(w,"name",{value:h,configurable:!0});import{d as Q,i as J,r as c,j as X,V as Y,C as E,P as Z,o as _,c as m,e as t,F as y,T as q,u as p,t as l,a1 as L,f as tt,h as et,R as st,aa as at}from"./main-d97516e2.js";import{u as nt,e as ot,c as it,a as g,b as lt}from"./useUnexpectedErrorHandler-01ee037e.js";import{j as dt,k as ct,l as rt}from"./useTaskRequest-3c5f3f5d.js";import{F as ut}from"./FormRadioInput-636b4964.js";import{k as $}from"./Breadcrumb-62de853f.js";import{u as _t}from"./useQuery-f8736dfe.js";import"./index-a4206e89.js";import"./useQueryClient-99479e2d.js";const mt={class:"card h-full"},pt=t("div",{class:"card-header flex items-center"},[t("div",{class:"flex items-center flex-1 w-full"},[t("h2",{class:"card-header-title h3"}," Meeting Tasks ")])],-1),ht={id:"task-asignee-list"},kt={class:"table table-striped card-table"},gt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},[t("button",{class:"text-bold btn btn-link btn-sm list-sort asc","data-sort":"task-title"}," Task Title ")]),t("th",{scope:"col"},[t("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"due-date"}," Due Date ")]),t("th",{scope:"col"},[t("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"status"}," Status ")]),t("th",{scope:"col"},[t("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"assignment-members"},"Assignment Members ")]),t("th",{scope:"col",class:"text-bold text-center"},"Action")])],-1),bt={class:"list"},vt={class:"task-title","data-name":"task.name",style:{"max-width":"200px","word-wrap":"break-word"}},ft={class:"font-weight-bold"},Tt=["innerHTML"],xt=["innerHTML"],yt={class:"list-none m-0 p-0"},wt={class:"text-center"},Ct=["onClick"],Ot=t("i",{class:"far fa-eye"},null,-1),St=[Ot],Mt={class:"flex justify-center items-center min-h-screen"},Dt={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},Ft=t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1),Et={key:0,class:"overflow-auto p-4",style:{"max-height":"80vh"}},qt={class:"card-header"},Lt={class:"card-title"},$t={class:"card-body"},Ht={class:"row"},Pt=t("dt",{class:"col-sm-3"},"Due",-1),Rt={class:"col-sm-9"},Vt=t("hr",null,null,-1),At={class:"user-content text-primary"},Ut=t("dt",{class:"text-muted"},"Description",-1),jt=["innerHTML"],Nt={id:"form"},Bt=t("div",{class:"alert alert-danger d-none",id:"validation-message"},null,-1),zt={class:"form-group"},It={class:"form-group"},Kt={class:"btn btn-primary",type:"submit"},oe=Q({__name:"Tasks",setup(w){const h=J();h.initialize();const H=h.user.id,C=c(!1);X();const P=c(!1),d=c("create"),R=c(null);c(null);const b=c(null),v=c(null),V=nt();ot("taskassignees");const O=u(s=>{const a=new Date,e=new Date(s);return a>e},"hasDueDatePassed"),A=it({taskstatus_id:g().nullable(),task_id:g().required(),task_assignee_id:g().required(),selectedOption:g().required()}),{handleSubmit:U,setErrors:j,setFieldValue:n,values:f}=lt({validationSchema:A,initialValues:{taskstatus_id:null,task_id:"",task_assignee_id:"",selectedOption:""}}),S=U(async s=>{var a;try{const e={taskstatus_id:s.taskstatus_id,task_id:s.task_id,task_assignee_id:s.task_assignee_id,selectedOption:s.selectedOption};d.value==="create"?await dt(e,e.task_id):await ct(e,e.taskstatus_id),await F(),M(),(a=v.value)==null||a.close()}catch(e){e instanceof Y?j(e.messages):V(e)}}),M=u(()=>{d.value="create",P.value=!1,b.value=null,R.value=null,n("taskstatus_id",null),n("task_id",""),n("task_assignee_id",""),n("selectedOption","")},"reset"),N=u(async s=>{var i;M();const a=s.taskassignees.find(o=>o.user.id===H);if(!a){console.error("Current user is not an assignee of this task");return}a.id,a.user.id,a.user.full_name,b.value=s;const e=s.taskstatuses.find(o=>o.assignee_task_id===a.id);console.log("currentUserTaskStatus",e),C.value=!e,!C.value&&e?(d.value="edit",n("taskstatus_id",e.id),n("task_id",e.task_id),n("task_assignee_id",e.assignee_task_id),n("selectedOption",e.status),console.log("action.valueselectedOption",f.selectedOption)):(d.value="create",n("task_id",s.id),n("task_assignee_id",a.id),n("selectedOption","")),await at(),(i=v.value)==null||i.showModal(),console.log(f),console.log("action.value",d.value)},"viewTask"),k=E(()=>b.value),D=E(()=>[{id:"backlog",value:"backlog"},{id:"pending",value:"pending"},{id:"onprogress",value:"onprogress"},{id:"completed",value:"completed"}]),B=u(()=>_t({queryKey:["getOwnTasksKey"],queryFn:async()=>{const s=await rt({paginate:"false"});return console.log(s),s.data}}),"getTasks"),{isLoading:Wt,data:z,refetch:F}=B();Z(async()=>{F(),window.dispatchEvent(new CustomEvent("updateTitle",{detail:"All Tasks"}))});const I=u(s=>{if(!s.taskstatuses||s.taskstatuses.length===0)return"No task statuses yet";const a=s.taskstatuses.length,e=s.taskassignees.length;if(a>e)return console.error("Total task statuses exceed total assignees, which is unexpected."),"Task data error";const i=s.taskstatuses.reduce((r,x)=>(r[x.status]=(r[x.status]||0)+1,r),{}),o=i.completed||0,T=e-o,K=(o/e*100).toFixed(1),W=(T/e*100).toFixed(1);return`${Object.keys(i).map(r=>`${((i[r]||0)/e*100).toFixed(1)}% ${r}`).join("<br>")}<br>Completed: ${K}%<br>Remaining: ${W}%`},"calculateTaskStats");return(s,a)=>(_(),m(y,null,[t("div",mt,[pt,t("div",ht,[t("table",kt,[gt,t("tbody",bt,[(_(!0),m(y,null,q(p(z),(e,i)=>(_(),m("tr",{key:i},[t("td",vt,[t("div",ft,l(e.title),1),t("div",{innerHTML:e.description},null,8,Tt)]),t("td",{class:st({"danger-color":O(e.duedate)&&e.status!=="completed","ok-color":!O(e.duedate)||e.status==="completed"})},l(p($)(e.duedate)),3),t("td",{innerHTML:I(e)},null,8,xt),t("td",null,[t("ul",yt,[(_(!0),m(y,null,q(e.taskassignees,(o,T)=>(_(),m("li",{key:o.id},l(T+1)+". "+l(o.user.full_name),1))),128))])]),t("td",wt,[t("button",{type:"button",onClick:L(o=>N(e),["prevent"]),title:"",class:"mx-2 btn btn-sm btn-primary"},St,8,Ct)])]))),128))])])])]),t("div",Mt,[t("dialog",{id:"taskModal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"TaskModal",ref:v},[t("form",Dt,[Ft,k.value?(_(),m("div",Et,[t("div",qt,[t("h3",Lt,l(d.value=="create"?"Create Task Status":"Edit Task Status"),1)]),t("div",$t,[t("dl",Ht,[Pt,t("dd",Rt,l(p($)(k.value.duedate)),1)]),Vt,t("div",At,[t("dl",null,[Ut,t("dd",null,[t("p",null,l(k.value.title),1)]),t("dd",null,[t("p",{innerHTML:k.value.description},null,8,jt)])])]),t("div",Nt,[Bt,t("form",{novalidate:"",onSubmit:a[0]||(a[0]=L((...e)=>p(S)&&p(S)(...e),["prevent"]))},[t("div",zt,[tt(ut,{label:"Poll Options",name:"selectedOption",options:D.value,checked:D.value[p(f).selectedOption],inline:!0},null,8,["options","checked"])]),t("div",It,[t("button",Kt,l(d.value=="create"?"Create Task Status":"Edit Task Status"),1)])],32)])])])):et("",!0)])],512)])],64))}});export{oe as default};
