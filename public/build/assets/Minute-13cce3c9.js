var Re=Object.defineProperty;var k=(N,Y)=>Re(N,"name",{value:Y,configurable:!0});import{d as Fe,i as Ne,n as Ge,k as Le,j as Oe,r as S,V as Ve,C as T,P as De,H as Be,u as o,o as i,c as a,e,T as F,g as M,h as p,t as u,F as A,R as w,f as pe,W as Ue,X as We,_ as Ye}from"./main-dbb1f149.js";import{u as je,c as Ke,d as Qe,a as H,g as ze,b as Xe}from"./useUnexpectedErrorHandler-4e609aa9.js";import{i as Je,j as Ze,k as Ie,l as et,h as tt,o as st,p as it,n as at,q as lt,r as nt}from"./useMinuteRequest-68068c00.js";import{u as ot}from"./useScheduleRequest-b9d5a42f.js";import{F as ge}from"./FormQuillEditor-4b336791.js";import{A as dt,v as rt,B as O,C as E}from"./Breadcrumb-e536828e.js";import{u as ut}from"./useQuery-c5d8918e.js";import"./index-78587978.js";import"./useQueryClient-785d5088.js";const v=k(N=>(Ue("data-v-aa1f2d89"),N=N(),We(),N),"_withScopeId"),ct={key:0},_t={class:"card card-widget shadow-lg"},vt={key:0,class:"card-footer"},bt={class:"d-flex align-items-center"},mt={class:"ml-3 flex-1"},ht=v(()=>e("i",{class:"fas fa-chevron-left"},null,-1)),pt={key:0,class:"ml-auto flex self-end"},gt={key:0,type:"button",class:"btn btn-sm mr-1 btn-success btn-lg"},ft=v(()=>e("i",{class:"fas fa-door-closed mr-1"},null,-1)),yt=v(()=>e("i",{class:"fas fa-door-closed mr-1"},null,-1)),kt={key:2,type:"button",class:"btn btn-sm mr-1 btn-warning btn-lg"},Ct=v(()=>e("i",{class:"fa fa-check mr-1"},null,-1)),xt=v(()=>e("i",{class:"fa fa-check mr-1"},null,-1)),St=v(()=>e("i",{class:"fa fa-trash mr-1"},null,-1)),At=v(()=>e("i",{class:"fa fa-signature mr-1"},null,-1)),wt=v(()=>e("i",{class:"fa fa-check mr-1"},null,-1)),Et={class:"card-body"},$t=v(()=>e("span",{class:"info-box-icon",style:{left:"4%","margin-left":"-45px",position:"absolute",top:"88px"}},[e("div",{class:"h3 text-bold font-bold uppercase text-primary"}," Confidential")],-1)),Mt={class:"text-center logo-container"},qt=["src"],Tt={class:"h3 text-center text-primary text-bold font-bold uppercase"},Ht=v(()=>e("hr",{class:"thick-line"},null,-1)),Pt={class:"text-center text-primary text-bold uppercase h4"},Rt={class:"text-center text-primary text-bold uppercase h4"},Ft={key:0,class:"mt-2 text-primary text-bold uppercase"},Nt={key:1,class:"table table-borderless"},Gt={class:"p-0"},Lt={class:"p-0 text-primary text-bold uppercase"},Ot={key:2,class:"mt-2 text-primary text-bold uppercase"},Vt={key:3,class:"table table-borderless"},Dt={class:"p-0"},Bt={class:"p-0 text-primary text-bold uppercase"},Ut={key:4,class:"mt-2 text-primary text-bold uppercase"},Wt={key:5,class:"table table-borderless"},Yt={class:"p-0"},jt={class:"p-0 text-primary text-bold uppercase"},Kt={key:6,class:"mt-2 text-primary text-bold uppercase"},Qt={key:7,class:"table table-borderless"},zt={class:"p-0"},Xt={class:"p-0 text-primary text-bold uppercase"},Jt=v(()=>e("h5",{class:"mt-2 text-primary text-bold uppercase"},"Agenda",-1)),Zt={class:"list-unstyled"},It={class:"list-unstyled ml-4"},es={id:"MinutesEditor",class:"container"},ts={class:"codex-editor"},ss={class:"codex-editor__redactor",style:{"padding-bottom":"300px"}},is={class:"ce-block"},as={class:"flex w-full"},ls={class:"flex-1"},ns={key:0,"data-list_format":"num_la_lr",class:"agenda-list mb-0 border-l border-blue"},os={class:"rounded-lg border border-transparent hover:cursor-pointer border-blue -ml-7 p-2 pl-7 relative border-blue"},ds={class:"flex gap-2 items-start"},rs={key:0,class:"font-medium flex-1"},us={class:"text-sm text-gray-800 font-normal"},cs={class:"flex gap-x-2"},_s=v(()=>e("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),vs={key:1,class:"font-medium flex-1"},bs=["onClick"],ms={class:"font-bold text-primary"},hs=["innerHTML"],ps=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-warning text-bold"}," Click Here to Edit This Agenda Minute And Click save")],-1)),gs=["onClick"],fs={class:"font-bold text-primary"},ys=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-info text-bold"}," Click Here to add Minutes for this Agenda and Click Save")],-1)),ks={key:0,class:"min-h-6 border-l border-blue"},Cs={class:"rounded-lg border border-transparent hover:cursor-pointer border-blue -ml-7 p-2 pl-7 relative border-blue"},xs={class:"flex gap-2 items-start"},Ss={key:0,class:"font-medium flex-1"},As={class:"text-sm text-gray-800 font-normal"},ws={class:"flex gap-x-2"},Es=v(()=>e("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),$s={key:1,class:"font-medium flex-1"},Ms={class:"font-bold text-primary"},qs=["onClick"],Ts=["innerHTML"],Hs=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-warning text-bold"}," Click Here to Edit This Agenda Minute And Click save")],-1)),Ps={key:0},Rs=["onClick"],Fs=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Save")],-1)),Ns=[Fs],Gs={key:1},Ls={key:2},Os=["onClick"],Vs=v(()=>e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Save",-1)),Ds=[Vs],Bs={key:2},Us={key:0},Ws=["onClick"],Ys={class:"font-bold text-primary"},js=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Savexx")],-1)),Ks={key:1},Qs=["onClick"],zs=v(()=>e("div",{class:"badge bg-warning text-bold"}," Create Minute for main Agenda before Sub Agenda First",-1)),Xs=[zs],Js={key:1},Zs={key:2},Is=["onClick"],ei={class:"font-bold text-primary"},ti=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Savevv")],-1)),si={key:1},ii=["onClick"],ai=v(()=>e("div",{class:"badge bg-warning text-bold"}," Create Minute for main Agenda before Sub Agenda First",-1)),li=[ai],ni={key:1},oi=v(()=>e("p",{class:"m-0"},[e("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),di=[oi],ri=Fe({__name:"Minute",props:{defaultMinutes:Boolean},setup(N){const Y=Ne(),fe=Ge(),ye=Le(),j=N;function ke(){ye.back()}k(ke,"goBack");const K=Oe(),te=K.params.boardId;K.params.meetingId;const q=K.params.scheduleId;j.defaultMinutes,S(null);const V=S(null),C=S("create"),f=S(!1),se=S([]),P=S(null),ie=S(null),y=S(-1),g=S(-1),G=S(!1),R=S(!1),Q=S([{text:""}]),Ce=je(),xe=Ke({schedule_id:Qe().required(),board_id:H().nullable(),committee_id:ze().nullable(),membership_id:H().nullable(),minute_id:H().nullable(),agenda_id:H().required(),detail_minute_id:H().nullable(),subdetailminute_id:H().nullable(),subagenda_id:H().nullable(),description:H().required(),status:H().required()}),{handleSubmit:Se,setErrors:Ae,setFieldValue:b,values:ui}=Xe({validationSchema:xe,initialValues:{schedule_id:q,board_id:te,committee_id:null,membership_id:null,minute_id:V.value,agenda_id:"",detail_minute_id:null,subdetailminute_id:null,subagenda_id:null,description:"",status:"unpublished"}}),D=Se(async(t,{resetForm:d})=>{try{const r={schedule_id:t.schedule_id,committee_id:null,membership_id:null,minute_id:V.value?V.value.toString():null,agenda_id:t.agenda_id.toString(),detail_minute_id:t.detail_minute_id?t.detail_minute_id.toString():null,subdetailminute_id:t.subdetailminute_id?t.subdetailminute_id.toString():null,subagenda_id:t.subagenda_id?t.subagenda_id.toString():null,description:t.description,status:t.status};C.value==="create"?f.value?await Je(r,q):R.value&&await Ze(r,q):y.value!==-1?(await Ie(r,q),console.log("payload",r)):g.value!==-1&&await et(r,q),await L(),B()}catch(r){r instanceof Ve?Ae(r.messages):Ce(r)}}),B=k(()=>{C.value="create",f.value=!1,P.value=null,ie.value=null,y.value=-1,g.value=-1,G.value=!1,R.value=!1,b("schedule_id",q),b("board_id",te),b("committee_id",null),b("membership_id",null),b("minute_id",V.value),b("agenda_id",""),b("detail_minute_id",null),b("subdetailminute_id",null),b("subagenda_id",null),b("description",""),b("status","unpublished")},"reset"),z=k(t=>{B(),R.value=!0,P.value=t.id,G.value=!1,f.value=!1,g.value=-1,y.value=-1,C.value="create",b("agenda_id",t.id)},"enableAddingNewParent"),U=k((t,d,r,_)=>{B(),f.value=!0,P.value=r.id,g.value=t,y.value=d,b("agenda_id",r.id),b("subagenda_id",_.id),G.value=!1,C.value="create",ie.value=_.id},"enableAddingChild");T(()=>{const t=f.value&&P.value===agenda.id&&g.value===pIndex&&y.value===cIndex&&C.value==="create";return console.log("isAddingChild computed:",t),t}),T(()=>{const t=G.value&&!R.value&&!f.value&&C.value==="edit";return console.log("isEditing computed:",t),t});const ae=k((t,d,r,_,c)=>{B(),G.value=!0,R.value=!1,f.value=!1,g.value=t,y.value=d,C.value="edit",console.log("pIndex: number, cIndex:",t,d),console.log("States after enabling adding child:",{is_editing:G.value,isAddingNewParent:R.value,addingChild:f.value,editingParentIndex:g.value,editingChildIndex:y.value,action:C.value}),b("agenda_id",r.id),y.value!==-1?(b("subdetailminute_id",c.id),b("detail_minute_id",c.detail_minute_id),b("subagenda_id",c.subagenda_id),b("description",c.description)):g.value!==-1&&(b("detail_minute_id",_.id),b("description",_.description))},"enableEditing"),we=k(()=>ut({queryKey:["getMinutesKey",q],queryFn:async()=>{const t=await nt(q,{paginate:"false"});return V.value=t.data.id,t.data},onSuccess:t=>{},onError:t=>{console.error("Failed to fetch minutes:",t)}}),"getMinutes"),{isLoading:ci,data:s,refetch:L}=we(),X=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>c.rsvp_status==="Yes"&&c.attendance_status==="Attended"))||[]:[]}),J=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>c.rsvp_status==="Online"&&c.attendance_status==="Attended"))||[]:[]}),Z=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>["Yes","No","Maybe"].includes(c.rsvp_status)&&c.attendance_status==="Absent"))||[]:[]}),I=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>c.rsvp_status==="Pending"&&c.attendance_status==="Absent"))||[]:[]}),Ee=k(async()=>{const t=await tt(q,{paginate:"false"});se.value=t.data},"getmeetingagendas"),ee=T(()=>{if(j.defaultMinutes)return se.value});De(async()=>{await L(),j.defaultMinutes&&Ee()}),Be(()=>Q==null?void 0:Q.value,t=>{t&&(V.value=t)},{deep:!0});const x=T(()=>{var d;const t={};return s!=null&&s.value&&(s!=null&&s.value.detailminutes)&&((d=s==null?void 0:s.value.detailminutes)==null||d.forEach(r=>{var _;t[r.agenda_id]||(t[r.agenda_id]=[]),t[r.agenda_id].push(r),(_=r.subdetailminutes)==null||_.forEach(c=>{t[c.subagenda_id]||(t[c.subagenda_id]=[]),t[c.subagenda_id].push(c)})})),t}),le=T(()=>fe.getSettings()),$e=k(async t=>{await st(t),await L()},"onDeleteMinutes"),Me=k(async t=>{await it(t),await L()},"onGetMinutesSignatures"),qe=k(async t=>{await at(t),await L()},"onCEOApproval"),Te=k(async t=>{await lt(t),await L()},"onGetPublishMinutes"),He=k(async t=>{await ot(t),await L()},"onCloseMeeting");return(t,d)=>{var r,_,c,ne,oe,de,re,ue,ce,_e,ve,be,me,he;return o(Y).hasPermission(["create minutes","edit minutes","create minutes"])?(i(),a("div",ct,[e("div",_t,[o(s)?(i(),a("div",vt,[e("div",bt,[e("div",mt,[e("a",{href:"",onClick:F(ke,["prevent"]),class:"text-blue-primary"},[ht,M(" Go back To Meeting ")])]),o(s)?(i(),a("div",pt,[((_=(r=o(s))==null?void 0:r.schedule)==null?void 0:_.closestatus)==="closed"?(i(),a("button",gt,[ft,M(" Meeting Closed ")])):(i(),a("button",{key:1,type:"button",class:"btn btn-sm mr-1 btn-success btn-lg",onClick:d[0]||(d[0]=F(l=>{var n;return He((n=o(s))==null?void 0:n.schedule.id)},["prevent"]))},[yt,M(" Close Meeting ")])),((c=o(s))==null?void 0:c.approvalstatus)==="approved"?(i(),a("button",kt,[Ct,M(" This Minutes are Approved ")])):(i(),a("button",{key:3,type:"button",class:"btn btn-sm mr-1 btn-warning btn-lg",onClick:d[1]||(d[1]=F(l=>{var n;return qe((n=o(s))==null?void 0:n.id)},["prevent"]))},[xt,M(" Send Approval to CEO ")])),(ne=o(s))!=null&&ne.detailminutes?(i(),a("button",{key:4,type:"button",class:"btn btn-sm mr-1 btn-danger btn-lg",onClick:d[2]||(d[2]=F(l=>{var n;return $e((n=o(s))==null?void 0:n.id)},["prevent"]))},[St,M(" Delete Minutes ")])):p("",!0),e("button",{type:"button",class:"btn btn-sm mr-1 btn-primary btn-lg",onClick:d[3]||(d[3]=F(l=>{var n;return Me((n=o(s))==null?void 0:n.id)},["prevent"]))},[At,M(" Get Signatures ")]),e("button",{type:"button",class:"btn btn-sm mr-1 btn-success btn-lg",onClick:d[4]||(d[4]=F(l=>{var n;return Te((n=o(s))==null?void 0:n.id)},["prevent"]))},[wt,M(" Publish Minutes ")])])):p("",!0)])])):p("",!0),e("div",Et,[$t,e("div",Mt,[e("img",{src:o(dt)((oe=le.value)==null?void 0:oe.logo),alt:"Organization Logo",class:"img-fluid logo"},null,8,qt)]),e("div",Tt,u((de=le.value)==null?void 0:de.name),1),Ht,e("h4",Pt,"MINUTES OF THE "+u((ue=(re=o(s))==null?void 0:re.meeting)==null?void 0:ue.title),1),e("p",Rt," HELD AT "+u((_e=(ce=o(s))==null?void 0:ce.meeting)==null?void 0:_e.location)+" ON "+u(o(rt)((be=(ve=o(s))==null?void 0:ve.schedule)==null?void 0:be.date))+" STARTING AT "+u((he=(me=o(s))==null?void 0:me.schedule)==null?void 0:he.start_time),1),X.value.length?(i(),a("h5",Ft,"Present")):p("",!0),X.value.length?(i(),a("table",Nt,[e("tbody",null,[(i(!0),a(A,null,w(X.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Gt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",Lt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),J.value.length?(i(),a("h5",Ot,"Present on E-platform ")):p("",!0),J.value.length?(i(),a("table",Vt,[e("tbody",null,[(i(!0),a(A,null,w(J.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Dt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",Bt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),Z.value.length?(i(),a("h5",Ut,"Absent With Apology ")):p("",!0),Z.value.length?(i(),a("table",Wt,[e("tbody",null,[(i(!0),a(A,null,w(Z.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Yt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",jt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),I.value.length?(i(),a("h5",Kt," Absent ")):p("",!0),I.value.length?(i(),a("table",Qt,[e("tbody",null,[(i(!0),a(A,null,w(I.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",zt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",Xt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),Jt,e("ul",Zt,[(i(!0),a(A,null,w(ee.value,(l,n)=>(i(),a(A,{key:l.id},[e("li",null,u(n+1)+". "+u(l.title),1),e("ul",It,[(i(!0),a(A,null,w(l.children,(m,h)=>(i(),a("li",{key:m.id},u(n+1)+"."+u(h+1)+" "+u(m.title),1))),128))])],64))),128))]),e("div",es,[e("div",ts,[e("div",ss,[e("div",is,[e("div",as,[e("div",ls,[ee.value?(i(),a("ol",ns,[(i(!0),a(A,null,w(ee.value,(l,n)=>(i(),a("li",{class:"mb-2 hover:border-gray-400",key:n},[e("div",os,[e("div",ds,[g.value===n&&y.value===-1&&C.value==="edit"||R.value&&P.value===l.id&&y.value===-1&&C.value==="create"?(i(),a("div",rs,[e("div",us,[e("form",{novalidate:"",onSubmit:d[5]||(d[5]=F((...m)=>o(D)&&o(D)(...m),["prevent"]))},[e("div",cs,[pe(ge,{label:`${o(O)(o(E)(n),l.title)}`,name:"description",theme:"snow",placeholder:"Enter minute description and hit save",toolbar:"full",contentType:"html",class:"minute-input"},null,8,["label"]),_s])],32)])])):(i(),a("div",vs,[(i(!0),a(A,null,w(x.value[l.id],(m,h)=>(i(),a("div",{key:h,onClick:$=>ae(n,-1,l,m,void 0)},[e("div",ms,u(o(O)(o(E)(n),l.title)),1),e("div",{innerHTML:m.description},null,8,hs),ps],8,bs))),128)),x.value[l.id]?p("",!0):(i(),a("div",{key:0,onClick:m=>z(l)},[e("div",fs,u(o(O)(o(E)(n),l.title)),1),ys],8,gs))]))])]),l.children?(i(),a("ol",ks,[(i(!0),a(A,null,w(l.children,(m,h)=>(i(),a("li",{class:"mb-2 hover:border-gray-400",draggable:"false",key:h},[e("div",Cs,[e("div",xs,[f.value&&P.value===l.id&&g.value===n&&y.value===h&&C.value==="create"||G.value&&!R.value&&!f.value&&g.value===n&&y.value===h&&C.value==="edit"?(i(),a("div",Ss,[e("div",As,[e("form",{novalidate:"",onSubmit:d[6]||(d[6]=F((...$)=>o(D)&&o(D)(...$),["prevent"]))},[e("div",ws,[pe(ge,{label:`${o(O)(o(E)(n),m.title,void 0,void 0,void 0,o(E)(h))}`,name:"description",theme:"snow",placeholder:"Enter minute description and hit save",toolbar:"full",contentType:"html",class:"minute-input"},null,8,["label"]),Es])],32)])])):(i(),a("div",$s,[e("div",Ms,u(o(O)(o(E)(n),m.title,void 0,void 0,void 0,o(E)(h))),1),(i(!0),a(A,null,w(x.value[l.id],($,Pe)=>(i(),a("div",{key:Pe},[(i(!0),a(A,null,w(x.value[m.id],W=>(i(),a("div",{key:W.id},[W.subagenda_id===m.id?(i(),a("div",{key:0,onClick:_i=>ae(n,h,l,$,W)},[e("div",{innerHTML:W.description},null,8,Ts),Hs],8,qs)):p("",!0)]))),128))]))),128)),x.value[m.id]?p("",!0):(i(),a("div",Ps,[g.value!==n&&!f.value?(i(),a("div",{key:0,onClick:$=>U(n,h,l,m)},Ns,8,Rs)):f.value&&P.value===l.id&&g.value===n&&y.value===h?(i(),a("div",Gs)):(i(),a("div",Ls,[e("div",{class:"font-medium",onClick:$=>U(n,h,l,m)},Ds,8,Os)]))]))])),M(),x.value[l.id]?p("",!0):(i(),a("div",Bs,[g.value!==n&&!f.value?(i(),a("div",Us,[x.value&&x.value[l.id]&&x.value[l.id].length>0?(i(),a("div",{key:0,onClick:$=>U(n,h,l,m)},[e("div",Ys,u(o(O)(o(E)(n),m.title,void 0,void 0,void 0,o(E)(h))),1),js],8,Ws)):(i(),a("div",Ks,[e("div",{class:"font-medium",onClick:$=>z(l)},Xs,8,Qs)]))])):f.value&&P.value===l.id&&g.value===n&&y.value===h?(i(),a("div",Js)):(i(),a("div",Zs,[x.value&&x.value[l.id]&&x.value[l.id].length>0?(i(),a("div",{key:0,onClick:$=>U(n,h,l,m)},[e("div",ei,u(o(O)(o(E)(n),m.title,void 0,void 0,void 0,o(E)(h))),1),ti],8,Is)):(i(),a("div",si,[e("div",{class:"font-medium",onClick:$=>z(l)},li,8,ii),M("> ")]))]))]))])])]))),128))])):p("",!0)]))),128))])):p("",!0)])])])])])])])])])):(i(),a("div",ni,di))}}});const xi=Ye(ri,[["__scopeId","data-v-aa1f2d89"]]);export{xi as default};
