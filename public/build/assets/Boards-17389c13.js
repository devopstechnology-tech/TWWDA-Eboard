var ve=Object.defineProperty;var n=(w,_)=>ve(w,"name",{value:_,configurable:!0});import{d as fe,i as pe,r as c,V as L,C as A,P as _e,b as K,u as o,o as m,c as f,e,a1 as C,F as he,T as be,t as p,f as B,R as G,h as x,w as H,g as O,l as ge,$ as xe,a0 as we,_ as ye}from"./main-d97516e2.js";import{u as Ce,d as Be,c as ke,a as Q,b as Ie,e as Me}from"./useUnexpectedErrorHandler-01ee037e.js";import{a as qe,b as Se,c as Ee,d as Fe,e as Ue}from"./useBoardRequest-eb8bdd66.js";import{a as Re,b as Ve,c as $e,d as De}from"./useCommitteeRequest-787b5c72.js";import{u as Ne}from"./useStaffRequest-cb748c9e.js";import{F as Pe}from"./FormInput-19d746f6.js";import{F as je}from"./FormQuillEditor-3e5c8bfd.js";import{F as z}from"./FormUpload-a6d2fc77.js";import{r as Te,a as Le,b as Ae,s as Y,i as Ke,u as J,c as Ge,d as W}from"./Breadcrumb-62de853f.js";import{u as X}from"./useQuery-f8736dfe.js";import"./index-a4206e89.js";import"./staff_routes-2c9640ed.js";import"./useQueryClient-99479e2d.js";const u=n(w=>(xe("data-v-fd70e538"),w=w(),we(),w),"_withScopeId"),He={key:0,class:"container-fluid"},Oe={class:"row"},Qe={class:"col-12"},ze={class:"card"},Ye={class:"card-header d-flex justify-content-between"},Je=u(()=>e("h2",{class:"card-header-title h3"},"Boards",-1)),We={class:"ml-auto flex items-center space-x-2"},Xe={class:"card-body"},Ze={class:"row"},et={class:"card-body"},tt={class:"row"},st={class:"info-box shadow-lg p-4 mb-4 d-flex flex-column flex-grow-1"},at={class:"d-flex flex-column flex-grow-1 align-items-center"},ot=["src"],lt={class:"ml-3 flex-1 w-100"},it={key:0,class:"h2 mb-2"},rt={class:"text-gray-900 m-0"},nt={key:1},dt=u(()=>e("br",null,null,-1)),ct=["onClick"],mt=u(()=>e("i",{class:"fa fa-plus mr-2"},null,-1)),ut=["innerHTML"],vt={class:"d-flex justify-content-end mt-2 w-100"},ft=["onClick"],pt=u(()=>e("i",{class:"fa fa-edit"},null,-1)),_t=[pt],ht=["onClick"],bt=u(()=>e("i",{class:"fa fa-trash-alt"},null,-1)),gt=[bt],xt=u(()=>e("i",{class:"fa fa-eye"},null,-1)),wt={class:"flex justify-center items-center min-h-screen"},yt={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},Ct={class:"font-bold text-lg text-center"},Bt=u(()=>e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕",-1)),kt={class:"overflow-auto p-4",style:{"max-height":"80vh"}},It={class:"grid grid-cols-1 md:grid-cols-2 gap-4 p-2"},Mt={class:"col-span-2"},qt={class:"flex flex-wrap -mx-2"},St={class:"w-full md:w-1/3 px-1 md:px-2 mb-4"},Et={class:"w-full md:w-1/3 px-1 md:px-2 mb-4"},Ft=["src"],Ut={class:"w-full md:w-1/3 px-1 md:px-2 mb-4"},Rt=["src"],Vt={type:"submit",class:"btn btn-primary btn-md w-full mt-6"},$t={class:"flex justify-center col-md-6"},Dt={method:"dialog",class:"modal-box rounded-xl"},Nt=u(()=>e("h3",{class:"font-bold text-lg justify-center flex"},p("Add Members"),-1)),Pt=u(()=>e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕",-1)),jt={class:"w-full mt-6 p-2"},Tt={class:"font-thin text-sm flex flex-col items-center gap-6"},Lt={key:0,class:"message"},At=u(()=>e("button",{type:"submit",class:"btn btn-md mb-1 w-full pt-1 text-red-600 mt-6 bg-primary"},p("Add Members"),-1)),Kt={key:1,class:"container-fluid"},Gt=u(()=>e("p",{class:"m-0"},[e("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),Ht=[Gt],Ot=fe({__name:"Boards",setup(w){const _=pe(),y=c(!1),d=c("create"),l=c("board"),I=c(null),b=c(""),k=c(""),g=c([]),M=c(null),q=c(null),S=c([]);c([]);const R=Ce(),V=Be().test("fileOrString","Must be a file or a string",t=>t instanceof File||typeof t=="string"),Z=ke({name:Q().required("Name is required"),description:Q().required("Description is required"),icon:V.required("Icon is required"),cover:V.required("Cover is required")}),{handleSubmit:ee,setErrors:$,setFieldValue:h,values:D}=Ie({validationSchema:Z,initialValues:{name:"",description:"",icon:"",cover:""}}),N=ee(async t=>{var s,i,v;try{const r={name:t.name,description:t.description,icon:t.icon,cover:t.cover};l.value==="board"?d.value==="create"?await qe(r):d.value==="edit"&&(s=I.value)!=null&&s.id&&(console.log("Selected Board ID:",I.value.id),await Se(r,I.value.id)):l.value==="committee"&&(d.value==="create"?await Re(r,b.value):d.value==="edit"&&await Ve(r,k.value)),(i=M.value)==null||i.close(),(v=q.value)==null||v.close(),l.value==="board"&&await F(),l.value==="committee"&&await U(),Te(),Le(),P(),g.value=[],y.value=!1}catch(r){r instanceof L?$(r.messages):R(r)}}),te=n(async()=>{var t;try{if(l.value==="board"){const s={members:g.value};await Ee(s,b.value)}else if(l.value==="committee"){const s={members:g.value};await $e(s,b.value,k.value)}(t=q.value)==null||t.close(),l.value==="board"&&await F(),l.value==="committee"&&await U(),P(),g.value=[],y.value=!1}catch(s){s instanceof L?$(s.messages):R(s)}},"onSubmitMembers"),{errorMessage:E}=Me("members"),se=n((t,s)=>{var i;s==="board"?l.value="board":s==="committee"&&(b.value=t,l.value="committee"),d.value="create",y.value=!0,(i=M.value)==null||i.showModal()},"openCreateModal"),ae=n((t,s)=>{var i;I.value=t,h("name",t.name),h("description",t.description),h("icon",t.icon),h("cover",t.cover),W(t.cover),J(t.icon),s==="board"?l.value="board":s==="committee"&&(k.value=t.id,l.value="committee"),d.value="edit",y.value=!0,(i=M.value)==null||i.showModal()},"openEditModal"),P=n(()=>{h("name",""),h("description",""),h("icon",""),h("cover",""),d.value="create",l.value="board",y.value=!0,b.value="",k.value=""},"resetBoardForm"),oe=n((t,s)=>{var v;console.log("ff",t);const i=t.members.map(r=>r.user.id.toString());g.value=i,d.value="members",s==="board"?(l.value="board",b.value=t.id):s==="committee"&&(k.value=t.id,b.value=t.committeeable.details.id,l.value="committee"),y.value=!0,(v=q.value)==null||v.showModal()},"openEditMembersModal"),le=n(()=>{},"selectedUsers"),ie=n(()=>{},"removeSelectedUsers"),re=n(async t=>{await Fe(t.id),await F(),await U()},"deleteBoard"),ne=A(()=>{var s;const t=[];return S.value&&((s=S.value)==null?void 0:s.length)>0&&S.value.reduce((i,v)=>(i.push({id:v.id,name:`${v.full_name}`}),i),t),t}),de=n(async()=>{const t=await Ne({paginate:"false"});S.value=t.data},"getUsers");_e(async()=>{window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Boards & Committees"})),de()});const ce=n(()=>X({queryKey:["getBoardsKey"],queryFn:async()=>(await Ue({paginate:"false"})).data}),"getBoards"),{isLoading:Qt,data:me,refetch:F}=ce(),ue=n(()=>X({queryKey:["getCommitteesKey"],queryFn:async()=>(await De({paginate:"false"})).data}),"getCommittees"),{isLoading:zt,data:Yt,refetch:U}=ue(),j=A(()=>d.value==="create"&&l.value==="board"?"Create Board":d.value==="edit"&&l.value==="board"?"Edit Board":d.value==="create"&&l.value==="committee"?"Create Committee":d.value==="edit"&&l.value==="committee"?"Edit Committee":"");return(t,s)=>{var r;const i=K("router-link"),v=K("Multiselect");return o(_).hasPermission(["view board"])?(m(),f("div",He,[e("div",Oe,[e("div",Qe,[e("div",ze,[e("div",Ye,[Je,e("div",We,[e("button",{class:"btn btn-primary btn-sm",onClick:s[0]||(s[0]=C(a=>se("","board"),["prevent"]))}," New Board ")])]),e("div",Xe,[e("div",Ze,[e("div",et,[e("div",tt,[(m(!0),f(he,null,be(o(me),a=>(m(),f("div",{class:"col-md-4 col-6 d-flex",key:a.id},[e("div",st,[e("div",at,[e("img",{class:"img-circle elevation-2",src:o(Ae)(a.icon),alt:"User Avatar",style:{width:"128px",height:"128px"}},null,8,ot),e("div",lt,[o(_).hasPermission(["view board"])?(m(),f("h3",it,[B(i,{to:{name:"BoardDetails",params:{boardId:a.id}},class:"badge badge-soft bg-primary text-wrap"},{default:H(()=>[O(p(a.name),1)]),_:2},1032,["to"])])):x("",!0),e("p",rt," Owner: "+p(a.owner),1),a.members?(m(),f("div",nt,[e("span",null,p(a.members.length)+" "+p(a.members.length===1?"Member":"Members"),1),dt,o(_).hasPermission(["add member to board"])?(m(),f("a",{key:0,href:"",onClick:C(T=>oe(a,"board"),["prevent"]),class:"text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out"},[mt,O(" Members ")],8,ct)):x("",!0)])):x("",!0),e("p",{class:"text-muted m-0 truncate",innerHTML:a.description},null,8,ut)])]),e("div",vt,[o(_).hasPermission(["edit board"])?(m(),f("a",{key:0,href:"",onClick:C(T=>ae(a,"board"),["prevent"]),class:"text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out mr-2"},_t,8,ft)):x("",!0),o(_).hasPermission(["delete board"])?(m(),f("a",{key:1,href:"",onClick:C(T=>re(a),["prevent"]),class:"text-blue-500 hover:text-blue-700 transition duration-150 ease-in-out mr-2"},gt,8,ht)):x("",!0),o(_).hasPermission(["view board"])?(m(),ge(i,{key:2,to:{name:"BoardDetails",params:{boardId:a.id}},class:"text-green-500 hover:text-green-700 transition duration-150 ease-in-out"},{default:H(()=>[xt]),_:2},1032,["to"])):x("",!0)])])]))),128))])])])])])])]),e("div",wt,[e("dialog",{id:"boardModal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"BoardModal",ref:M},[e("form",yt,[e("h3",Ct,p(j.value),1),Bt,e("div",kt,[e("div",It,[e("div",Mt,[e("form",{novalidate:"",onSubmit:s[3]||(s[3]=C((...a)=>o(N)&&o(N)(...a),["prevent"])),class:""},[e("div",qt,[e("div",St,[B(Pe,{labeled:!0,label:"Name",name:"name",class:"w-full text-sm text-white tracking-wide",placeholder:"Enter Name",type:"text"})]),e("div",Et,[B(z,{labeled:!0,label:"Upload icon Image",name:"icon",class:"w-full text-sm text-white tracking-wide",placeholder:"Enter icon Image",type:"file",accept:o(Y).join(", "),onChange:s[1]||(s[1]=a=>o(Ke)(a))},null,8,["accept"]),e("img",{src:o(J)((r=o(D))==null?void 0:r.icon),class:"file_attachment"},null,8,Ft)]),e("div",Ut,[B(z,{labeled:!0,label:"Upload Cover Image",name:"cover",class:"w-full text-sm text-white tracking-wide",placeholder:"Enter Cover Image",type:"file",accept:o(Y).join(", "),onChange:s[2]||(s[2]=a=>o(Ge)(a))},null,8,["accept"]),e("img",{src:o(W)(o(D).cover),class:"file_attachment"},null,8,Rt)])]),B(je,{label:"Description",name:"description",theme:"snow",placeholder:"Enter Description",toolbar:"full",contentType:"html",class:"col-span-3 mb-4"}),e("button",Vt,p(j.value),1)],32)])])])])],512)]),e("div",$t,[e("dialog",{id:"membersmodal",class:"modal",ref_key:"membersmodal",ref:q},[e("form",Dt,[Nt,Pt,e("div",jt,[e("div",Tt,[e("form",{novalidate:"",onSubmit:C(te,["prevent"]),class:"w-full rounded-xl mx-auto p-1 custom-modal"},[e("div",{class:G(["multiselect-container",{error:!!o(E)}])},[B(v,{id:"members",modelValue:g.value,"onUpdate:modelValue":s[4]||(s[4]=a=>g.value=a),mode:"tags",placeholder:"Choose your stack","close-on-select":!1,"filter-results":!1,"min-chars":1,"resolve-on-load":!1,delay:0,searchable:!0,options:ne.value,valueProp:"id",trackBy:"id",label:"name",class:G(["multiselect-container",{error:!!o(E)}]),onSelect:s[5]||(s[5]=a=>le()),onDeselect:s[6]||(s[6]=a=>ie())},null,8,["modelValue","options","class"]),o(E)?(m(),f("div",Lt,p(o(E)),1)):x("",!0)],2),At],32)])])])],512)])])):(m(),f("div",Kt,Ht))}}});const cs=ye(Ot,[["__scopeId","data-v-fd70e538"]]);export{cs as default};
