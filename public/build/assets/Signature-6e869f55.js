var N=Object.defineProperty;var i=(s,o)=>N(s,"name",{value:o,configurable:!0});import{q as x,d as G,j as H,k as K,i as O,r as _,P as Q,a6 as W,H as X,o as z,c as J,e as r,T as F,g as Y,u as Z,W as ee,X as te,ab as ae,a7 as ne,_ as se}from"./main-6dda9e4d.js";import{u as oe,c as ie,a as I,d as re,b as ce,V as de}from"./useUnexpectedErrorHandler-26b06961.js";import{A as U}from"./attendance_routes-4ebad1f2.js";import{t as le,E as ue}from"./Breadcrumb-6e28567b.js";import{u as pe}from"./pspdfkit.store-7d314516.js";import{u as me}from"./useQuery-93a34df9.js";import"./useQueryClient-918ce480.js";async function fe(s,o){return await x().get(U()+"/signature/"+s+"/"+o).json()}i(fe,"useGetSignatureFileRequest");async function he(s,o,f){const p=x(),n=new FormData;return n.append("id",s.id),n.append("name",s.name),n.append("signatureupload",s.signatureupload),await p.post(U()+"/update/signature/"+o+"/"+f,{body:n}).json()}i(he,"useUpdateSignatureFileRequest");const w=i(s=>(ee("data-v-26e02688"),s=s(),te(),s),"_withScopeId"),ge={class:"card"},_e={class:"card-header flex items-center h-auto p-4"},we={class:"flex items-center flex-1 w-full"},be=w(()=>r("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),ye={class:"flex items-center space-x-2"},ve=["disabled"],Se=w(()=>r("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),Fe=w(()=>r("span",{class:"text-blue-primary font-bold"},"Save File",-1)),Ie=[Se,Fe],xe={class:"card-body"},Ue=G({__name:"Signature",setup(s){const o=H(),f=K();O();const p=_(""),n=pe(),l=_(null),k=oe(),P=o.params.boardId,h=o.params.attendeeId,R=o.params.meetingId,E=o.params.scheduleId,b=o.params.mediaId,g=_(""),C=ie({id:I().required(),name:I().required(),signatureupload:re().nullable()}),{handleSubmit:$,setErrors:B,setFieldValue:y,values:ke}=ce({validationSchema:C,initialValues:{id:h,name:"",signatureupload:null}}),V=i(async()=>{const e=await n.savePdf(g.value);y("signatureupload",e),y("name",g.value),await T(),await q()},"savePdf"),q=$(async e=>{try{const t={id:e.id,name:e.name,signatureupload:e.signatureupload},a=await he(t,h,b);await v(a.data)}catch(t){n.unloadPdf(l.value),t instanceof de?B(t.message):k(t)}});function D(e){const t=new URL(window.location),a=t.pathname.split("/");a[a.length-1]=e,t.pathname=a.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}i(D,"updateMediaIdInURL");const j=i(()=>{n.unloadPdf(l.value),f.push({name:"BoardMeetingDetails",params:{boardId:P,meetingId:R,scheduleId:E}})},"goBack"),A=i(async e=>{var t,a;if(n.instance&&e.attendance_status==="Absent"){const c={meeting:e.schedule.meeting.title,schedule:le((t=e==null?void 0:e.schedule)==null?void 0:t.date),name:(a=e==null?void 0:e.membership)==null?void 0:a.user.full_name,date:ue(new Date),position:e==null?void 0:e.membership.position.name},u={};for(const[m,d]of Object.entries(c))u[m]=d;await n.instance.setFormFieldValues(u)}},"populateFormFields"),v=i(e=>{if(n.unloadPdf(l.value),e&&e.file){const t=e.file,a=window.atob(t),c=a.length,u=new Uint8Array(c);for(let d=0;d<c;d++)u[d]=a.charCodeAt(d);g.value=e.fileName,D(e.mediaId);const m=new Blob([u],{type:"application/pdf"});p.value=URL.createObjectURL(m),n.setPdfFile(p.value)}},"openFile"),L=i(()=>me({queryKey:["getFileKey"],queryFn:async()=>{const e=await fe(h,b);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await v(e.data),e.data}}),"getSignatureFile"),T=i(async()=>{try{const e="4b60149b61646d",t=await ae.get(`https://ipinfo.io?token=${e}`),{ip:a,city:c,region:u,country:m}=t.data,d=`${a}, ${c}, ${u}, ${m}`;return{ip:a,location:d}}catch(e){return console.error("Error fetching IP address and location:",e),{ip:"Unknown IP",location:"Unknown IP, Unknown City, Unknown Region, Unknown Country"}}},"getCurrentLocation");Q(async()=>{await M()}),W(()=>{n.unloadPdf(l.value)});const{isLoading:Pe,data:S,refetch:M}=L();return X(()=>n.pdfFile,async()=>{var t,a;const e=document.getElementById("app").dataset.appUrl;if(await n.loadPdf(l.value,e),await ne(),(t=S.value)!=null&&t.attendance){const c=(a=S.value)==null?void 0:a.attendance;A(c)}},{immediate:!0}),(e,t)=>(z(),J("div",ge,[r("div",_e,[r("div",we,[r("a",{href:"",onClick:t[0]||(t[0]=F(a=>j(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[be,Y(" Go back to The Meeting ")])]),r("div",ye,[r("button",{type:"button",onClick:F(V,["prevent"]),disabled:!Z(n).instance,class:"btn btn-tool"},Ie,8,ve)])]),r("div",xe,[r("div",{ref_key:"containerRef",ref:l,style:{width:"100%",height:"450px"}},null,512)])]))}});const je=se(Ue,[["__scopeId","data-v-26e02688"]]);export{je as default};
