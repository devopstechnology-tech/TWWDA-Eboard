var Y=Object.defineProperty;var l=(P,b)=>Y(P,"name",{value:b,configurable:!0});import{d as Z,i as ee,j as te,r,V as se,P as oe,C as q,o as d,c,e,F as L,R as ne,u as w,t as h,T as x,f as ae,h as V,U as $,g as le}from"./main-dbb1f149.js";import{u as ie,e as re,c as de,a as k,b as ce}from"./useUnexpectedErrorHandler-4e609aa9.js";import{i as ue,j as _e}from"./usePollRequest-5f714ee2.js";import{F as me}from"./FormRadioInput-9dcce75e.js";import{u as pe}from"./useQuery-c5d8918e.js";import"./index-78587978.js";import"./useQueryClient-785d5088.js";const he={class:"card h-full"},be=e("div",{class:"card-header flex items-center"},[e("div",{class:"flex items-center flex-1 w-full"},[e("h2",{class:"card-header-title h3"}," Meeting Polls ")]),e("div",{class:"flex items-center space-x-2"})],-1),ge={id:"poll-asignee-list"},ve={class:"table table-striped card-table"},fe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort asc","data-sort":"poll-title"}," Poll Title ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"due-date"}," Due Date ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"status"}," Status ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"vote-stats"},"Vote Stats ")]),e("th",{scope:"col",class:"text-bold text-center"},"Action")])],-1),ye={class:"list"},we={class:"poll-title","data-name":"poll.name",style:{"max-width":"200px","word-wrap":"break-word"}},xe={class:"font-weight-bold"},Ve=["innerHTML"],ke=["innerHTML"],Pe={key:0,class:"text-center"},De={key:0},Me=["onClick"],Se=e("i",{class:"far fa-eye"},null,-1),Ce=[Se],Oe={key:1},Te=["onClick"],Fe=e("i",{class:"far fa-eye"},null,-1),qe=[Fe],Le={class:"flex justify-center items-center min-h-screen"},$e={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},Re=e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1),Ue={key:0,class:"overflow-auto p-4",style:{"max-height":"80vh"}},Ee=e("div",{class:"card-header"},[e("h3",{class:"card-title"},"Poll Details")],-1),He={class:"card-body"},Ie={class:"row"},Ne=e("dt",{class:"col-sm-3"},"Due",-1),je={class:"col-sm-9"},Ae=e("hr",null,null,-1),Be={class:"user-content text-primary"},ze=e("dt",{class:"text-muted"},"Description",-1),Ke=["innerHTML"],Ge={id:"form"},Je=e("div",{class:"alert alert-danger d-none",id:"validation-message"},null,-1),Qe={class:"form-group"},We=e("div",{class:"form-group"},[e("button",{class:"btn btn-primary",type:"submit"},"Submit")],-1),rt=Z({__name:"Polls",setup(P){const b=ee();b.initialize();const R=b.user.id,U=te(),D=r(!1),M=r("create");U.params.meetingId;const E=r(null),g=r(null);r([]),r([]),r([]);const v=r(null),f=r(null),H=ie();re("duedate");const I=de({poll_id:k().required(),poll_assignee_id:k().required(),selectedOption:k().required()}),{handleSubmit:N,setErrors:j,setFieldValue:u,values:Xe}=ce({validationSchema:I,initialValues:{poll_id:"",poll_assignee_id:"",selectedOption:""}}),S=N(async s=>{var o;try{const t={poll_id:s.poll_id,poll_assignee_id:s.poll_assignee_id,selectedOption:s.selectedOption};await ue(t,t.poll_id),await C(),A(),(o=f.value)==null||o.close()}catch(t){t instanceof se?j(t.messages):H(t)}}),A=l(()=>{M.value="create",D.value=!1,v.value=null,E.value=null,u("poll_id",""),u("poll_assignee_id",""),u("selectedOption","")},"reset"),B=l(()=>pe({queryKey:["getOwnPollsKey"],queryFn:async()=>(await _e({paginate:"false"})).data}),"getPolls"),{isLoading:Ye,data:z,refetch:C}=B();oe(async()=>{C(),window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Meeting Polls"}))});const O=l(s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),"formattedDateTime"),K=l(s=>G(s)?"bg-danger":"bg-success","dateBadgeClass"),G=l(s=>{const o=new Date,t=new Date(s);return o>t},"hasDueDatePassed"),J=l(s=>{const o=new Date,t=new Date(s),n=24*60*60*1e3;return t-o<n},"isDueSoon"),Q=l(s=>{if(!s.votes||s.votes.length===0)return"No votes yet";const o=s.votes.length,t=s.pollassignees.length;if(o>t)return console.error("Total votes exceed total members, which is unexpected."),"Voting data error";const n=s.votes.reduce((a,p)=>{const y=JSON.parse(p.option_id).id;return a[y]=(a[y]||0)+1,a},{}),i=Object.keys(n).reduce((a,p)=>n[a]>n[p]?a:p);if(!s.options.find(a=>a.id===i))return console.error("Most voted option not found in poll options."),"Voting data error";const X=t-o;return(n[i]/o*100).toFixed(1),`${s.options.map(a=>`${((n[a.id]||0)/o*100).toFixed(1)}% voted for ${a.title}`).join("<br>")}<br>Total votes: ${o} / ${X} not yet`},"calculateVoteStats"),W=l(s=>{switch(s){case"Backlog":return"badge bg-warning";case"Pending":return"badge bg-info";case"On Progress":return"badge bg-primary";case"Completed":return"badge bg-success";default:return"badge"}},"statusClass"),_=q(()=>v.value);q(()=>g.value);function T(s,o){const t=s.pollassignees.find(m=>m.user.id===o);if(!t)return!1;const n={assignee_id:t.id,user_id:t.user.id,full_name:t.user.full_name};return s.votes.some(m=>m.poll_id===s.id&&m.assignee_poll_id===n.assignee_id)}l(T,"checkIfVoted");const F=l(s=>{var n;const o=s.pollassignees.find(i=>i.user.id===R),t={assignee_id:o.id,user_id:o.user.id,full_name:o.user.full_name};v.value=s,g.value=t,u("poll_id",s.id),u("poll_assignee_id",o.id),M.value="create",D.value=!0,(n=f.value)==null||n.showModal(),console.log(g.value)},"viewPoll");return(s,o)=>(d(),c(L,null,[e("div",he,[be,e("div",ge,[e("table",ve,[fe,e("tbody",ye,[(d(!0),c(L,null,ne(w(z),(t,n)=>(d(),c("tr",{key:n},[e("td",we,[e("div",xe,h(t.question),1),e("div",{innerHTML:t.description},null,8,Ve)]),e("td",{class:$(K(t.duedate))},[le(h(O(t.duedate))+" ",1),J(t.duedate)?(d(),c("button",{key:0,class:"btn btn-warning btn-sm",onClick:o[0]||(o[0]=(...i)=>s.sendReminder&&s.sendReminder(...i))}," Send Reminder ")):V("",!0)],2),e("td",null,[e("span",{class:$(W(t.status))},h(t.status),3)]),e("td",{innerHTML:Q(t)},null,8,ke),T(t)?(d(),c("td",Pe,[T(t)?(d(),c("div",De,[e("button",{type:"button",onClick:x(i=>F(t),["prevent"]),title:"",class:"mx-2 btn btn-sm btn-primary"},Ce,8,Me)])):(d(),c("div",Oe,[e("button",{type:"button",onClick:x(i=>F(t),["prevent"]),title:"",class:"mx-2 btn btn-sm btn-primary"},qe,8,Te)]))])):V("",!0)]))),128))])])])]),e("div",Le,[e("dialog",{id:"voteModal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"VoteModal",ref:f},[e("form",$e,[Re,_.value?(d(),c("div",Ue,[Ee,e("div",He,[e("dl",Ie,[Ne,e("dd",je,h(O(_.value.duedate)),1)]),Ae,e("div",Be,[e("dl",null,[ze,e("dd",null,[e("p",{innerHTML:_.value.description},null,8,Ke)]),e("dd",null,[e("p",null,h(_.value.question),1)])])]),e("div",Ge,[Je,e("form",{novalidate:"",onSubmit:o[1]||(o[1]=x((...t)=>w(S)&&w(S)(...t),["prevent"]))},[e("div",Qe,[ae(me,{label:"Poll Options",name:"selectedOption",options:_.value.options,inline:!0},null,8,["options"])]),We],32)])])])):V("",!0)])],512)])],64))}});export{rt as default};
