var Re=Object.defineProperty;var k=(N,j)=>Re(N,"name",{value:j,configurable:!0});import{d as Fe,i as Ne,n as Ge,k as Le,j as De,r as S,V as Oe,C as T,P as Ve,H as Be,u as o,o as i,c as a,e,a1 as F,g as M,h as p,t as u,F as A,T as w,f as pe,$ as Ue,a0 as Ye,_ as je}from"./main-d97516e2.js";import{u as Ke,c as Qe,d as We,a as H,b as ze}from"./useUnexpectedErrorHandler-01ee037e.js";import{i as Je,j as Xe,k as Ze,l as Ie,h as et,o as tt,p as st,n as it,q as at,r as lt}from"./useMinuteRequest-40fb106c.js";import{a as nt}from"./useScheduleRequest-76e80e8c.js";import{F as fe}from"./FormQuillEditor-3e5c8bfd.js";import{B as ot,f as dt,C as D,D as E}from"./Breadcrumb-62de853f.js";import{u as rt}from"./useQuery-f8736dfe.js";import"./index-a4206e89.js";import"./useQueryClient-99479e2d.js";const v=k(N=>(Ue("data-v-7fbb36de"),N=N(),Ye(),N),"_withScopeId"),ut={key:0},ct={class:"card card-widget shadow-lg"},_t={key:0,class:"card-footer"},vt={class:"d-flex align-items-center"},mt={class:"ml-3 flex-1"},bt=v(()=>e("i",{class:"fas fa-chevron-left"},null,-1)),ht={key:0,class:"ml-auto flex self-end"},pt={key:0,type:"button",class:"btn btn-sm mr-1 btn-success btn-lg"},ft=v(()=>e("i",{class:"fas fa-door-closed mr-1"},null,-1)),gt=v(()=>e("i",{class:"fas fa-door-closed mr-1"},null,-1)),yt={key:2,type:"button",class:"btn btn-sm mr-1 btn-warning btn-lg"},kt=v(()=>e("i",{class:"fa fa-check mr-1"},null,-1)),Ct=v(()=>e("i",{class:"fa fa-check mr-1"},null,-1)),xt=v(()=>e("i",{class:"fa fa-trash mr-1"},null,-1)),St=v(()=>e("i",{class:"fa fa-signature mr-1"},null,-1)),At=v(()=>e("i",{class:"fa fa-check mr-1"},null,-1)),wt={class:"card-body"},Et=v(()=>e("span",{class:"info-box-icon",style:{left:"4%","margin-left":"-45px",position:"absolute",top:"88px"}},[e("div",{class:"h3 text-bold font-bold uppercase text-primary"}," Confidential")],-1)),$t={class:"text-center logo-container"},Mt=["src"],qt={class:"h3 text-center text-primary text-bold font-bold uppercase"},Tt=v(()=>e("hr",{class:"thick-line"},null,-1)),Ht={class:"text-center text-primary text-bold uppercase h4"},Pt={class:"text-center text-primary text-bold uppercase h4"},Rt={key:0,class:"mt-2 text-primary text-bold uppercase"},Ft={key:1,class:"table table-borderless"},Nt={class:"p-0"},Gt={class:"p-0 text-primary text-bold uppercase"},Lt={key:2,class:"mt-2 text-primary text-bold uppercase"},Dt={key:3,class:"table table-borderless"},Ot={class:"p-0"},Vt={class:"p-0 text-primary text-bold uppercase"},Bt={key:4,class:"mt-2 text-primary text-bold uppercase"},Ut={key:5,class:"table table-borderless"},Yt={class:"p-0"},jt={class:"p-0 text-primary text-bold uppercase"},Kt={key:6,class:"mt-2 text-primary text-bold uppercase"},Qt={key:7,class:"table table-borderless"},Wt={class:"p-0"},zt={class:"p-0 text-primary text-bold uppercase"},Jt=v(()=>e("h5",{class:"mt-2 text-primary text-bold uppercase"},"Agenda",-1)),Xt={class:"list-unstyled"},Zt={class:"list-unstyled ml-4"},It={id:"MinutesEditor",class:"container"},es={class:"codex-editor"},ts={class:"codex-editor__redactor",style:{"padding-bottom":"300px"}},ss={class:"ce-block"},is={class:"flex w-full"},as={class:"flex-1"},ls={key:0,"data-list_format":"num_la_lr",class:"agenda-list mb-0 border-l border-blue"},ns={class:"rounded-lg border border-transparent hover:cursor-pointer border-blue -ml-7 p-2 pl-7 relative border-blue"},os={class:"flex gap-2 items-start"},ds={key:0,class:"font-medium flex-1"},rs={class:"text-sm text-gray-800 font-normal"},us={class:"flex gap-x-2"},cs=v(()=>e("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),_s={key:1,class:"font-medium flex-1"},vs=["onClick"],ms={class:"font-bold text-primary"},bs=["innerHTML"],hs=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-warning text-bold"}," Click Here to Edit This Agenda Minute And Click save")],-1)),ps=["onClick"],fs={class:"font-bold text-primary"},gs=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-info text-bold"}," Click Here to add Minutes for this Agenda and Click Save")],-1)),ys={key:0,class:"min-h-6 border-l border-blue"},ks={class:"rounded-lg border border-transparent hover:cursor-pointer border-blue -ml-7 p-2 pl-7 relative border-blue"},Cs={class:"flex gap-2 items-start"},xs={key:0,class:"font-medium flex-1"},Ss={class:"text-sm text-gray-800 font-normal"},As={class:"flex gap-x-2"},ws=v(()=>e("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),Es={key:1,class:"font-medium flex-1"},$s={class:"font-bold text-primary"},Ms=["onClick"],qs=["innerHTML"],Ts=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-warning text-bold"}," Click Here to Edit This Agenda Minute And Click save")],-1)),Hs={key:0},Ps=["onClick"],Rs=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Save")],-1)),Fs=[Rs],Ns={key:1},Gs={key:2},Ls=["onClick"],Ds=v(()=>e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Save",-1)),Os=[Ds],Vs={key:2},Bs={key:0},Us=["onClick"],Ys={class:"font-bold text-primary"},js=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Savexx")],-1)),Ks={key:1},Qs=["onClick"],Ws=v(()=>e("div",{class:"badge bg-warning text-bold"}," Create Minute for main Agenda before Sub Agenda First",-1)),zs=[Ws],Js={key:1},Xs={key:2},Zs=["onClick"],Is={class:"font-bold text-primary"},ei=v(()=>e("div",{class:"font-medium"},[e("div",{class:"badge bg-success text-bold"}," Click Here to add Minutes for this SubAgenda and Click Savevv")],-1)),ti={key:1},si=["onClick"],ii=v(()=>e("div",{class:"badge bg-warning text-bold"}," Create Minute for main Agenda before Sub Agenda First",-1)),ai=[ii],li={key:1},ni=v(()=>e("p",{class:"m-0"},[e("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),oi=[ni],di=Fe({__name:"Minute",props:{defaultMinutes:Boolean},setup(N){const j=Ne(),ge=Ge(),ye=Le(),K=N;function ke(){ye.back()}k(ke,"goBack");const Q=De(),W=Q.params.committeeId;Q.params.meetingId;const q=Q.params.scheduleId;K.defaultMinutes,S(null);const O=S(null),C=S("create"),g=S(!1),se=S([]),P=S(null),ie=S(null),y=S(-1),f=S(-1),G=S(!1),R=S(!1),z=S([{text:""}]),Ce=Ke(),xe=Qe({schedule_id:We().required(),committee_id:H().nullable(),membership_id:H().nullable(),minute_id:H().nullable(),agenda_id:H().required(),detail_minute_id:H().nullable(),subdetailminute_id:H().nullable(),subagenda_id:H().nullable(),description:H().required(),status:H().required()}),{handleSubmit:Se,setErrors:Ae,setFieldValue:m,values:ri}=ze({validationSchema:xe,initialValues:{schedule_id:q,committee_id:W,membership_id:null,minute_id:O.value,agenda_id:"",detail_minute_id:null,subdetailminute_id:null,subagenda_id:null,description:"",status:"unpublished"}}),V=Se(async(t,{resetForm:d})=>{try{const r={schedule_id:t.schedule_id,committee_id:W,membership_id:null,minute_id:O.value?O.value.toString():null,agenda_id:t.agenda_id.toString(),detail_minute_id:t.detail_minute_id?t.detail_minute_id.toString():null,subdetailminute_id:t.subdetailminute_id?t.subdetailminute_id.toString():null,subagenda_id:t.subagenda_id?t.subagenda_id.toString():null,description:t.description,status:t.status};C.value==="create"?g.value?await Je(r,q):R.value&&await Xe(r,q):y.value!==-1?(await Ze(r,q),console.log("payload",r)):f.value!==-1&&await Ie(r,q),await L(),B()}catch(r){r instanceof Oe?Ae(r.messages):Ce(r)}}),B=k(()=>{C.value="create",g.value=!1,P.value=null,ie.value=null,y.value=-1,f.value=-1,G.value=!1,R.value=!1,m("schedule_id",q),m("committee_id",W),m("membership_id",null),m("minute_id",O.value),m("agenda_id",""),m("detail_minute_id",null),m("subdetailminute_id",null),m("subagenda_id",null),m("description",""),m("status","unpublished")},"reset"),J=k(t=>{B(),R.value=!0,P.value=t.id,G.value=!1,g.value=!1,f.value=-1,y.value=-1,C.value="create",m("agenda_id",t.id)},"enableAddingNewParent"),U=k((t,d,r,_)=>{B(),g.value=!0,P.value=r.id,f.value=t,y.value=d,m("agenda_id",r.id),m("subagenda_id",_.id),G.value=!1,C.value="create",ie.value=_.id},"enableAddingChild");T(()=>{const t=g.value&&P.value===agenda.id&&f.value===pIndex&&y.value===cIndex&&C.value==="create";return console.log("isAddingChild computed:",t),t}),T(()=>{const t=G.value&&!R.value&&!g.value&&C.value==="edit";return console.log("isEditing computed:",t),t});const ae=k((t,d,r,_,c)=>{B(),G.value=!0,R.value=!1,g.value=!1,f.value=t,y.value=d,C.value="edit",console.log("pIndex: number, cIndex:",t,d),console.log("States after enabling adding child:",{is_editing:G.value,isAddingNewParent:R.value,addingChild:g.value,editingParentIndex:f.value,editingChildIndex:y.value,action:C.value}),m("agenda_id",r.id),y.value!==-1?(m("subdetailminute_id",c.id),m("detail_minute_id",c.detail_minute_id),m("subagenda_id",c.subagenda_id),m("description",c.description)):f.value!==-1&&(m("detail_minute_id",_.id),m("description",_.description))},"enableEditing"),we=k(()=>rt({queryKey:["getMinutesKey",q],queryFn:async()=>{const t=await lt(q,{paginate:"false"});return O.value=t.data.id,t.data},onSuccess:t=>{},onError:t=>{console.error("Failed to fetch minutes:",t)}}),"getMinutes"),{isLoading:ui,data:s,refetch:L}=we(),X=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>c.rsvp_status==="Yes"&&c.attendance_status==="Attended"))||[]:[]}),Z=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>c.rsvp_status==="Online"&&c.attendance_status==="Attended"))||[]:[]}),I=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>["Yes","No","Maybe"].includes(c.rsvp_status)&&c.attendance_status==="Absent"))||[]:[]}),ee=T(()=>{var t,d,r,_;return(t=s==null?void 0:s.value)!=null&&t.attendances&&((r=(d=s==null?void 0:s.value)==null?void 0:d.attendances)==null?void 0:r.length)>0?((_=s==null?void 0:s.value)==null?void 0:_.attendances.filter(c=>c.rsvp_status==="Pending"&&c.attendance_status==="Absent"))||[]:[]}),Ee=k(async()=>{const t=await et(q,{paginate:"false"});se.value=t.data},"getmeetingagendas"),te=T(()=>{if(K.defaultMinutes)return se.value});Ve(async()=>{await L(),K.defaultMinutes&&Ee()}),Be(()=>z==null?void 0:z.value,t=>{t&&(O.value=t)},{deep:!0});const x=T(()=>{var d;const t={};return s!=null&&s.value&&(s!=null&&s.value.detailminutes)&&((d=s==null?void 0:s.value.detailminutes)==null||d.forEach(r=>{var _;t[r.agenda_id]||(t[r.agenda_id]=[]),t[r.agenda_id].push(r),(_=r.subdetailminutes)==null||_.forEach(c=>{t[c.subagenda_id]||(t[c.subagenda_id]=[]),t[c.subagenda_id].push(c)})})),t}),le=T(()=>ge.getSettings()),$e=k(async t=>{await tt(t),await L()},"onDeleteMinutes"),Me=k(async t=>{await st(t),await L()},"onGetMinutesSignatures"),qe=k(async t=>{await it(t),await L()},"onCEOApproval"),Te=k(async t=>{await at(t),await L()},"onGetPublishMinutes"),He=k(async t=>{await nt(t),await L()},"onCloseMeeting");return(t,d)=>{var r,_,c,ne,oe,de,re,ue,ce,_e,ve,me,be,he;return o(j).hasPermission(["create minutes","edit minutes","create minutes"])?(i(),a("div",ut,[e("div",ct,[o(s)?(i(),a("div",_t,[e("div",vt,[e("div",mt,[e("a",{href:"",onClick:F(ke,["prevent"]),class:"text-blue-primary"},[bt,M(" Go back To Meeting ")])]),o(s)?(i(),a("div",ht,[((_=(r=o(s))==null?void 0:r.schedule)==null?void 0:_.closestatus)==="closed"?(i(),a("button",pt,[ft,M(" Meeting Closed ")])):(i(),a("button",{key:1,type:"button",class:"btn btn-sm mr-1 btn-success btn-lg",onClick:d[0]||(d[0]=F(l=>{var n;return He((n=o(s))==null?void 0:n.schedule.id)},["prevent"]))},[gt,M(" Close Meeting ")])),((c=o(s))==null?void 0:c.approvalstatus)==="approved"?(i(),a("button",yt,[kt,M(" This Minutes are Approved ")])):(i(),a("button",{key:3,type:"button",class:"btn btn-sm mr-1 btn-warning btn-lg",onClick:d[1]||(d[1]=F(l=>{var n;return qe((n=o(s))==null?void 0:n.id)},["prevent"]))},[Ct,M(" Send Approval to CEO ")])),(ne=o(s))!=null&&ne.detailminutes?(i(),a("button",{key:4,type:"button",class:"btn btn-sm mr-1 btn-danger btn-lg",onClick:d[2]||(d[2]=F(l=>{var n;return $e((n=o(s))==null?void 0:n.id)},["prevent"]))},[xt,M(" Delete Minutes ")])):p("",!0),e("button",{type:"button",class:"btn btn-sm mr-1 btn-primary btn-lg",onClick:d[3]||(d[3]=F(l=>{var n;return Me((n=o(s))==null?void 0:n.id)},["prevent"]))},[St,M(" Get Signatures ")]),e("button",{type:"button",class:"btn btn-sm mr-1 btn-success btn-lg",onClick:d[4]||(d[4]=F(l=>{var n;return Te((n=o(s))==null?void 0:n.id)},["prevent"]))},[At,M(" Publish Minutes ")])])):p("",!0)])])):p("",!0),e("div",wt,[Et,e("div",$t,[e("img",{src:o(ot)((oe=le.value)==null?void 0:oe.logo),alt:"Organization Logo",class:"img-fluid logo"},null,8,Mt)]),e("div",qt,u((de=le.value)==null?void 0:de.name),1),Tt,e("h4",Ht,"MINUTES OF THE "+u((ue=(re=o(s))==null?void 0:re.meeting)==null?void 0:ue.title),1),e("p",Pt," HELD AT "+u((_e=(ce=o(s))==null?void 0:ce.meeting)==null?void 0:_e.location)+" ON "+u(o(dt)((me=(ve=o(s))==null?void 0:ve.schedule)==null?void 0:me.date))+" STARTING AT "+u((he=(be=o(s))==null?void 0:be.schedule)==null?void 0:he.start_time),1),X.value.length?(i(),a("h5",Rt,"Present")):p("",!0),X.value.length?(i(),a("table",Ft,[e("tbody",null,[(i(!0),a(A,null,w(X.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Nt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",Gt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),Z.value.length?(i(),a("h5",Lt,"Present on E-platform ")):p("",!0),Z.value.length?(i(),a("table",Dt,[e("tbody",null,[(i(!0),a(A,null,w(Z.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Ot,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",Vt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),I.value.length?(i(),a("h5",Bt,"Absent With Apology ")):p("",!0),I.value.length?(i(),a("table",Ut,[e("tbody",null,[(i(!0),a(A,null,w(I.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Yt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",jt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),ee.value.length?(i(),a("h5",Kt," Absent ")):p("",!0),ee.value.length?(i(),a("table",Qt,[e("tbody",null,[(i(!0),a(A,null,w(ee.value,(l,n)=>(i(),a("tr",{key:l.id},[e("td",Wt,u(n+1)+". "+u(l.membership.user.full_name),1),e("td",zt," - "+u(l.membership.position.name),1)]))),128))])])):p("",!0),Jt,e("ul",Xt,[(i(!0),a(A,null,w(te.value,(l,n)=>(i(),a(A,{key:l.id},[e("li",null,u(n+1)+". "+u(l.title),1),e("ul",Zt,[(i(!0),a(A,null,w(l.children,(b,h)=>(i(),a("li",{key:b.id},u(n+1)+"."+u(h+1)+" "+u(b.title),1))),128))])],64))),128))]),e("div",It,[e("div",es,[e("div",ts,[e("div",ss,[e("div",is,[e("div",as,[te.value?(i(),a("ol",ls,[(i(!0),a(A,null,w(te.value,(l,n)=>(i(),a("li",{class:"mb-2 hover:border-gray-400",key:n},[e("div",ns,[e("div",os,[f.value===n&&y.value===-1&&C.value==="edit"||R.value&&P.value===l.id&&y.value===-1&&C.value==="create"?(i(),a("div",ds,[e("div",rs,[e("form",{novalidate:"",onSubmit:d[5]||(d[5]=F((...b)=>o(V)&&o(V)(...b),["prevent"]))},[e("div",us,[pe(fe,{label:`${o(D)(o(E)(n),l.title)}`,name:"description",theme:"snow",placeholder:"Enter minute description and hit save",toolbar:"full",contentType:"html",class:"minute-input"},null,8,["label"]),cs])],32)])])):(i(),a("div",_s,[(i(!0),a(A,null,w(x.value[l.id],(b,h)=>(i(),a("div",{key:h,onClick:$=>ae(n,-1,l,b,void 0)},[e("div",ms,u(o(D)(o(E)(n),l.title)),1),e("div",{innerHTML:b.description},null,8,bs),hs],8,vs))),128)),x.value[l.id]?p("",!0):(i(),a("div",{key:0,onClick:b=>J(l)},[e("div",fs,u(o(D)(o(E)(n),l.title)),1),gs],8,ps))]))])]),l.children?(i(),a("ol",ys,[(i(!0),a(A,null,w(l.children,(b,h)=>(i(),a("li",{class:"mb-2 hover:border-gray-400",draggable:"false",key:h},[e("div",ks,[e("div",Cs,[g.value&&P.value===l.id&&f.value===n&&y.value===h&&C.value==="create"||G.value&&!R.value&&!g.value&&f.value===n&&y.value===h&&C.value==="edit"?(i(),a("div",xs,[e("div",Ss,[e("form",{novalidate:"",onSubmit:d[6]||(d[6]=F((...$)=>o(V)&&o(V)(...$),["prevent"]))},[e("div",As,[pe(fe,{label:`${o(D)(o(E)(n),b.title,void 0,void 0,void 0,o(E)(h))}`,name:"description",theme:"snow",placeholder:"Enter minute description and hit save",toolbar:"full",contentType:"html",class:"minute-input"},null,8,["label"]),ws])],32)])])):(i(),a("div",Es,[e("div",$s,u(o(D)(o(E)(n),b.title,void 0,void 0,void 0,o(E)(h))),1),(i(!0),a(A,null,w(x.value[l.id],($,Pe)=>(i(),a("div",{key:Pe},[(i(!0),a(A,null,w(x.value[b.id],Y=>(i(),a("div",{key:Y.id},[Y.subagenda_id===b.id?(i(),a("div",{key:0,onClick:ci=>ae(n,h,l,$,Y)},[e("div",{innerHTML:Y.description},null,8,qs),Ts],8,Ms)):p("",!0)]))),128))]))),128)),x.value[b.id]?p("",!0):(i(),a("div",Hs,[f.value!==n&&!g.value?(i(),a("div",{key:0,onClick:$=>U(n,h,l,b)},Fs,8,Ps)):g.value&&P.value===l.id&&f.value===n&&y.value===h?(i(),a("div",Ns)):(i(),a("div",Gs,[e("div",{class:"font-medium",onClick:$=>U(n,h,l,b)},Os,8,Ls)]))]))])),M(),x.value[l.id]?p("",!0):(i(),a("div",Vs,[f.value!==n&&!g.value?(i(),a("div",Bs,[x.value&&x.value[l.id]&&x.value[l.id].length>0?(i(),a("div",{key:0,onClick:$=>U(n,h,l,b)},[e("div",Ys,u(o(D)(o(E)(n),b.title,void 0,void 0,void 0,o(E)(h))),1),js],8,Us)):(i(),a("div",Ks,[e("div",{class:"font-medium",onClick:$=>J(l)},zs,8,Qs)]))])):g.value&&P.value===l.id&&f.value===n&&y.value===h?(i(),a("div",Js)):(i(),a("div",Xs,[x.value&&x.value[l.id]&&x.value[l.id].length>0?(i(),a("div",{key:0,onClick:$=>U(n,h,l,b)},[e("div",Is,u(o(D)(o(E)(n),b.title,void 0,void 0,void 0,o(E)(h))),1),ei],8,Zs)):(i(),a("div",ti,[e("div",{class:"font-medium",onClick:$=>J(l)},ai,8,si),M("> ")]))]))]))])])]))),128))])):p("",!0)]))),128))])):p("",!0)])])])])])])])])])):(i(),a("div",li,oi))}}});const Ci=je(di,[["__scopeId","data-v-7fbb36de"]]);export{Ci as default};
