var T=Object.defineProperty;var n=(d,c)=>T(d,"name",{value:c,configurable:!0});import{d as j,j as A,k as G,i as H,r as h,P as K,a9 as O,H as Q,o as z,c as J,e as o,a1 as S,g as W,u as X,$ as Y,a0 as Z,ab as ee,aa as te,_ as ae}from"./main-d97516e2.js";import{u as se,c as oe,a as I,d as ne,b as ie,V as re}from"./useUnexpectedErrorHandler-01ee037e.js";import{u as ce,a as le}from"./useSignatureFileRequest-7ff2c619.js";import{f as de,E as ue}from"./Breadcrumb-62de853f.js";import{u as me}from"./pspdfkit.store-123501c2.js";import{u as pe}from"./useQuery-f8736dfe.js";import"./attendance_routes-7f73de2b.js";import"./useQueryClient-99479e2d.js";const _=n(d=>(Y("data-v-21185fc1"),d=d(),Z(),d),"_withScopeId"),fe={class:"card"},he={class:"card-header flex items-center h-auto p-4"},_e={class:"flex items-center flex-1 w-full"},ge=_(()=>o("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),we={class:"flex items-center space-x-2"},ye=["disabled"],ve=_(()=>o("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),be=_(()=>o("span",{class:"text-blue-primary font-bold"},"Save File",-1)),Se=[ve,be],Ie={class:"card-body"},Fe=j({__name:"Signature",setup(d){const c=A(),F=G();H();const g=h(""),s=me(),u=h(null),x=se(),U=c.params.committeeId,p=c.params.attendeeId,k=c.params.meetingId,P=c.params.scheduleId,w=c.params.mediaId,f=h(""),R=oe({id:I().required(),name:I().required(),signatureupload:ne().nullable()}),{handleSubmit:E,setErrors:$,setFieldValue:y,values:xe}=ie({validationSchema:R,initialValues:{id:p,name:"",signatureupload:null}}),C=n(async()=>{const e=await s.savePdf(f.value);y("signatureupload",e),y("name",f.value),await M(),await V()},"savePdf"),V=E(async e=>{try{const t={id:e.id,name:e.name,signatureupload:e.signatureupload},a=await ce(t,p,w);await v(a.data)}catch(t){s.unloadPdf(u.value),t instanceof re?$(t.message):x(t)}});function B(e){const t=new URL(window.location),a=t.pathname.split("/");a[a.length-1]=e,t.pathname=a.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}n(B,"updateMediaIdInURL");const q=n(()=>{s.unloadPdf(u.value),F.push({name:"CommitteeMeetingDetails",params:{committeeId:U,meetingId:k,scheduleId:P}})},"goBack"),D=n(async e=>{var t,a;if(s.instance&&e.attendance_status==="Absent"){const i={meeting:e.schedule.meeting.title,schedule:de((t=e==null?void 0:e.schedule)==null?void 0:t.date),name:(a=e==null?void 0:e.membership)==null?void 0:a.user.full_name,date:ue(new Date),position:e==null?void 0:e.membership.position.name},l={};for(const[m,r]of Object.entries(i))l[m]=r;await s.instance.setFormFieldValues(l)}},"populateFormFields"),v=n(e=>{if(s.unloadPdf(u.value),e&&e.file){const t=e.file,a=window.atob(t),i=a.length,l=new Uint8Array(i);for(let r=0;r<i;r++)l[r]=a.charCodeAt(r);f.value=e.fileName,B(e.mediaId);const m=new Blob([l],{type:"application/pdf"});g.value=URL.createObjectURL(m),s.setPdfFile(g.value)}},"openFile"),L=n(()=>pe({queryKey:["getFileKey"],queryFn:async()=>{const e=await le(p,w);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await v(e.data),e.data}}),"getSignatureFile"),M=n(async()=>{try{const e="4b60149b61646d",t=await ee.get(`https://ipinfo.io?token=${e}`),{ip:a,city:i,region:l,country:m}=t.data,r=`${a}, ${i}, ${l}, ${m}`;return{ip:a,location:r}}catch(e){return console.error("Error fetching IP address and location:",e),{ip:"Unknown IP",location:"Unknown IP, Unknown City, Unknown Region, Unknown Country"}}},"getCurrentLocation");K(async()=>{await N()}),O(()=>{s.unloadPdf(u.value)});const{isLoading:Ue,data:b,refetch:N}=L();return Q(()=>s.pdfFile,async()=>{var t,a;const e=document.getElementById("app").dataset.appUrl;if(await s.loadPdf(u.value,e),await te(),(t=b.value)!=null&&t.attendance){const i=(a=b.value)==null?void 0:a.attendance;D(i)}},{immediate:!0}),(e,t)=>(z(),J("div",fe,[o("div",he,[o("div",_e,[o("a",{href:"",onClick:t[0]||(t[0]=S(a=>q(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[ge,W(" Go back to The Meeting ")])]),o("div",we,[o("button",{type:"button",onClick:S(C,["prevent"]),disabled:!X(s).instance,class:"btn btn-tool"},Se,8,ye)])]),o("div",Ie,[o("div",{ref_key:"containerRef",ref:u,style:{width:"100%",height:"450px"}},null,512)])]))}});const De=ae(Fe,[["__scopeId","data-v-21185fc1"]]);export{De as default};
