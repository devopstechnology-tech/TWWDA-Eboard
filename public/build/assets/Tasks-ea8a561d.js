var H=Object.defineProperty;var d=(T,f)=>H(T,"name",{value:f,configurable:!0});import{d as N,j as G,r as c,V as O,C as z,P as Q,o as l,c as n,e,F as y,R as F,u as i,t as u,T as J,f as h,U as x,h as E,a1 as W}from"./main-451c20d4.js";import{u as X,e as Y,c as Z,a as m,f as ee,b as se}from"./useUnexpectedErrorHandler-2f1b2730.js";import{u as te}from"./useMembershipRequest-ae7237bb.js";import{i as ae,j as oe}from"./useTaskRequest-e083a7cb.js";import{_ as le}from"./FormDateTimeInput.vue_vue_type_style_index_0_lang-abff0e84.js";import{F as ne}from"./FormInput-4bdc1ca0.js";import{F as ie}from"./FormTextBox-4a2981cb.js";import{h as re}from"./Breadcrumb-ecf3abcd.js";import{u as C}from"./useQuery-64b3e593.js";import"./index-053adef9.js";import"./membership_routes-2da0f288.js";import"./useQueryClient-78663db9.js";const de={class:"card h-full"},ce=e("div",{class:"card-header flex items-center"},[e("div",{class:"flex items-center flex-1 w-full"},[e("h2",{class:"card-header-title h3"}," Meeting Tasks ")])],-1),ue={id:"task-asignee-list"},me={class:"table table-striped card-table"},pe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort asc","data-sort":"task-title"}," Task Title ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"due-date"}," Due Date ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"status"}," Status ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"assignment-members"},"Assignment Members ")]),e("th",{scope:"col",class:"text-bold text-center"},"Action")])],-1),_e={class:"list"},be={class:"task-title","data-name":"task.name",style:{"max-width":"200px","word-wrap":"break-word"}},ge={class:"font-weight-bold"},he=["innerHTML"],fe={key:0,class:"badge bg-warning"},ke={key:1,class:"badge bg-info"},ve={key:2,class:"badge bg-primary"},ye={key:3,class:"badge bg-success"},xe={class:"list-none m-0 p-0"},Te=e("td",{class:"text-center"},null,-1),we={class:"flex justify-center col-md-6"},Me={method:"dialog",class:"modal-box rounded-xl"},De={class:"font-bold text-lg justify-center flex"},qe=e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1),Fe={class:"w-full mt-6 p-2"},Ee={class:"font-thin text-sm flex flex-col items-center gap-6"},Ce={class:"grid grid-cols-3 gap-2"},Ve={class:"form-group col-span-3"},Se=e("label",{class:"text-bold font-medium tracking-wide"}," People Responsible ",-1),Ue={key:0,class:"message"},$e={type:"submit",class:"btn btn-md mb-1 w-full pt-1 text-red-600 mt-6 bg-primary"},Be="1234",Ye=N({__name:"Tasks",setup(T){const f=G(),V=c(!1),_=c("create");f.params.meetingId;const k=c(null),p=c([]),v=c([]);c(null);const w=c(null),S=X(),{errorMessage:b}=Y("taskassignees"),M=d(t=>{const a=new Date,s=new Date(t);return a>s},"hasDueDatePassed"),U=Z({title:m().required(),duedate:m().required(),description:m().required(),status:m().required(),meeting_id:m().required(),task_id:m().nullable(),taskassignees:ee().of(m()).nullable()}),{handleSubmit:$,setErrors:B,setFieldValue:r,values:Pe}=se({validationSchema:U,initialValues:{title:"",duedate:"",description:"",status:"pending",meeting_id:"",task_id:null,taskassignees:[]}}),P=d(()=>{r("taskassignees",p.value)},"selectedUsers"),R=d(()=>{r("taskassignees",p.value)},"removeselectedUsers"),D=$(async(t,{resetForm:a})=>{var s;try{r("taskassignees",p.value);const o={title:t.title,duedate:t.duedate,description:t.description,status:t.status,meeting_id:t.meeting_id,task_id:null,taskassignees:t.taskassignees};if(_.value!=="create"){const g=k.value?k.value.toString():null;o.task_id=g,await ae(o,o.meeting_id)}await q(),I(),(s=w.value)==null||s.close()}catch(o){o instanceof O?B(o.messages):S(o)}}),I=d(()=>{_.value="create",V.value=!1,k.value=null,p.value=[],r("title",""),r("duedate",""),r("description",""),r("taskassignees",[])},"reset"),j=z(()=>{var a;const t=[];return v.value&&((a=v.value)==null?void 0:a.length)>0&&v.value.reduce((s,o)=>(s.push({id:o.id,name:`${o.user.full_name}`}),s),t),t});d(async t=>C({queryKey:["getTasksKey"],queryFn:async()=>{const a=await te(t,Be);return console.log(a),a.data}}),"getMemberships")();const K=d(()=>C({queryKey:["getOwnTasksKey"],queryFn:async()=>{const t=await oe({paginate:"false"});return console.log(t),t.data}}),"getTasks"),{isLoading:Ie,data:L,refetch:q}=K();return Q(async()=>{q(),window.dispatchEvent(new CustomEvent("updateTitle",{detail:"All Tasks"}))}),(t,a)=>(l(),n(y,null,[e("div",de,[ce,e("div",ue,[e("table",me,[pe,e("tbody",_e,[(l(!0),n(y,null,F(i(L),(s,o)=>(l(),n("tr",{key:o},[e("td",be,[e("div",ge,u(s.title),1),e("div",{innerHTML:s.description},null,8,he)]),e("td",{class:x({"danger-color":M(s.duedate)&&s.status!=="completed","ok-color":!M(s.duedate)||s.status==="completed"})},u(i(re)(s.duedate)),3),e("td",null,[s.status==="backlog"?(l(),n("span",fe," Backlog ")):s.status==="pending"?(l(),n("span",ke," Pending ")):s.status==="onprogress"?(l(),n("span",ve," On Progress ")):s.status==="completed"?(l(),n("span",ye," Completed ")):E("",!0)]),e("td",null,[e("ul",xe,[(l(!0),n(y,null,F(s.taskassignees,(g,A)=>(l(),n("li",{key:g.id},u(A+1)+". "+u(g.user.full_name),1))),128))])]),Te]))),128))])])])]),e("div",we,[e("dialog",{id:"taskmodal",class:"modal",ref_key:"TaskModal",ref:w},[e("form",Me,[e("h3",De,u(_.value=="create"?"Create Meeting Task":"Edit Meeting Task"),1),qe,e("div",Fe,[e("div",Ee,[e("form",{novalidate:"",onSubmit:a[3]||(a[3]=J((...s)=>i(D)&&i(D)(...s),["prevent"])),class:"w-full rounded-xl mx-auto p-1"},[e("div",Ce,[h(ne,{labeled:!0,label:"Task Title",name:"title",class:"col-span-2 w-full text-sm text-white tracking-wide",placeholder:"Enter Task Title",type:"text"}),h(le,{label:"Task Due Date",name:"duedate",flow:["day"],placeholder:"Task Due Date"}),h(ie,{label:"Task Description",name:"description",class:"col-span-3",placeholder:"Enter Task Description",rows:2}),e("div",Ve,[Se,e("div",{class:x(["multiselect-container",{error:!!i(b)}])},[h(i(W),{id:"taskassignees",modelValue:p.value,"onUpdate:modelValue":a[0]||(a[0]=s=>p.value=s),mode:"tags",placeholder:"Choose your stack","close-on-select":!1,"filter-results":!1,"min-chars":1,"resolve-on-load":!1,delay:0,searchable:!0,options:j.value,valueProp:"id",trackBy:"id",label:"name",class:x(["col-span-3",["multiselect-container",{error:!!i(b)}]]),onSelect:a[1]||(a[1]=s=>P()),onDeselect:a[2]||(a[2]=s=>R())},null,8,["modelValue","options","class"]),i(b)?(l(),n("div",Ue,u(i(b)),1)):E("",!0)],2)])]),e("button",$e,u(_.value=="create"?"Create Meeting Task":"Edit Meeting Task"),1)],32)])])])],512)])],64))}});export{Ye as default};
