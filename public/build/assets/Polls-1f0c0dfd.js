var G=Object.defineProperty;var i=(D,w)=>G(D,"name",{value:w,configurable:!0});import{d as J,i as W,j as X,r,V as Y,P as Z,o as m,c as p,e,F as V,R as ee,u as c,t as d,T as te,f as b,U as y,h as E,g as se}from"./main-a9f2cfe9.js";import{u as oe,e as ne,c as f,a as n,f as le,b as ae}from"./useUnexpectedErrorHandler-16280be0.js";import"./membership_routes-72332848.js";import{c as ie,d as re}from"./usePollRequest-712c654f.js";import{_ as de}from"./FormDateTimeInput.vue_vue_type_style_index_0_lang-e4584ded.js";import{F as P}from"./FormInput-139a23bd.js";import{F as ce}from"./FormTextBox-e5e2ff5b.js";import{u as ue}from"./useQuery-e9652e60.js";import"./index-66c2f00f.js";import"./useQueryClient-1703431f.js";const me={class:"card h-full"},pe=e("div",{class:"card-header flex items-center"},[e("div",{class:"flex items-center flex-1 w-full"},[e("h2",{class:"card-header-title h3"}," Meeting Polls ")]),e("div",{class:"flex items-center space-x-2"})],-1),be={id:"poll-asignee-list"},_e={class:"table table-striped card-table"},ge=e("thead",null,[e("tr",null,[e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort asc","data-sort":"poll-title"}," Poll Title ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"due-date"}," Due Date ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"status"}," Status ")]),e("th",{scope:"col"},[e("button",{class:"text-bold btn btn-link btn-sm list-sort","data-sort":"vote-stats"},"Vote Stats ")]),e("th",{scope:"col",class:"text-bold text-center"},"Action")])],-1),he={class:"list"},fe={class:"poll-title","data-name":"poll.name",style:{"max-width":"200px","word-wrap":"break-word"}},we={class:"font-weight-bold"},xe={style:{"white-space":"normal"}},ve=["innerHTML"],ye=e("td",{class:"text-center"},null,-1),Pe={class:"flex justify-center col-md-6"},De={method:"dialog",class:"modal-box rounded-xl"},qe={class:"font-bold text-lg justify-center flex"},ke=e("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1),Ce={class:"w-full mt-6 p-2"},Me={class:"font-thin text-sm flex flex-col items-center gap-6"},Se={class:"grid grid-cols-3 gap-2"},Ve={key:0,class:"message"},Ee={type:"submit",class:"btn btn-md mb-1 w-full pt-1 text-red-600 mt-6 bg-primary"},Fe="1234",Ke=J({__name:"Polls",setup(D){W();const w=X(),F=r(!1),_=r("create"),A=w.params.meetingId,x=r(null);r([]),r([]),r([]);const T=r(null),q=r(null),$=oe(),{errorMessage:v}=ne("duedate"),B=f({question:n().required(),description:n().required(),duedate:n().required(),meeting_id:n().nullable(),board_id:n().nullable(),committee_id:n().nullable(),poll_id:n().nullable(),status:n(),options:le().of(f({optiona:f({id:n().nullable(),title:n().required(),poll_id:n().nullable()}),optionb:f({id:n().nullable(),title:n().required(),poll_id:n().nullable()})}).required("At least one set of options is required"))}),{handleSubmit:R,setErrors:N,setFieldValue:a,values:Ae}=ae({validationSchema:B,initialValues:{question:"",description:"",duedate:"",meeting_id:A,board_id:null,committee_id:null,poll_id:null,status:"active",options:[{optiona:{id:"",title:"",poll_id:""},optionb:{id:"",title:"",poll_id:""}}]}}),k=R(async(t,{resetForm:o})=>{var s;try{const l={question:t.question,description:t.description,duedate:t.duedate,meeting_id:t.meeting_id,board_id:t.board_id,committee_id:t.committee_id,poll_id:t.poll_id,status:t.status,options:t.options};if(_.value!=="create"){const u=x.value?x.value.toString():null;l.poll_id=u;const M=t.meeting_id?t.meeting_id.toString():null;await ie(l,M,Fe)}await C(),O(),(s=q.value)==null||s.close()}catch(l){l instanceof Y?N(l.messages):$(l)}}),O=i(()=>{_.value="create",F.value=!1,T.value=null,x.value=null,a("question",""),a("description",""),a("duedate",""),a("meeting_id",""),a("board_id",null),a("committee_id",null),a("poll_id",null),a("status","active"),a("options",[{optiona:{id:"",title:"",poll_id:""},optionb:{id:"",title:"",poll_id:""}}])},"reset"),I=i(()=>ue({queryKey:["getPollsKey"],queryFn:async()=>(await re({paginate:"false"})).data}),"getPolls"),{isLoading:Te,data:L,refetch:C}=I();Z(async()=>{C(),window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Meeting Polls"}))});const U=i(t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),"formattedDateTime"),j=i(t=>H(t)?"bg-danger":"bg-success","dateBadgeClass"),H=i(t=>{const o=new Date,s=new Date(t);return o>s},"hasDueDatePassed"),Q=i(t=>{const o=new Date,s=new Date(t),l=24*60*60*1e3;return s-o<l},"isDueSoon"),K=i(t=>{var S;if(!t.votes||((S=t.votes)==null?void 0:S.length)===0)return"No votes yet";const o=t.votes.reduce((g,h)=>g+h.voteCount,0),s=t.totalMembers;if(o>s)return console.error("Total votes exceed total members, which is unexpected."),"Voting data error";if(o===0)return"No votes yet";const l=t==null?void 0:t.votes.reduce((g,h)=>g.voteCount>h.voteCount?g:h),u=s-o;return`${(l.voteCount/o*100).toFixed(1)}% voted for ${l.title}<br>${o} voted / ${u} not yet`},"calculateVoteStats"),z=i(t=>{switch(t){case"Backlog":return"badge bg-warning";case"Pending":return"badge bg-info";case"On Progress":return"badge bg-primary";case"Completed":return"badge bg-success";default:return"badge"}},"statusClass");return(t,o)=>(m(),p(V,null,[e("div",me,[pe,e("div",be,[e("table",_e,[ge,e("tbody",he,[(m(!0),p(V,null,ee(c(L),(s,l)=>(m(),p("tr",{key:l},[e("td",fe,[e("div",we,d(s.question),1),e("p",xe,d(s.description),1)]),e("td",{class:y(j(s.duedate))},[se(d(U(s.duedate))+" ",1),Q(s.duedate)?(m(),p("button",{key:0,class:"btn btn-warning btn-sm",onClick:o[0]||(o[0]=(...u)=>t.sendReminder&&t.sendReminder(...u))}," Send Reminder ")):E("",!0)],2),e("td",null,[e("span",{class:y(z(s.status))},d(s.status),3)]),e("td",{innerHTML:K(s)},null,8,ve),ye]))),128))])])])]),e("div",Pe,[e("dialog",{id:"pollmodal",class:"modal",ref_key:"PollModal",ref:q},[e("form",De,[e("h3",qe,d(_.value=="create"?"Create Meeting Poll":"Edit Meeting Poll"),1),ke,e("div",Ce,[e("div",Me,[e("form",{novalidate:"",onSubmit:o[1]||(o[1]=te((...s)=>c(k)&&c(k)(...s),["prevent"])),class:"w-full rounded-xl mx-auto p-1"},[e("div",Se,[b(P,{labeled:!0,label:"Poll Question",name:"question",class:"col-span-3 w-full text-sm text-white tracking-wide",placeholder:"Enter Poll Question",type:"text"}),b(P,{labeled:!0,label:"Answer Option A",name:"options[0].optiona.title",class:"col-span-1 w-full text-sm text-white tracking-wide",placeholder:"Enter Answer Option A",type:"text"}),b(P,{labeled:!0,label:"Answer Option B",name:"options[0].optionb.title",class:"col-span-1 w-full text-sm text-white tracking-wide",placeholder:"Enter Answer Option A",type:"text"}),e("div",{class:y(["formdatetime-container",{error:!!c(v)}])},[b(de,{label:"Poll Due Date",name:"duedate",flow:["day"],placeholder:"Poll Due Date"}),c(v)?(m(),p("div",Ve,d(c(v)),1)):E("",!0)],2),b(ce,{label:"Poll Description",name:"description",class:"col-span-3",placeholder:"Enter Poll Description",rows:2})]),e("button",Ee,d(_.value=="create"?"Create Meeting Poll":"Edit Meeting Poll"),1)],32)])])])],512)])],64))}});export{Ke as default};
