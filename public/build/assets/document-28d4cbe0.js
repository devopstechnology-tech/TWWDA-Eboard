var C=Object.defineProperty;var n=(i,l)=>C(i,"name",{value:l,configurable:!0});import{d as L,j as $,k as A,i as j,r as f,H as D,a5 as G,V as H,P as K,o as O,c as Q,e as a,T as x,g as W,u as X,W as z,X as J,a6 as Y,_ as Z}from"./main-dbb1f149.js";import{u as ee,c as te,a as r,d as ae,b as oe}from"./useUnexpectedErrorHandler-4e609aa9.js";import{u as se,a as ne}from"./useFileRequest-b4a4b940.js";import{u as ie}from"./pspdfkit.store-5e189a61.js";import{u as le}from"./useQuery-c5d8918e.js";import"./folder_routes-739dd8fe.js";import"./useQueryClient-785d5088.js";const m=n(i=>(z("data-v-050e523e"),i=i(),J(),i),"_withScopeId"),de={class:"card"},re={class:"card-header flex items-center h-auto p-4"},ce={class:"flex items-center flex-1 w-full"},ue=m(()=>a("i",{class:"fas fa-chevron-left fa-xs"},null,-1)),pe={class:"flex items-center space-x-2"},fe=["disabled"],me=m(()=>a("i",{class:"far fa fa-save mr-2 bg-primary"},null,-1)),_e=m(()=>a("span",{class:"text-blue-primary font-bold"},"Save File",-1)),he=[me,_e],ye={class:"card-body"},be=L({__name:"document",setup(i){const l=$(),S=A(),_=j(),h=f(""),o=ie(),d=f(null),I=ee();l.params.committeeId;const F=l.params.meetingId,u=l.params.folderId,y=l.params.mediaId,p=f(""),U=n(()=>{o.unloadPdf(d.value),S.back()},"goBack");D(()=>o.pdfFile,async()=>{const e=_.user.first+" "+_.user.last,t=document.getElementById("app").dataset.appUrl;await o.loadPdf(d.value,t),await Y(),o.createTextAnnotation(e)},{immediate:!0}),G(()=>{o.unloadPdf(d.value)});const k=te({name:r().required(),meeting_id:r().required(),folder_id:r().nullable(),parent_id:r().nullable(),type:r().oneOf(["folder","file"]).required(),fileupload:ae().nullable()}),{handleSubmit:P,setErrors:R,setFieldValue:b,values:E}=oe({validationSchema:k,initialValues:{name:"",meeting_id:F,folder_id:u,parent_id:"666",type:"file",fileupload:null}}),q=n(async()=>{const e=await o.savePdf(p.value);b("fileupload",e),b("name",p.value),console.log(e,E),await B()},"savePdf"),B=P(async e=>{try{const t={folder_id:e.folder_id,name:e.name,type:e.type,fileupload:e.fileupload};console.log("payload",t);const s=await se(t,u,y);await v(s.data)}catch(t){t instanceof H?R(t.messages):I(t)}}),v=n(e=>{if(o.unloadPdf(d.value),e&&e.file){const t=e.file;console.log("base64base640",t);const s=window.atob(t),g=s.length,w=new Uint8Array(g);for(let c=0;c<g;c++)w[c]=s.charCodeAt(c);p.value=e.fileName,M(e.mediaId);const V=new Blob([w],{type:"application/pdf"});h.value=URL.createObjectURL(V),o.setPdfFile(h.value)}},"openFile");function M(e){const t=new URL(window.location),s=t.pathname.split("/");s[s.length-1]=e,t.pathname=s.join("/"),window.history.pushState({path:t.toString()},"",t.toString())}n(M,"updateMediaIdInURL");const N=n(()=>le({queryKey:["getFileKey"],queryFn:async()=>{const e=await ne(u,y);return window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Document: "+e.data.fileName})),await v(e.data),e}}),"getMeetingFile");K(async()=>{await T()});const{isLoading:ve,data:ge,refetch:T}=N();return(e,t)=>(O(),Q("div",de,[a("div",re,[a("div",ce,[a("a",{href:"",onClick:t[0]||(t[0]=x(s=>U(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary card-header-title h3"},[ue,W(" Go back to The Meeting ")])]),a("div",pe,[a("button",{type:"button",onClick:x(q,["prevent"]),disabled:!X(o).instance,class:"btn btn-tool"},he,8,fe)])]),a("div",ye,[a("div",{ref_key:"containerRef",ref:d,style:{width:"100%",height:"100vh"}},null,512)])]))}});const Re=Z(be,[["__scopeId","data-v-050e523e"]]);export{Re as default};
