var Ns=Object.defineProperty;var l=(d,_)=>Ns(d,"name",{value:_,configurable:!0});import{a8 as W,q as M,d as Ps,i as Qs,r as p,C as k,P as Ks,b as Os,u as h,o,c as a,e as s,T as C,g as H,h as y,F as T,R as E,t as r,f as S,U as K,W as zs,X as Ws,_ as Xs}from"./main-dbb1f149.js";import{u as Ys,e as Js,c as O,a as f,f as Zs,b as se,V as ee}from"./useUnexpectedErrorHandler-4e609aa9.js";import{e as te}from"./useBoardRequest-ccde2887.js";import{d as ie}from"./useCommitteeRequest-2bb6c0bc.js";import{Q as X}from"./index-78587978.js";import{a as oe}from"./useUserRequest-622bdf59.js";import{F as _s}from"./FormInput-9ec9e7b2.js";import{F as I}from"./FormQuillEditor-4b336791.js";import{v as z,D as ps}from"./Breadcrumb-e536828e.js";import{u as ae}from"./useQuery-c5d8918e.js";import"./useQueryClient-785d5088.js";const ms=W("api/v1/chats");async function ne(d,_,v){const x=M(),c=X.stringify(v,{arrayFormat:"brackets"});return(await x.post(ms()+"/"+_+"?"+c,{json:d})).json()}l(ne,"useCreateChatRequest");async function le(d,_){const v=M(),x=X.stringify(_,{arrayFormat:"brackets"});return(await v.patch(ms()+"/update/"+d.id+"?"+x,{json:d})).json()}l(le,"useUpdateChatRequest");const q=W("api/v1/discussions");W("api/v1/discussions/members");async function ce(d,_){const v=M(),x=X.stringify(_,{arrayFormat:"brackets"});return await v.get(q()+"/"+d+"?"+x).json()}l(ce,"useGetUserDiscussionsRequest");async function de(d,_){return(await M().post(q()+"/"+_,{json:d})).json()}l(de,"useCreateDiscussionRequest");async function re(d,_,v){return(await M().patch(q()+"/update/"+v,{json:d})).json()}l(re,"useUpdateDiscussionRequest");async function ue(d){return(await M().get(q()+"/leave/"+d)).json()}l(ue,"useLeaveDiscussionRequest");async function _e(d){return(await M().get(q()+"/close/"+d)).json()}l(_e,"useCloseDiscussionRequest");async function pe(d){return(await M().get(q()+"/delete/"+d)).json()}l(pe,"useDeleteDiscussionRequest");const u=l(d=>(zs("data-v-4e4fea33"),d=d(),Ws(),d),"_withScopeId"),me={key:0},he={class:"card h-full"},ve={class:"card-header flex items-center"},fe=u(()=>s("div",{class:"flex items-center flex-1 w-full"},[s("h2",{class:"card-header-title h3"},"Discussion")],-1)),ge={key:0,class:"flex items-center space-x-2"},be=u(()=>s("i",{class:"far fa fa-plus mr-2"},null,-1)),ye=u(()=>s("span",{class:"text-primary"},"Add Discussion",-1)),xe={class:"card-container"},we={key:0},De={key:1},ke={class:"row"},Ce={class:"col-lg-4"},Me={class:"card"},Se=u(()=>s("div",{class:"card-header bg-primary"},[s("h3",{class:"card-title"},"Discussions")],-1)),Te={class:"card-body"},Ee=u(()=>s("div",{class:"dropdown-divider"},null,-1)),qe={class:"card-body p-0",style:{height:"500px","overflow-y":"auto"}},Le={class:"card-body d-flex align-items-center"},Ue=u(()=>s("i",{class:"fas fa-user-circle fa-2x me-3"},null,-1)),je={class:"flex-grow-1"},Re={class:"mb-0"},Fe={class:"text-muted"},$e=["innerHTML"],Be=["onClick"],Ve=u(()=>s("i",{class:"far fa-eye"},null,-1)),Ae=[Ve],Ge=["onClick"],He=u(()=>s("i",{class:"fa fa-edit"},null,-1)),Ie=[He],Ne={class:"col-lg-8"},Pe={class:"card"},Qe={class:"flex items-center bg-success"},Ke=u(()=>s("h3",{class:"ml-2 card-title"},"Discussion",-1)),Oe={key:0,class:"ml-auto flex self-end"},ze=u(()=>s("a",{class:"nav-link",href:"#",id:"navbarDropdown",role:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[s("i",{class:"fas fa-ellipsis-v"})],-1)),We={class:"dropdown-menu dropdown-menu-end","aria-labelledby":"navbarDropdown"},Xe=["onClick"],Ye=u(()=>s("i",{class:"fas fa-users"},null,-1)),Je=[Ye],Ze={key:0},st={class:"card-header"},et=u(()=>s("span",{class:"badge bg-secondary"},"Board",-1)),tt={class:"card-body"},it={class:"flex-1 mb-8"},ot={class:"bg-gray-200 text-gray-700 rounded-lg px-4 pt-1 pb-1"},at={class:"text-xs font-medium subpixel-antialiased mb-2 text-gray-900"},nt={href:"#",class:"text-gray-800","data-bs-original-title":"",title:""},lt=["innerHTML"],ct={class:"direct-chat-messages"},dt={class:"flex gap-2 items-start mb-4"},rt={key:0,class:"font-medium flex-1"},ut={class:"flex gap-x-2"},_t=u(()=>s("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),pt={key:1,class:"font-medium flex-1"},mt={key:0,class:"direct-chat-msg"},ht={class:"direct-chat-infos clearfix"},vt={class:"direct-chat-name float-left"},ft={class:"direct-chat-timestamp float-right"},gt={key:0,class:"direct-chat-infos clearfix"},bt={class:"direct-chat-timestamp float-right"},yt=["src"],xt=["innerHTML"],wt={key:1,class:"direct-chat-msg right"},Dt={class:"direct-chat-infos clearfix"},kt={class:"direct-chat-name float-right"},Ct={class:"direct-chat-timestamp float-left"},Mt=["onClick"],St=u(()=>s("i",{class:"fa fa-edit"},null,-1)),Tt=[St],Et={key:0,class:"direct-chat-infos clearfix"},qt={class:"direct-chat-timestamp float-left"},Lt=["src"],Ut=["onClick","innerHTML"],jt={key:0,class:"font-medium flex-1"},Rt={class:"flex gap-x-2"},Ft=u(()=>s("button",{type:"submit",class:"btn btn-primary h-10 mt-12"}," Save ",-1)),$t={key:1,class:"mt-2"},Bt={key:1},Vt=u(()=>s("div",{class:"card-body"}," Kindly select any Discussion Topic To view the Chat ",-1)),At=[Vt],Gt={class:"flex justify-center"},Ht={method:"dialog",class:"modal-box rounded-xl"},It={class:"font-bold text-lg justify-center flex"},Nt=u(()=>s("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"âœ•",-1)),Pt={class:"overflow-auto p-4",style:{"max-height":"100vh"}},Qt={class:"grid grid-cols-3 md:grid-cols-3 gap-2 p-2"},Kt={class:"col-span-3"},Ot={key:0},zt={class:"flex flex-wrap -mx-2 mt-2"},Wt={class:"w-full px-1 md:px-2"},Xt={key:1},Yt={class:"flex flex-wrap -mx-2 mt-2"},Jt={class:"w-full px-1 md:px-2"},Zt={class:"flex flex-wrap -mx-2 mt-2"},si={class:"w-full md:w-1/3 px-1 md:px-2"},ei={key:0},ti=u(()=>s("h3",{class:"font-bold"},"Selected Boards",-1)),ii={class:"w-full md:w-1/3 px-1 md:px-2"},oi={key:0},ai=u(()=>s("h3",{class:"font-bold"},"Selected Committees",-1)),ni={class:"w-full md:w-1/3 px-1 md:px-2"},li={key:0},ci=u(()=>s("h3",{class:"font-bold"},"Selected Users",-1)),di={class:"form-group col-span-3"},ri=u(()=>s("label",{class:"text-bold font-medium tracking-wide"}," Group Members to the Discucssion ",-1)),ui={key:0,class:"message"},_i={key:2},pi={type:"submit",class:"btn btn-primary btn-md w-full mt-6"},mi={key:1},hi=u(()=>s("p",{class:"m-0"},[s("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),vi=[hi],fi=Ps({__name:"discussions",setup(d){var cs;const _=Qs();_.initialize();const v=_.user.id,x=p("latest");p("board");const c=p("create"),L=p(!1),$=p(!1),B=p(-1),N=p(!1),U=p(!1),j=(cs=_.user)==null?void 0:cs.id,hs=p(null),m=p([]),V=p([]),P=p(null),A=p(null);p([]);const R=p(null),Y=p([]),J=p([]),Z=p([]),vs=Ys(),{errorMessage:G}=Js("discussionassignees"),fs=O({id:f().nullable(),full_name:f().nullable()}),gs=O({id:f().nullable(),discussion_id:f().nullable(),assignee_id:f().nullable(),user:fs}),bs=O({id:f().nullable(),topic:f().required(),description:f().required(),closestatus:f().required(),archivestatus:f().required(),message:f().nullable(),assignee_sender_id:f().nullable(),discussion_id:f().nullable(),discussionassignees:Zs().of(gs).nullable()}),{handleSubmit:ys,setErrors:xs,setFieldValue:n,values:ss}=se({validationSchema:bs,initialValues:{id:"",topic:"",description:"",closestatus:"opened",archivestatus:"none",message:null,assignee_sender_id:null,discussion_id:null,discussionassignees:[]}}),ws=l(()=>{var e;w(),c.value="create",$.value=!1,L.value=!0,(e=R.value)==null||e.showModal()},"openCreateDiscussionModal"),es=l(e=>{var i;w(),A.value=e,n("id",e.id),n("topic",e.topic),n("description",e.description),n("closestatus",e.closestatus),n("archivestatus",e.archivestatus),m.value=e.dassignees,n("discussionassignees",m.value),c.value="edit",L.value=!0,(i=R.value)==null||i.showModal(),console.log(ss,c.value)},"openEditDiscussionModal"),Ds=l(e=>{var i;w(),$.value=!0,A.value=e,n("id",e.id),n("topic",e.topic),n("description",e.description),n("closestatus",e.closestatus),n("archivestatus",e.archivestatus),m.value=e.dassignees,n("discussionassignees",m.value),c.value="edit",L.value=!0,(i=R.value)==null||i.showModal(),console.log(ss,c.value)},"openMemberModal"),Q=ys(async e=>{var i;try{if(c.value==="create"||c.value==="edit"){const g={id:e.id,topic:e.topic,description:e.description,closestatus:e.closestatus,archivestatus:e.archivestatus,discussionassignees:e.discussionassignees};c.value==="create"?await de(g,j):await re(g,j,g.id)}else if(c.value==="create chat"||c.value==="edit chat"){const g={id:e.id?e.id:"",topic:e.topic,description:e.description,message:e.message?e.message:"",assignee_sender_id:e.assignee_sender_id?e.assignee_sender_id:"",discussion_id:e.discussion_id?e.discussion_id:""};if(c.value==="create chat"){const t=await ne(g,j,{paginate:"false"});V.value=t.data}else if(c.value==="edit chat"){const t=await le(g,{paginate:"false"});V.value=t.data}}(i=R.value)==null||i.close(),await F(),w()}catch(g){g instanceof ee?xs(g.messages):vs(g)}}),w=l(()=>{c.value="create",$.value=!1,B.value=-1,N.value=!1,U.value=!1,L.value=!1,hs.value=null,m.value=[],P.value=null,n("id",""),n("topic",""),n("description","description ................"),n("closestatus","opened"),n("archivestatus","none"),n("discussionassignees",[]),n("message",""),n("assignee_sender_id",null),n("discussion_id",null)},"reset"),ts=[{id:"latest",name:"Latest"},{id:"starred",name:"Starred"},{id:"unread",name:"Unread"},{id:"mentions",name:"Mentions"},{id:"archived",name:"Archived"}],ks=[{id:"leave",name:"Leave Discussion",icon:"fas fa-sign-out-alt",permissions:["leave discussion"]},{id:"edit",name:"Edit Description",icon:"fas fa-edit",permissions:["edit discussion"]},{id:"close",name:"Close Discussion",icon:"fas fa-times",permissions:["close discussion"]},{id:"delete",name:"Delete Discussion",icon:"far fa-trash-alt text-danger",permissions:["delete discussion"]}],Cs=k(()=>ks.filter(e=>e.permissions?e.permissions.every(i=>_.hasPermission([i])):!0));k(()=>{const e=ts.find(i=>i.id===x.value);return e?e.name:"Latest"}),k(()=>{const e=ts.find(i=>i.id===x.value);return e?e.name:"Board"});function Ms(e,i){console.log("optionId",e),e==="Leave Discussion"?Vs(i):e==="Edit Description"?es(i):e==="Close Discussion"?As(i):e==="Delete Discussion"&&Gs(i)}l(Ms,"handleDiscussionOption");const Ss=l(()=>ae({queryKey:["getDiscussionsKey",j],queryFn:async()=>(await ce(j,{paginate:"false"})).data}),"getDiscussions"),{isLoading:Ts,data:Es,refetch:F}=Ss(),qs=l(async()=>{const e=await te({paginate:"false"});Y.value=e.data},"getBoards"),Ls=l(async()=>{const e=await ie({paginate:"false"});J.value=e.data},"getCommittees"),Us=l(async()=>{const e=await oe({paginate:"false"});Z.value=e.data},"getUsers"),js=k(()=>[{label:"Boards",options:Y.value.map(i=>({id:i.id,name:i.name,class:"board"}))},{label:"Committees",options:J.value.map(i=>({id:i.id,name:i.name,class:"committee"}))},{label:"Users",options:Z.value.map(i=>({id:i.id,name:i.full_name,class:"user"}))}]),is=k(()=>m.value.filter(e=>e.class==="board")),os=k(()=>m.value.filter(e=>e.class==="committee")),as=k(()=>m.value.filter(e=>e.class==="user")),Rs=k(()=>V.value),D=k(()=>A.value);k(()=>P.value);const Fs=l(e=>{w(),V.value=e.chats,A.value=e},"handleSelectedDiscussion"),ns=l(e=>{n("topic",e.topic),n("description",e.description),n("closestatus",e.closestatus),n("archivestatus",e.archivestatus),n("discussion_id",e.id),m.value=e.dassignees,n("discussionassignees",m.value),Q()},"onSubmitChat"),$s=l(()=>{n("discussionassignees",m.value)},"selectedGroupMember"),Bs=l(()=>{n("discussionassignees",m.value)},"removeselectedGroupMembers"),Vs=l(e=>{ue(e.id),F(),w()},"leaveDiscussion"),As=l(e=>{_e(e.id),F(),w()},"closeDiscussion"),Gs=l(e=>{pe(e.id),F(),w()},"deleteDiscussion"),Hs=l(async()=>{await Us(),await qs(),await Ls()},"getAllMembers");Ks(async()=>{window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Discussions"})),Hs(),F()});const Is=l(()=>{w(),U.value=!0,N.value=!1,B.value=-1,c.value="create chat"},"enableAddingNewChat"),ls=l((e,i)=>{w(),N.value=!0,U.value=!1,B.value=e,c.value="edit chat",P.value=i,n("id",i.id),n("message",i.message),n("assignee_sender_id",i.assignee_sender_id)},"enableEditing");return(e,i)=>{const g=Os("Multiselect");return h(_).hasPermission(["view discussion"])?(o(),a("div",me,[s("div",he,[s("div",ve,[fe,h(_).hasPermission(["create discussion"])?(o(),a("div",ge,[s("button",{type:"button",onClick:C(ws,["prevent"]),class:"btn btn-tool"},[be,H(),ye])])):y("",!0)]),s("div",xe,[h(Ts)?(o(),a("div",we,"Loading Meeting Discussions...")):(o(),a("div",De,[s("div",ke,[s("div",Ce,[s("div",Me,[Se,s("div",Te,[Ee,s("div",qe,[(o(!0),a(T,null,E(h(Es),t=>(o(),a("div",{key:t.id,class:"card mb-2 border border-primary hover:cursor-pointer"},[s("div",Le,[Ue,s("div",je,[s("h6",Re,r(t.topic),1),s("small",Fe,r(t.author.full_name),1),s("p",{innerHTML:t.description,class:"mb-0"},null,8,$e)]),s("a",{href:"#",onClick:C(b=>Fs(t),["prevent"]),class:"btn btn-sm btn-outline-secondary m-1"},Ae,8,Be),s("a",{href:"#",onClick:C(b=>es(t),["prevent"]),class:"btn btn-sm btn-outline-secondary m-1"},Ie,8,Ge)])]))),128))])])])]),s("div",Ne,[s("div",Pe,[s("div",Qe,[Ke,D.value?(o(),a("div",Oe,[ze,s("div",We,[(o(!0),a(T,null,E(Cs.value,t=>(o(),a("a",{key:t.id,class:"dropdown-item",href:"#",onClick:C(b=>Ms(t.name,D.value),["prevent"])},[s("i",{class:K(t.icon)},null,2),H(" "+r(t.name),1)],8,Xe))),128))]),s("button",{class:"btn btn-sm text-white mr-2",onClick:i[0]||(i[0]=C(t=>Ds(D.value),["prevent"]))},Je)])):y("",!0)]),D.value?(o(),a("div",Ze,[s("div",st,[s("h5",null,r(D.value.topic),1),et]),s("div",tt,[s("div",it,[s("div",ot,[s("div",at,[s("a",nt,r(D.value.author.full_name),1),H(" created this discussion on "+r(h(z)(D.value.created_at)),1)]),s("div",null,[s("p",{innerHTML:D.value.description,class:"mb-0"},null,8,lt)])])]),s("div",ct,[(o(!0),a(T,null,E(Rs.value,(t,b)=>{var ds,rs;return o(),a("div",{key:t.id},[s("div",dt,[B.value===b&&c.value==="edit chat"?(o(),a("div",rt,[s("form",{novalidate:"",onSubmit:i[1]||(i[1]=C(us=>ns(D.value),["prevent"]))},[s("div",ut,[S(I,{label:"Chat Description",name:"message",theme:"snow",placeholder:"Enter Message Content",toolbar:"minimal",contentType:"html",class:"w-full"}),_t])],32)])):(o(),a("div",pt,[t.sender.id!==h(v)?(o(),a("div",mt,[s("div",ht,[s("span",vt,r(t.sender.full_name),1),s("span",ft,r(h(z)(t.created_at)),1)]),t.editstatus==="edited"?(o(),a("div",gt,[s("span",bt,r(t.editstatus),1)])):y("",!0),s("img",{src:h(ps)((ds=t.sender.profile)==null?void 0:ds.avatar),class:"direct-chat-img float-left mr-1",alt:"User Image"},null,8,yt),s("div",{innerHTML:t.message,class:"direct-chat-text"},null,8,xt)])):(o(),a("div",wt,[s("div",Dt,[s("span",kt,r(t.sender.full_name),1),s("span",Ct,[H(r(h(z)(t.created_at))+" ",1),s("span",{onClick:us=>ls(b,t)},Tt,8,Mt)])]),t.editstatus==="edited"?(o(),a("div",Et,[s("span",qt,r(t.editstatus),1)])):y("",!0),s("img",{src:h(ps)((rs=t.sender.profile)==null?void 0:rs.avatar),class:"direct-chat-img float-right ml-1",alt:"User Image"},null,8,Lt),s("div",{onClick:us=>ls(b,t),innerHTML:t.message,class:"direct-chat-text bg-white"},null,8,Ut)]))]))])])}),128)),U.value&&c.value==="create chat"?(o(),a("div",jt,[s("form",{novalidate:"",onSubmit:i[2]||(i[2]=C(t=>ns(D.value),["prevent"]))},[s("div",Rt,[S(I,{label:"Chat Description",name:"message",theme:"snow",placeholder:"Enter Message Content",toolbar:"minimal",contentType:"html",class:"w-full"}),Ft])],32)])):y("",!0),!U.value&&c.value!=="create chat"?(o(),a("div",$t,[s("button",{onClick:Is,class:"btn btn-secondary block w-full mt-4"}," Add Chat ")])):y("",!0)])])])):(o(),a("div",Bt,At))])])]),s("div",Gt,[s("dialog",{id:"discussionmodal",class:"modal",ref_key:"DiscussionModal",ref:R},[s("form",Ht,[s("h3",It,r(c.value=="create"?"Create Discussion":"Edit Discussion")+" "+r(c.value),1),Nt,s("div",Pt,[s("div",Qt,[s("div",Kt,[s("form",{novalidate:"",onSubmit:i[6]||(i[6]=C((...t)=>h(Q)&&h(Q)(...t),["prevent"])),class:""},[$.value?(o(),a("div",Ot,[s("div",zt,[s("div",Wt,[S(_s,{labeled:!0,label:"Discussion Topic",name:"topic",placeholder:"Enter Discussion Topic",type:"text"})])]),S(I,{label:"Discussion Description",name:"description",theme:"snow",placeholder:"Enter Discussion Description",toolbar:"full",contentType:"html",class:"col-span-3"})])):(o(),a("div",Xt,[s("div",Yt,[s("div",Jt,[S(_s,{labeled:!0,label:"Discussion Topic",name:"topic",placeholder:"Enter Discussion Topic",type:"text"})])]),S(I,{label:"Discussion Description",name:"description",theme:"snow",placeholder:"Enter Discussion Description",toolbar:"full",contentType:"html",class:"col-span-3"})])),s("div",Zt,[s("div",si,[is.value.length?(o(),a("div",ei,[ti,s("ul",null,[(o(!0),a(T,null,E(is.value,(t,b)=>(o(),a("li",{key:t.id},r(b+1)+". "+r(t.name),1))),128))])])):y("",!0)]),s("div",ii,[os.value.length?(o(),a("div",oi,[ai,s("ul",null,[(o(!0),a(T,null,E(os.value,(t,b)=>(o(),a("li",{key:t.id},r(b+1)+". "+r(t.name),1))),128))])])):y("",!0)]),s("div",ni,[as.value.length?(o(),a("div",li,[ci,s("ul",null,[(o(!0),a(T,null,E(as.value,(t,b)=>(o(),a("li",{key:t.id},r(b+1)+". "+r(t.name),1))),128))])])):y("",!0)])]),s("div",di,[ri,s("div",{class:K(["multiselect-container",{error:!!h(G)}])},[S(g,{id:"discussionassignees",modelValue:m.value,"onUpdate:modelValue":i[3]||(i[3]=t=>m.value=t),mode:"tags",required:"",placeholder:"Choose your stack","close-on-select":!1,"filter-results":!1,"min-chars":1,"resolve-on-load":!1,delay:0,searchable:!0,options:js.value,groups:!0,valueProp:"id",trackBy:"id",label:"name",class:K(["multiselect-container multiselect-wrapper",["multiselect-container ",{error:!!h(G)}]]),object:!0,onSelect:i[4]||(i[4]=t=>$s()),onDeselect:i[5]||(i[5]=t=>Bs())},null,8,["modelValue","options","class"]),h(G)?(o(),a("div",ui,r(h(G)),1)):y("",!0)],2)]),m.value&&m.value.length?(o(),a("div",_i,[s("button",pi,r(c.value=="create"?"Create Discussion":"Edit Discussion"),1)])):y("",!0)],32)])])])])],512)])]))])])])):(o(),a("div",mi,vi))}}});const qi=Xs(fi,[["__scopeId","data-v-4e4fea33"]]);export{qi as default};
