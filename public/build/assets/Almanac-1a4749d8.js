var ot=Object.defineProperty;var c=(x,p)=>ot(x,"name",{value:p,configurable:!0});import{d as B,i as L,r as D,V as at,C as nt,P as j,u as o,o as i,c as r,e as t,U as y,T as _,h as v,F as lt,R as dt,t as d,f as $,g as w,W as it,X as rt,_ as ct,k as ut,$ as pt,D as mt}from"./main-dbb1f149.js";import{d as I,p as bt,q as ht,t as _t,v as T,G as vt,F as ft,H as yt,k as gt,m as g,f as wt,n as xt,I as kt,J as Ct}from"./Breadcrumb-e536828e.js";import{u as At,c as $t,a as A,d as St,b as Mt}from"./useUnexpectedErrorHandler-4e609aa9.js";import{u as Dt,a as Ft,b as Et,c as Pt,d as qt,e as It,f as Ut,g as Rt,h as Tt}from"./useAlmanacRequest-2a380848.js";import{_ as V}from"./FormDateTimeInput.vue_vue_type_style_index_0_lang-d918e2dc.js";import{F as H}from"./FormInput-9ec9e7b2.js";import{F as Vt}from"./FormQuillEditor-4b336791.js";import{F as Ht}from"./FormUpload-23b8c503.js";import{u as Bt}from"./useQuery-c5d8918e.js";import"./index-78587978.js";import"./useQueryClient-785d5088.js";const u=c(x=>(it("data-v-0d69e9be"),x=x(),rt(),x),"_withScopeId"),Lt={key:0,class:"container-fluid"},jt={class:"row"},Nt={class:"col-md-12"},zt={class:"card card-widget"},Kt={class:"card-header"},Ot=u(()=>t("h1",{class:"h2 mb-2 lg:mb-0"},"Almanacs",-1)),Yt={class:"card-tools"},Gt=u(()=>t("i",{class:"fas fa-plus mr-2"},null,-1)),Qt=[Gt],Wt={class:"card-body"},Jt={key:0,class:"products-list product-list-in-card pl-2 pr-2"},Xt={class:"row"},Zt={class:"col-md-1"},te={class:"calendar-icon w-full flex flex-col items-center justify-center mt-1 calendaheight"},ee={class:"month customonth"},se={class:"day font-medium customday"},oe={class:"year font-medium customyear"},ae={class:"col-md-11"},ne={class:"col-md-12 text-black"},le={class:"h2 mb-2 lg:mb-0 font-bold"},de={class:"col-md-12 text-black font-medium"},ie=["innerHTML"],re={class:"row border-top border-bottom border-warning d-flex justify-content-between align-items-center"},ce={class:"text-primary font-bold ml-2 mr-2"},ue={class:"text-primary font-bold ml-2 mr-2"},pe={class:"text-primary font-bold ml-2 mr-2"},me={class:"text-primary font-bold ml-2 mr-2"},be={class:"text-primary font-bold ml-2 mr-2"},he={class:"text-primary font-bold ml-2 mr-2"},_e={class:"text-primary font-bold ml-2 mr-2"},ve={key:0},fe=["onClick"],ye=["onClick"],ge=["onClick"],we=["onClick"],xe=["onClick"],ke={key:1},Ce={class:"flex justify-center items-center min-h-screen"},Ae={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},$e=u(()=>t("h3",{class:"font-bold text-lg text-center"}," Meeting Spreadsheet Import & Export ",-1)),Se=u(()=>t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕",-1)),Me={class:"overflow-auto p-4",style:{"max-height":"80vh"}},De={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Fe={class:"card"},Ee=u(()=>t("div",{class:"card-header"},[t("h3",{class:"card-title font-bold"},"Instructions for Preparing and Uploading CSV File")],-1)),Pe={class:"card-body"},qe=u(()=>t("div",{class:"font-bold text-primary mb-3"},"Download Template for Import",-1)),Ie=u(()=>t("ul",null,[t("li",null,"1. Open the downloaded CSV and review the format."),t("li",null,"2. Fill in your data as per the column headings, ensuring correct date formats."),t("li",null,'3. For meetings that were approve, the status place "approved" else use "unapproved" small caps.'),t("li",null,"4. Delete the initial sample row from the file."),t("li",null,"5. Save your file in CSV format."),t("li",null,"6. Upload your file using the button below.")],-1)),Ue={class:"card"},Re={class:"card-body"},Te={key:0,class:"mt-3"},Ve={class:"mb-2"},He=["src"],Be=u(()=>t("strong",null,"File Name: ",-1)),Le=u(()=>t("strong",null,"File Size: ",-1)),je=u(()=>t("strong",null,"Type: ",-1)),Ne=u(()=>t("strong",null,"Last Modified: ",-1)),ze=u(()=>t("button",{type:"submit",class:"btn btn-primary btn-md mt-3 w-full"}," Upload CSV ",-1)),Ke={class:"flex justify-center items-center min-h-screen"},Oe={method:"dialog",class:"modal-box rounded-xl relative bg-white shadow-xl"},Ye={class:"font-bold text-lg text-center"},Ge=u(()=>t("button",{class:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2"},"✕",-1)),Qe={class:"overflow-auto p-4",style:{"max-height":"80vh"}},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4 p-2"},Je={class:"col-span-2"},Xe={class:"flex flex-wrap -mx-2"},Ze={class:"w-full md:w-1/2 px-1 md:px-2 mb-4"},ts={class:"w-full md:w-1/2 px-1 md:px-2 mb-4"},es={class:"flex flex-wrap -mx-2"},ss={class:"w-full md:w-1/2 px-2 mb-2"},os={class:"w-full md:w-1/2 px-2 mb-2"},as={type:"submit",class:"btn btn-primary btn-md w-full mt-6"},ns={key:1,class:"container-fluid"},ls=u(()=>t("p",{class:"m-0"},[t("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1)),ds=[ls],is=B({__name:"HomeDashboard",setup(x){const p=L(),k=D(!1),b=D("create"),S=D(null),M=D(null),E=D(null),N=At(),z=$t({type:A().required(),purpose:A().required(),start:A().required(),end:A().required(),budget:A().required(),status:A().required(),held:A().required(),fileupload:St().nullable()}),{handleSubmit:K,setErrors:O,setFieldValue:n,values:Y}=Mt({validationSchema:z,initialValues:{type:"",purpose:"",start:"",end:"",budget:"",status:"unapproved",held:"scheduled",fileupload:null}}),G=c(()=>{var e;F(),b.value="create",k.value=!0,(e=S.value)==null||e.showModal()},"openCreateAlmanacModal"),Q=c(()=>{var e;F(),I(),b.value="import",k.value=!0,(e=M.value)==null||e.showModal(),U()},"openImportAlmanacModal"),W=c(e=>{var a;F(),I(),E.value=e,n("type",e.type),n("purpose",e.purpose),n("start",e.start),n("end",e.end),n("budget",e.budget),n("status",e.status),n("held",e.held),b.value="edit",k.value=!0,(a=S.value)==null||a.showModal()},"openEditAlmanacModal"),F=c(()=>{var e;E.value=null,n("type",""),n("purpose",""),n("start",""),n("end",""),n("budget",""),n("status","unapproved"),n("held","scheduled"),n("fileupload",null),I(),b.value="create",k.value=!1,(e=S.value)==null||e.close(),l.value="unapproved"},"reseting"),J=c(async()=>{U();const e={type:"sample",document:"csv",title:"almanacs-import-template.csv"},a=await Pt(e),s=new Blob([a],{type:"text/csv"}),m=window.URL.createObjectURL(s),h=document.createElement("a");document.body.appendChild(h),h.href=m,h.download=e.title,h.click(),setTimeout(()=>{window.URL.revokeObjectURL(m),document.body.removeChild(h)},0)},"DownloadAlmanacSample"),U=c(async()=>{b.value="import",n("type","1"),n("purpose","2"),n("start","3"),n("end","4"),n("budget","6"),n("status","unapproved"),n("held","scheduled"),console.log(Y)},"setfakedata"),P=K(async e=>{var a,s,m;try{if(b.value==="create")await Dt(e);else if(b.value==="import"){const h={type:e.type,purpose:e.purpose,start:e.start,end:e.end,budget:e.budget,status:e.status,held:e.held,fileupload:e.fileupload};await Ft(h)}else b.value==="edit"?await Et(e,(a=E.value)==null?void 0:a.id):console.error("Invalid action specified");await C(),F(),k.value=!1,(s=S.value)==null||s.close(),(m=M.value)==null||m.close()}catch(h){h instanceof at?O(h.messages):N(h),await C(),F()}}),X=c(()=>Bt({queryKey:["getAlmanacsKey"],queryFn:async()=>(await Tt({paginate:"false"})).data}),"getAlmanacs"),{isLoading:Ms,data:q,refetch:C}=X(),l=D("scheduled"),R=nt(()=>{if(!q.value||q.value.length===0)return[];const e=new Date;return q.value.filter(a=>{const s=new Date(a.start),m=new Date(a.end);switch(l.value){case"past":return m<e;case"ongoing":return s<=e&&m>=e;case"scheduled":case"held":case"postponed":case"cancelled":return a.held===l.value;default:return a.status===l.value}})}),f=c(e=>{l.value=e},"filterAlmanacs"),Z=c(async e=>{await qt(e),await C(),l.value="approved"},"onApprovePublish"),tt=c(async e=>{await It(e),await C(),l.value="held"},"onHeld"),et=c(async e=>{await Ut(e),await C(),l.value="cancelled"},"onCancelled"),st=c(async e=>{await Rt(e),await C(),l.value="postponed"},"onPostponed");return j(async()=>{await C()}),(e,a)=>o(p).hasPermission(["view almanac"])?(i(),r("div",Lt,[t("div",jt,[t("div",Nt,[t("div",zt,[t("div",Kt,[Ot,t("div",Yt,[t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="approved"}]),onClick:a[0]||(a[0]=s=>f("approved"))}," Approved ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="unapproved"}]),onClick:a[1]||(a[1]=s=>f("unapproved"))}," UnApproved ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="ongoing"}]),onClick:a[2]||(a[2]=s=>f("ongoing"))}," Ongoing ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="past"}]),onClick:a[3]||(a[3]=s=>f("past"))}," Past ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="scheduled"}]),onClick:a[4]||(a[4]=s=>f("scheduled"))}," Scheduled ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="held"}]),onClick:a[5]||(a[5]=s=>f("held"))}," Held ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="postponed"}]),onClick:a[6]||(a[6]=s=>f("postponed"))}," Postponed ",2),t("button",{type:"button",class:y(["btn btn-tool",{"btn-info":l.value==="cancelled"}]),onClick:a[7]||(a[7]=s=>f("cancelled"))}," Cancelled ",2),o(p).hasPermission(["upload almanac"])?(i(),r("button",{key:0,type:"button",onClick:_(Q,["prevent"]),class:"mr-1 ml-1 btn btn-sm btn-primary"}," Import ")):v("",!0),o(p).hasPermission(["create almanac"])?(i(),r("button",{key:1,type:"button",onClick:_(G,["prevent"]),class:"btn btn-tool"},Qt)):v("",!0)])]),t("div",Wt,[R.value.length>0?(i(),r("ul",Jt,[(i(!0),r(lt,null,dt(R.value,s=>(i(),r("li",{class:"item",key:s.id},[t("div",Xt,[t("div",Zt,[t("div",te,[t("div",ee,d(o(bt)(s.start)),1),t("div",se,[t("span",null,d(o(ht)(s.start)),1)]),t("div",oe,[t("span",null,d(o(_t)(s.start)),1)])])]),t("div",ae,[t("div",ne,[t("h2",le,d(s.type),1)]),t("div",de,[t("p",{innerHTML:s.purpose},null,8,ie)])])]),t("div",re,[t("div",null,[w(" Start: "),t("span",ce,d(o(T)(s.start)),1),w(" || End: "),t("span",ue,d(o(T)(s.end)),1),w(" || Duration: "),t("span",pe,d(o(vt)(s.start,s.end,"days")),1),w(" || When: "),t("span",me,d(o(ft)(s.start,s.end,"days")),1),w(" || Budget: "),t("span",be,d(o(yt)(s.budget,"Kshs")),1),w(" || Held Status: "),t("span",he,d(s.held),1),w(" || Status: "),t("span",_e,d(s.status),1)]),o(p).hasPermission(["edit almanac"])?(i(),r("span",ve,[o(p).hasPermission(["edit almanac"])?(i(),r("button",{key:0,class:"btn btn-sm btn-primary font-bold ml-2 mr-2 mt-1 mb-1",onClick:_(m=>W(s),["prevent"])}," Edit ",8,fe)):v("",!0),o(p).hasPermission(["publish almanac"])&&l.value!=="approved"?(i(),r("button",{key:1,class:"btn btn-sm btn-warning font-bold ml-2 mr-2 mt-1 mb-1",onClick:_(m=>Z(s.id),["prevent"])}," Approve ",8,ye)):v("",!0),o(p).hasPermission(["mark held almanac"])&&l.value!=="held"?(i(),r("button",{key:2,class:"btn btn-sm btn-warning font-bold ml-2 mr-2 mt-1 mb-1",onClick:_(m=>tt(s.id),["prevent"])}," Held ",8,ge)):v("",!0),o(p).hasPermission(["cancel almanac"])&&l.value!=="cancelled"?(i(),r("button",{key:3,class:"btn btn-sm btn-warning font-bold ml-2 mr-2 mt-1 mb-1",onClick:_(m=>et(s.id),["prevent"])}," Cancelled ",8,we)):v("",!0),o(p).hasPermission(["postpone almanac"])&&l.value!=="postponed"?(i(),r("button",{key:4,class:"btn btn-sm btn-warning font-bold ml-2 mr-2 mt-1 mb-1",onClick:_(m=>st(s.id),["prevent"])}," Postponed ",8,xe)):v("",!0)])):v("",!0)])]))),128))])):(i(),r("div",ke," No almanacs found for "+d(l.value),1))])])])]),t("div",Ce,[t("dialog",{id:"almanacImportmodal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"AlmanacImportModal",ref:M},[t("form",Ae,[$e,Se,t("div",Me,[t("div",De,[t("div",Fe,[Ee,t("div",Pe,[qe,t("button",{onClick:_(J,["prevent"]),class:"btn btn-primary btn-sm mb-3"}," Download CSV Template "),Ie])]),t("div",Ue,[t("div",Re,[t("form",{novalidate:"",onSubmit:a[8]||(a[8]=_((...s)=>o(P)&&o(P)(...s),["prevent"]))},[$(Ht,{labeled:!0,label:"Upload Completed CSV File",name:"fileupload",class:"w-full text-sm text-white tracking-wide",placeholder:"Select CSV file",type:"file",accept:".csv, application/vnd.ms-excel, text/csv",onChange:o(gt)},null,8,["onChange"]),o(g)&&o(g).name?(i(),r("div",Te,[t("div",Ve,[o(g).previewUrl?(i(),r("img",{key:0,src:o(g).previewUrl,alt:"File Preview",class:"w-1/4 mb-2"},null,8,He)):v("",!0)]),t("p",null,[Be,t("span",null,d(o(g).name),1)]),t("p",null,[Le,t("span",null,d(o(wt)(o(g).size)),1)]),t("p",null,[je,t("span",null,d(o(g).type),1)]),t("p",null,[Ne,t("span",null,d(o(xt)(o(g).lastModifiedDate)),1)])])):v("",!0),ze],32)])])])])])],512)]),t("div",Ke,[t("dialog",{id:"almanacmodal",class:"modal w-full max-w-4xl mx-auto p-0",ref_key:"AlmanacModal",ref:S},[t("form",Oe,[t("h3",Ye,d(b.value=="create"?"Create Almanac":"Edit Almanac"),1),Ge,t("div",Qe,[t("div",We,[t("div",Je,[t("form",{novalidate:"",onSubmit:a[9]||(a[9]=_((...s)=>o(P)&&o(P)(...s),["prevent"])),class:""},[t("div",Xe,[t("div",Ze,[$(H,{labeled:!0,label:"Meeting Type",name:"type",placeholder:"Enter Meeting Type",type:"text"})]),t("div",ts,[$(H,{labeled:!0,label:"Meeting Budget (KShs)",name:"budget",placeholder:"Enter Meeting Budget (KShs)",type:"number"})])]),t("div",es,[t("div",ss,[$(V,{label:"Meeting Start Day & Time",name:"start",mode:"date-picker",modeltype:"dd-MM-yyyy",enabletimepicker:!1,placeholder:"Meeting Start Day"})]),t("div",os,[$(V,{label:"Meeting End Time",name:"end",mode:"date-picker",modeltype:"dd-MM-yyyy",enabletimepicker:!1,placeholder:"Meeting End Day"})])]),$(Vt,{label:"Meeting Purpose",name:"purpose",theme:"snow",placeholder:"Enter Meeting Purpose",toolbar:"full",contentType:"html",class:"col-span-3"}),t("button",as,d(b.value=="create"?"Create Almanac":"Edit Almanac"),1)],32)])])])])],512)])])):(i(),r("div",ns,ds))}});const rs=ct(is,[["__scopeId","data-v-0d69e9be"]]),cs={key:0,class:"container-fluid"},us={class:"col-md-12"},ps={class:"card card-widget widget-user shadow-lg"},ms={class:"card-footer"},bs={class:""},hs={class:"info-box-icon bg-danger",style:{left:"4%","margin-left":"-45px",position:"absolute",top:"190px"}},_s=["src"],vs={class:"ml-3 flex-1",style:{"margin-top":"-28px"}},fs=t("i",{class:"fas fa-chevron-left fa-xs"},null,-1),ys=t("h3",{class:"h2 mb-2 lg:mb-0",style:{"margin-left":"131px"}}," Almanac Meetings ",-1),gs={class:"card-outline card-outline-tabs"},ws=t("div",{class:"card-header p-0 border-bottom-0"},[t("ul",{class:"nav nav-tabs",id:"custom-tabs-four-tab",role:"tablist"},[t("li",{class:"nav-item"},[t("a",{class:"nav-link active",id:"custom-tabs-four-home-tab","data-toggle":"pill",href:"#custom-tabs-four-home",role:"tab","aria-controls":"custom-tabs-four-home","aria-selected":"true"}," Almanac ")])])],-1),xs={class:"card-body"},ks={class:"tab-content",id:"custom-tabs-four-tabContent"},Cs={class:"tab-pane fade active show",id:"custom-tabs-four-home",role:"tabpanel","aria-labelledby":"custom-tabs-four-home-tab"},As={key:1,class:"container-fluid"},$s=t("p",{class:"m-0"},[t("span",{class:"h3 text-primary text-bold text-danger"},"Sorry, You are not Authorised to view this page")],-1),Ss=[$s],Ls=B({__name:"Almanac",setup(x){const p=L(),k=ut();function b(){k.push({name:mt})}return c(b,"goBack"),j(async()=>{await window.dispatchEvent(new CustomEvent("updateTitle",{detail:"Almanac Meetings"}))}),(S,M)=>o(p).hasPermission(["view almanac"])?(i(),r("div",cs,[t("div",us,[t("div",ps,[t("div",{class:"widget-user-header text-white",style:pt([{background:`url(${o(kt)("default.png")}) center center`},{height:"250px"}])},null,4),t("div",ms,[t("div",bs,[t("span",hs,[t("img",{class:"img-square",src:o(Ct)("photo1.png"),alt:"User Avatar",style:{width:"128px",height:"128px"}},null,8,_s)]),t("div",vs,[t("a",{href:"",onClick:M[0]||(M[0]=_(E=>b(),["prevent"])),class:"mb-2 lg:mb-0 text-blue-primary",style:{"margin-left":"131px","margin-top":"-44px"}},[fs,w(" Dashboard ")]),ys,t("div",gs,[ws,t("div",xs,[t("div",ks,[t("div",Cs,[$(rs)])])])])])])])])])])):(i(),r("div",As,Ss))}});export{Ls as default};
